var e=require("buffer"),t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r=t.parcelRequirec887_jg5lz;r.register("l6dlz",function(i,n){function s(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{},o=a.parcelRequire3a38_2ofct,l=o.register;l("jTOzh",function(e,t){s(e.exports,"DoppioWrapper",function(){return d});var r=o("bsvQL"),i=o("iRn4y"),n=o("hJ7nZ"),a=o("4gxuw"),l=o("giOKx");let u={[i.EPlaybackState.IDLE]:n.EPlaybackState.IDLE,[i.EPlaybackState.LOADING]:n.EPlaybackState.LOADING,[i.EPlaybackState.PAUSED]:n.EPlaybackState.PAUSED,[i.EPlaybackState.PLAYING]:n.EPlaybackState.PLAYING,[i.EPlaybackState.ERROR]:n.EPlaybackState.ERROR};class d extends a.AbstractWrapper{constructor(e){super(e),this._logLevels=[]}setStreamConfig(e){return e&&e.HLSStreamUrl?(this._lastKnownStreamConfig={hlsStreamUrl:e.HLSStreamUrl},this._playerInstance?.setUrl(e.HLSStreamUrl)):(this._lastKnownStreamConfig=null,this._playerInstance?.setUrl("")),this}setAbrResolutions(){return this}enableAbr(){return this._isAbrEnabled=!0,this._playerInstance?.enableABR(),this}setResolutionByName(e){return this._playerInstance?.setResolutionByName(e),this}setResolutionByBitrate(e){return this._playerInstance?.setResolutionByBitrate(e),this}setLoggerLevel(e){this._playerInstance?.setLoggerLevel(e),this._logLevels=e}disableAbr(){return this._isAbrEnabled=!1,this._playerInstance?.disableABR(),this}get version(){return this._playerInstance?.version}_attachEventListeners(){this._playerInstance&&(this._playerInstance.addEventListener(i.EEvent.DEBUGGER_CONNECTED,this._onDebuggerConnected),this._playerInstance.addEventListener(i.EEvent.PLAYBACK_STATE_CHANGED,this._onPlaybackStateChanged),this._playerInstance.addEventListener(i.EEvent.ERROR,this._onDoppioError),this._playerInstance.addEventListener(i.EEvent.VARIANTS_DETECTED,this._onResolutionsAvailable),this._playerInstance.addEventListener(i.EEvent.METRICS_AVAILABLE,this._onMetricsReported),this._playerInstance.addEventListener(i.EEvent.FRAG_LOADED,this._onPlaylistLoaded),this._playerInstance.addEventListener(i.EEvent.LEVEL_LOADED,this._onFragLoaded),this._playerInstance.addEventListener(i.EEvent.LIFECYCLE_EVENT,this._onLifecycleEventReported),this._playerInstance.addEventListener(i.EEvent.LIFECYCLE_ERROR,this._onLifecycleErrorReported),this._playerInstance.addEventListener(i.EEvent.LEVEL_SWITCHED_AUTO,this._onRenditionSwitchAuto),this._playerInstance.addEventListener(i.EEvent.RESOLUTION_CHANGED,this._onResolutionChanged),this._playerInstance.addEventListener(i.EEvent.RESOLUTION_NOT_FOUND,this._onResolutionNotFound),this._playerInstance.addEventListener(i.EEvent.FRAGMENT_FILTERED_OUT,this._onFragmentFilteredOut))}_detachEventListeners(){this._playerInstance&&(this._playerInstance.removeEventListener(i.EEvent.DEBUGGER_CONNECTED,this._onDebuggerConnected),this._playerInstance.removeEventListener(i.EEvent.PLAYBACK_STATE_CHANGED,this._onPlaybackStateChanged),this._playerInstance.removeEventListener(i.EEvent.ERROR,this._onDoppioError),this._playerInstance.removeEventListener(i.EEvent.VARIANTS_DETECTED,this._onResolutionsAvailable),this._playerInstance.removeEventListener(i.EEvent.METRICS_AVAILABLE,this._onMetricsReported),this._playerInstance.removeEventListener(i.EEvent.FRAG_LOADED,this._onPlaylistLoaded),this._playerInstance.removeEventListener(i.EEvent.LEVEL_LOADED,this._onFragLoaded),this._playerInstance.removeEventListener(i.EEvent.LIFECYCLE_EVENT,this._onLifecycleEventReported),this._playerInstance.removeEventListener(i.EEvent.LIFECYCLE_ERROR,this._onLifecycleErrorReported),this._playerInstance.removeEventListener(i.EEvent.RESOLUTION_CHANGED,this._onRenditionSwitchAuto),this._playerInstance.removeEventListener(i.EEvent.RESOLUTION_CHANGED,this._onResolutionChanged),this._playerInstance.removeEventListener(i.EEvent.RESOLUTION_NOT_FOUND,this._onResolutionNotFound),this._playerInstance.removeEventListener(i.EEvent.FRAGMENT_FILTERED_OUT,this._onFragmentFilteredOut))}_createPlayerInstance(){this._destroyPlayerInstance(),this._playerInstance=new i.DoppioPlayer,this._lastKnownConfig&&this._playerInstance.setConfig(this._lastKnownConfig),this._lastKnownStreamConfig&&this._playerInstance.setUrl(this._lastKnownStreamConfig.hlsStreamUrl),this._videoElement&&this._playerInstance.setVideoElement(this._videoElement),this._isAbrEnabled?this._playerInstance.enableABR():this._playerInstance.disableABR(),this._attachEventListeners(),this._playerInstance?.setLoggerLevel(this._logLevels)}_onDebuggerConnected({detail:{panelUrl:e}}){this._eventBusInstance.publish(l.EPlayersEvents.DEBUGGER_CONNECTED,{debuggerUrl:e})}_onPlaybackStateChanged({detail:{prevState:e,nextState:t}}){this._eventBusInstance.publish(l.EPlayersEvents.PLAYBACK_STATE_CHANGED,{nextState:u[t],prevState:u[e]})}_onDoppioError({detail:{error:e}}){this._eventBusInstance.publish(l.EPlayersEvents.ERROR,{error:e,playerType:n.EPlayerType.HLS})}_onResolutionsAvailable({detail:e}){this._eventBusInstance.publish(l.EPlayersEvents.RESOLUTIONS_AVAILABLE,{resolutions:e})}_onMetricsReported({detail:e}){this._metricsCollector?.registerMetrics({targetBuffer:e.targetBuffer}),e.latency&&this._eventBusInstance.publish(l.EPlayersEvents.LATENCY_ESTIMATION_AVAILABLE,{medianLatency:e.latency,EWMALatency:e.latency})}_onFragLoaded(e){this._metricsCollector?.registerMetrics({chunkLoadDuration:e.detail.netStats.downloadDuration,chunkLoadTTFB:e.detail.netStats.ttfb})}_onPlaylistLoaded(e){this._metricsCollector?.registerMetrics({playlistLoadTTFB:e.detail.netStats.ttfb,playlistLoadDuration:e.detail.netStats.downloadDuration})}_onLifecycleEventReported({detail:{eventType:e}}){this._metricsCollector?.registerEvent(e,{})}_onRenditionSwitchAuto({detail:{nextResolution:e,prevResolution:t}}){this._metricsCollector?.registerEvent("RenditionSwitchedAuto",{prevResolution:t,nextResolution:e}),this._eventBusInstance.publish(l.EPlayersEvents.AUTO_RESOLUTION_SWITCHED,{name:e})}_onResolutionChanged({detail:{name:e}}){this._eventBusInstance.publish(l.EPlayersEvents.RESOLUTION_SWITCHED,{name:e})}_onLifecycleErrorReported({detail:{errorType:e,nativeError:t}}){this._metricsCollector?.registerEvent(e,{errorMessage:t?.message||""}),this._eventBusInstance.publish(l.EPlayersEvents.STREAM_LOAD_ERROR,{reason:"HTTP_ERROR",httpStatusCode:t?.statusCode})}_onResolutionNotFound(){this._eventBusInstance.publish(l.EPlayersEvents.RESOLUTION_NOT_FOUND,{})}_onFragmentFilteredOut({detail:{reason:e,fragment:t}}){this._metricsCollector?.registerEvent("FragmentFilteredOut",{reason:e,fragmentName:t})}}(0,r.__decorate)([n.bind],d.prototype,"_onDebuggerConnected",null),(0,r.__decorate)([n.bind],d.prototype,"_onPlaybackStateChanged",null),(0,r.__decorate)([n.bind],d.prototype,"_onDoppioError",null),(0,r.__decorate)([n.bind],d.prototype,"_onResolutionsAvailable",null),(0,r.__decorate)([n.bind],d.prototype,"_onMetricsReported",null),(0,r.__decorate)([n.bind],d.prototype,"_onFragLoaded",null),(0,r.__decorate)([n.bind],d.prototype,"_onPlaylistLoaded",null),(0,r.__decorate)([n.bind],d.prototype,"_onLifecycleEventReported",null),(0,r.__decorate)([n.bind],d.prototype,"_onRenditionSwitchAuto",null),(0,r.__decorate)([n.bind],d.prototype,"_onResolutionChanged",null),(0,r.__decorate)([n.bind],d.prototype,"_onLifecycleErrorReported",null),(0,r.__decorate)([n.bind],d.prototype,"_onResolutionNotFound",null),(0,r.__decorate)([n.bind],d.prototype,"_onFragmentFilteredOut",null)}),l("iRn4y",function(t,r){let i,n,l,u,d,c,h,f,_,g,p,m,v,y,b;function E(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}s(t.exports,"EEvent",function(){return d}),s(t.exports,"EPlaybackState",function(){return _}),s(t.exports,"DoppioPlayer",function(){return iw});var R,S,T,L,A,P,B,C,w,O,D,I,M,F,N,k,x,U,V,q,G,W,j,H,$,K,Y,Q,z,X="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==a?a:{};function Z(e){return e&&e.__esModule?e.default:e}var J={},ee={},et=X.parcelRequire5d5f_zxda7;null==et&&((et=function(e){if(e in J)return J[e].exports;if(e in ee){var t=ee[e];delete ee[e];var r={id:e,exports:{}};return J[e]=r,t.call(r.exports,r,r.exports),r.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){ee[e]=t},X.parcelRequire5d5f_zxda7=et),et.register("8NFq9",function(e,t){E(e.exports,"default",function(){return et("a8VW4").__decorate}),et("a8VW4")}),et.register("a8VW4",function(e,t){function r(e,t,r,i){var n,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,r,a):n(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a}E(e.exports,"__decorate",function(){return r}),"function"==typeof SuppressedError&&SuppressedError}),et.register("eQOGK",function(e,t){E(e.exports,"default",function(){return r});var r=function(e,t,r){if(!r||"function"!=typeof r.value)throw TypeError(`Only methods can be decorated with @bind. <${t}> is not a method!`);return{configurable:!0,get(){let e=r.value?.bind(this);return Object.defineProperty(this,t,{value:e,configurable:!0,writable:!0}),e}}}}),et.register("3mtZ4",function(e,t){(function(){var r,i="Expected a function",n="__lodash_hash_undefined__",s="__lodash_placeholder__",a=1/0,o=NaN,l=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],u="[object Arguments]",d="[object Array]",c="[object Boolean]",h="[object Date]",f="[object Error]",_="[object Function]",g="[object GeneratorFunction]",p="[object Map]",m="[object Number]",v="[object Object]",y="[object Promise]",b="[object RegExp]",E="[object Set]",R="[object String]",S="[object Symbol]",T="[object WeakMap]",L="[object ArrayBuffer]",A="[object DataView]",P="[object Float32Array]",B="[object Float64Array]",C="[object Int8Array]",w="[object Int16Array]",O="[object Int32Array]",D="[object Uint8Array]",I="[object Uint8ClampedArray]",M="[object Uint16Array]",F="[object Uint32Array]",N=/\b__p \+= '';/g,k=/\b(__p \+=) '' \+/g,x=/(__e\(.*?\)|\b__t\)) \+\n'';/g,U=/&(?:amp|lt|gt|quot|#39);/g,V=/[&<>"']/g,q=RegExp(U.source),G=RegExp(V.source),W=/<%-([\s\S]+?)%>/g,j=/<%([\s\S]+?)%>/g,H=/<%=([\s\S]+?)%>/g,$=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,K=/^\w*$/,Y=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Q=/[\\^$.*+?()[\]{}|]/g,z=RegExp(Q.source),Z=/^\s+/,J=/\s/,ee=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,et=/\{\n\/\* \[wrapped with (.+)\] \*/,er=/,? & /,ei=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,en=/[()=,{}\[\]\/\s]/,es=/\\(\\)?/g,ea=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,eo=/\w*$/,el=/^[-+]0x[0-9a-f]+$/i,eu=/^0b[01]+$/i,ed=/^\[object .+?Constructor\]$/,ec=/^0o[0-7]+$/i,eh=/^(?:0|[1-9]\d*)$/,ef=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,e_=/($^)/,eg=/['\n\r\u2028\u2029\\]/g,ep="\ud800-\udfff",em="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",ev="\\u2700-\\u27bf",ey="a-z\\xdf-\\xf6\\xf8-\\xff",eb="A-Z\\xc0-\\xd6\\xd8-\\xde",eE="\\ufe0e\\ufe0f",eR="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",eS="["+eR+"]",eT="["+em+"]",eL="["+ey+"]",eA="[^"+ep+eR+"\\d+"+ev+ey+eb+"]",eP="\ud83c[\udffb-\udfff]",eB="[^\ud800-\udfff]",eC="(?:\ud83c[\udde6-\uddff]){2}",ew="[\ud800-\udbff][\udc00-\udfff]",eO="["+eb+"]",eD="\\u200d",eI="(?:"+eL+"|"+eA+")",eM="(?:['’](?:d|ll|m|re|s|t|ve))?",eF="(?:['’](?:D|LL|M|RE|S|T|VE))?",eN="(?:"+eT+"|"+eP+")?",ek="["+eE+"]?",ex=ek+eN+("(?:"+eD+"(?:")+[eB,eC,ew].join("|")+")"+ek+eN+")*",eU="(?:"+["["+ev+"]",eC,ew].join("|")+")"+ex,eV="(?:"+[eB+eT+"?",eT,eC,ew,"[\ud800-\udfff]"].join("|")+")",eq=RegExp("['’]","g"),eG=RegExp(eT,"g"),eW=RegExp(eP+"(?="+eP+")|"+eV+ex,"g"),ej=RegExp([eO+"?"+eL+"+"+eM+"(?="+[eS,eO,"$"].join("|")+")","(?:"+eO+"|"+eA+")+"+eF+"(?="+[eS,eO+eI,"$"].join("|")+")",eO+"?"+eI+"+"+eM,eO+"+"+eF,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])","\\d+",eU].join("|"),"g"),eH=RegExp("["+eD+ep+em+eE+"]"),e$=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,eK=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],eY=-1,eQ={};eQ[P]=eQ[B]=eQ[C]=eQ[w]=eQ[O]=eQ[D]=eQ[I]=eQ[M]=eQ[F]=!0,eQ[u]=eQ[d]=eQ[L]=eQ[c]=eQ[A]=eQ[h]=eQ[f]=eQ[_]=eQ[p]=eQ[m]=eQ[v]=eQ[b]=eQ[E]=eQ[R]=eQ[T]=!1;var ez={};ez[u]=ez[d]=ez[L]=ez[A]=ez[c]=ez[h]=ez[P]=ez[B]=ez[C]=ez[w]=ez[O]=ez[p]=ez[m]=ez[v]=ez[b]=ez[E]=ez[R]=ez[S]=ez[D]=ez[I]=ez[M]=ez[F]=!0,ez[f]=ez[_]=ez[T]=!1;var eX={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},eZ=parseFloat,eJ=parseInt,e0="object"==typeof X&&X&&X.Object===Object&&X,e1="object"==typeof self&&self&&self.Object===Object&&self,e2=e0||e1||Function("return this")(),e3=t&&!t.nodeType&&t,e8=e3&&e&&!e.nodeType&&e,e4=e8&&e8.exports===e3,e9=e4&&e0.process,e6=function(){try{return e8&&e8.require&&e8.require("util").types||e9&&e9.binding&&e9.binding("util")}catch(e){}}(),e5=e6&&e6.isArrayBuffer,e7=e6&&e6.isDate,te=e6&&e6.isMap,tt=e6&&e6.isRegExp,tr=e6&&e6.isSet,ti=e6&&e6.isTypedArray;function tn(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function ts(e,t,r,i){for(var n=-1,s=null==e?0:e.length;++n<s;){var a=e[n];t(i,a,r(a),e)}return i}function ta(e,t){for(var r=-1,i=null==e?0:e.length;++r<i&&!1!==t(e[r],r,e););return e}function to(e,t){for(var r=-1,i=null==e?0:e.length;++r<i;)if(!t(e[r],r,e))return!1;return!0}function tl(e,t){for(var r=-1,i=null==e?0:e.length,n=0,s=[];++r<i;){var a=e[r];t(a,r,e)&&(s[n++]=a)}return s}function tu(e,t){return!!(null==e?0:e.length)&&ty(e,t,0)>-1}function td(e,t,r){for(var i=-1,n=null==e?0:e.length;++i<n;)if(r(t,e[i]))return!0;return!1}function tc(e,t){for(var r=-1,i=null==e?0:e.length,n=Array(i);++r<i;)n[r]=t(e[r],r,e);return n}function th(e,t){for(var r=-1,i=t.length,n=e.length;++r<i;)e[n+r]=t[r];return e}function tf(e,t,r,i){var n=-1,s=null==e?0:e.length;for(i&&s&&(r=e[++n]);++n<s;)r=t(r,e[n],n,e);return r}function t_(e,t,r,i){var n=null==e?0:e.length;for(i&&n&&(r=e[--n]);n--;)r=t(r,e[n],n,e);return r}function tg(e,t){for(var r=-1,i=null==e?0:e.length;++r<i;)if(t(e[r],r,e))return!0;return!1}var tp=tS("length");function tm(e,t,r){var i;return r(e,function(e,r,n){if(t(e,r,n))return i=r,!1}),i}function tv(e,t,r,i){for(var n=e.length,s=r+(i?1:-1);i?s--:++s<n;)if(t(e[s],s,e))return s;return -1}function ty(e,t,r){return t==t?function(e,t,r){for(var i=r-1,n=e.length;++i<n;)if(e[i]===t)return i;return -1}(e,t,r):tv(e,tE,r)}function tb(e,t,r,i){for(var n=r-1,s=e.length;++n<s;)if(i(e[n],t))return n;return -1}function tE(e){return e!=e}function tR(e,t){var r=null==e?0:e.length;return r?tA(e,t)/r:o}function tS(e){return function(t){return null==t?r:t[e]}}function tT(e){return function(t){return null==e?r:e[t]}}function tL(e,t,r,i,n){return n(e,function(e,n,s){r=i?(i=!1,e):t(r,e,n,s)}),r}function tA(e,t){for(var i,n=-1,s=e.length;++n<s;){var a=t(e[n]);a!==r&&(i=i===r?a:i+a)}return i}function tP(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}function tB(e){return e?e.slice(0,tj(e)+1).replace(Z,""):e}function tC(e){return function(t){return e(t)}}function tw(e,t){return tc(t,function(t){return e[t]})}function tO(e,t){return e.has(t)}function tD(e,t){for(var r=-1,i=e.length;++r<i&&ty(t,e[r],0)>-1;);return r}function tI(e,t){for(var r=e.length;r--&&ty(t,e[r],0)>-1;);return r}var tM=tT({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),tF=tT({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function tN(e){return"\\"+eX[e]}function tk(e){return eH.test(e)}function tx(e){var t=-1,r=Array(e.size);return e.forEach(function(e,i){r[++t]=[i,e]}),r}function tU(e,t){return function(r){return e(t(r))}}function tV(e,t){for(var r=-1,i=e.length,n=0,a=[];++r<i;){var o=e[r];o!==t&&o!==s||(e[r]=s,a[n++]=r)}return a}function tq(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}function tG(e){return tk(e)?function(e){for(var t=eW.lastIndex=0;eW.test(e);)++t;return t}(e):tp(e)}function tW(e){return tk(e)?e.match(eW)||[]:e.split("")}function tj(e){for(var t=e.length;t--&&J.test(e.charAt(t)););return t}var tH=tT({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),t$=function e(t){var X,J=(t=null==t?e2:t$.defaults(e2.Object(),t,t$.pick(e2,eK))).Array,ep=t.Date,em=t.Error,ev=t.Function,ey=t.Math,eb=t.Object,eE=t.RegExp,eR=t.String,eS=t.TypeError,eT=J.prototype,eL=ev.prototype,eA=eb.prototype,eP=t["__core-js_shared__"],eB=eL.toString,eC=eA.hasOwnProperty,ew=0,eO=(X=/[^.]+$/.exec(eP&&eP.keys&&eP.keys.IE_PROTO||""))?"Symbol(src)_1."+X:"",eD=eA.toString,eI=eB.call(eb),eM=e2._,eF=eE("^"+eB.call(eC).replace(Q,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),eN=e4?t.Buffer:r,ek=t.Symbol,ex=t.Uint8Array,eU=eN?eN.allocUnsafe:r,eV=tU(eb.getPrototypeOf,eb),eW=eb.create,eH=eA.propertyIsEnumerable,eX=eT.splice,e0=ek?ek.isConcatSpreadable:r,e1=ek?ek.iterator:r,e3=ek?ek.toStringTag:r,e8=function(){try{var e=nu(eb,"defineProperty");return e({},"",{}),e}catch(e){}}(),e9=t.clearTimeout!==e2.clearTimeout&&t.clearTimeout,e6=ep&&ep.now!==e2.Date.now&&ep.now,tp=t.setTimeout!==e2.setTimeout&&t.setTimeout,tT=ey.ceil,tK=ey.floor,tY=eb.getOwnPropertySymbols,tQ=eN?eN.isBuffer:r,tz=t.isFinite,tX=eT.join,tZ=tU(eb.keys,eb),tJ=ey.max,t0=ey.min,t1=ep.now,t2=t.parseInt,t3=ey.random,t8=eT.reverse,t4=nu(t,"DataView"),t9=nu(t,"Map"),t6=nu(t,"Promise"),t5=nu(t,"Set"),t7=nu(t,"WeakMap"),re=nu(eb,"create"),rt=t7&&new t7,rr={},ri=nN(t4),rn=nN(t9),rs=nN(t6),ra=nN(t5),ro=nN(t7),rl=ek?ek.prototype:r,ru=rl?rl.valueOf:r,rd=rl?rl.toString:r;function rc(e){if(sW(e)&&!sD(e)&&!(e instanceof rg)){if(e instanceof r_)return e;if(eC.call(e,"__wrapped__"))return nk(e)}return new r_(e)}var rh=function(){function e(){}return function(t){if(!sG(t))return{};if(eW)return eW(t);e.prototype=t;var i=new e;return e.prototype=r,i}}();function rf(){}function r_(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}function rg(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=0xffffffff,this.__views__=[]}function rp(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function rm(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function rv(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function ry(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new rv;++t<r;)this.add(e[t])}function rb(e){var t=this.__data__=new rm(e);this.size=t.size}function rE(e,t){var r=sD(e),i=!r&&sO(e),n=!r&&!i&&sN(e),s=!r&&!i&&!n&&sX(e),a=r||i||n||s,o=a?tP(e.length,eR):[],l=o.length;for(var u in e)!t&&!eC.call(e,u)||a&&("length"==u||n&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||np(u,l))||o.push(u);return o}function rR(e){var t=e.length;return t?e[io(0,t-1)]:r}function rS(e,t,i){(i===r||sB(e[t],i))&&(i!==r||t in e)||rB(e,t,i)}function rT(e,t,i){var n=e[t];eC.call(e,t)&&sB(n,i)&&(i!==r||t in e)||rB(e,t,i)}function rL(e,t){for(var r=e.length;r--;)if(sB(e[r][0],t))return r;return -1}function rA(e,t,r,i){return rF(e,function(e,n,s){t(i,e,r(e),s)}),i}function rP(e,t){return e&&iV(t,au(t),e)}function rB(e,t,r){"__proto__"==t&&e8?e8(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function rC(e,t){for(var i=-1,n=t.length,s=J(n),a=null==e;++i<n;)s[i]=a?r:an(e,t[i]);return s}function rw(e,t,i){return e==e&&(i!==r&&(e=e<=i?e:i),t!==r&&(e=e>=t?e:t)),e}function rO(e,t,i,n,s,a){var o,l=1&t,d=2&t,f=4&t;if(i&&(o=s?i(e,n,s,a):i(e)),o!==r)return o;if(!sG(e))return e;var y=sD(e);if(y){if(T=e.length,N=new e.constructor(T),T&&"string"==typeof e[0]&&eC.call(e,"index")&&(N.index=e.index,N.input=e.input),o=N,!l)return iU(e,o)}else{var T,N,k,x,U,V=nh(e),q=V==_||V==g;if(sN(e))return iI(e,l);if(V==v||V==u||q&&!s){if(o=d||q?{}:n_(e),!l)return d?(x=(k=o)&&iV(e,ad(e),k),iV(e,nc(e),x)):(U=rP(o,e),iV(e,nd(e),U))}else{if(!ez[V])return s?e:{};o=function(e,t,r){var i,n,s=e.constructor;switch(t){case L:return iM(e);case c:case h:return new s(+e);case A:return i=r?iM(e.buffer):e.buffer,new e.constructor(i,e.byteOffset,e.byteLength);case P:case B:case C:case w:case O:case D:case I:case M:case F:return iF(e,r);case p:return new s;case m:case R:return new s(e);case b:return(n=new e.constructor(e.source,eo.exec(e))).lastIndex=e.lastIndex,n;case E:return new s;case S:return ru?eb(ru.call(e)):{}}}(e,V,l)}}a||(a=new rb);var G=a.get(e);if(G)return G;a.set(e,o),sY(e)?e.forEach(function(r){o.add(rO(r,t,i,r,e,a))}):sj(e)&&e.forEach(function(r,n){o.set(n,rO(r,t,i,n,e,a))});var W=y?r:(f?d?function(e){return rK(e,ad,nc)}:function(e){return rK(e,au,nd)}:d?ad:au)(e);return ta(W||e,function(r,n){W&&(r=e[n=r]),rT(o,n,rO(r,t,i,n,e,a))}),o}function rD(e,t,i){var n=i.length;if(null==e)return!n;for(e=eb(e);n--;){var s=i[n],a=t[s],o=e[s];if(o===r&&!(s in e)||!a(o))return!1}return!0}function rI(e,t,n){if("function"!=typeof e)throw new eS(i);return nP(function(){e.apply(r,n)},t)}function rM(e,t,r,i){var n=-1,s=tu,a=!0,o=e.length,l=[],u=t.length;if(!o)return l;r&&(t=tc(t,tC(r))),i?(s=td,a=!1):t.length>=200&&(s=tO,a=!1,t=new ry(t));e:for(;++n<o;){var d=e[n],c=null==r?d:r(d);if(d=i||0!==d?d:0,a&&c==c){for(var h=u;h--;)if(t[h]===c)continue e;l.push(d)}else s(t,c,i)||l.push(d)}return l}rc.templateSettings={escape:W,evaluate:j,interpolate:H,variable:"",imports:{_:rc}},rc.prototype=rf.prototype,rc.prototype.constructor=rc,r_.prototype=rh(rf.prototype),r_.prototype.constructor=r_,rg.prototype=rh(rf.prototype),rg.prototype.constructor=rg,rp.prototype.clear=function(){this.__data__=re?re(null):{},this.size=0},rp.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=+!!t,t},rp.prototype.get=function(e){var t=this.__data__;if(re){var i=t[e];return i===n?r:i}return eC.call(t,e)?t[e]:r},rp.prototype.has=function(e){var t=this.__data__;return re?t[e]!==r:eC.call(t,e)},rp.prototype.set=function(e,t){var i=this.__data__;return this.size+=+!this.has(e),i[e]=re&&t===r?n:t,this},rm.prototype.clear=function(){this.__data__=[],this.size=0},rm.prototype.delete=function(e){var t=this.__data__,r=rL(t,e);return!(r<0)&&(r==t.length-1?t.pop():eX.call(t,r,1),--this.size,!0)},rm.prototype.get=function(e){var t=this.__data__,i=rL(t,e);return i<0?r:t[i][1]},rm.prototype.has=function(e){return rL(this.__data__,e)>-1},rm.prototype.set=function(e,t){var r=this.__data__,i=rL(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this},rv.prototype.clear=function(){this.size=0,this.__data__={hash:new rp,map:new(t9||rm),string:new rp}},rv.prototype.delete=function(e){var t=no(this,e).delete(e);return this.size-=+!!t,t},rv.prototype.get=function(e){return no(this,e).get(e)},rv.prototype.has=function(e){return no(this,e).has(e)},rv.prototype.set=function(e,t){var r=no(this,e),i=r.size;return r.set(e,t),this.size+=+(r.size!=i),this},ry.prototype.add=ry.prototype.push=function(e){return this.__data__.set(e,n),this},ry.prototype.has=function(e){return this.__data__.has(e)},rb.prototype.clear=function(){this.__data__=new rm,this.size=0},rb.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},rb.prototype.get=function(e){return this.__data__.get(e)},rb.prototype.has=function(e){return this.__data__.has(e)},rb.prototype.set=function(e,t){var r=this.__data__;if(r instanceof rm){var i=r.__data__;if(!t9||i.length<199)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new rv(i)}return r.set(e,t),this.size=r.size,this};var rF=iW(rW),rN=iW(rj,!0);function rk(e,t){var r=!0;return rF(e,function(e,i,n){return r=!!t(e,i,n)}),r}function rx(e,t,i){for(var n=-1,s=e.length;++n<s;){var a=e[n],o=t(a);if(null!=o&&(l===r?o==o&&!sz(o):i(o,l)))var l=o,u=a}return u}function rU(e,t){var r=[];return rF(e,function(e,i,n){t(e,i,n)&&r.push(e)}),r}function rV(e,t,r,i,n){var s=-1,a=e.length;for(r||(r=ng),n||(n=[]);++s<a;){var o=e[s];t>0&&r(o)?t>1?rV(o,t-1,r,i,n):th(n,o):i||(n[n.length]=o)}return n}var rq=ij(),rG=ij(!0);function rW(e,t){return e&&rq(e,t,au)}function rj(e,t){return e&&rG(e,t,au)}function rH(e,t){return tl(t,function(t){return sU(e[t])})}function r$(e,t){for(var i=0,n=(t=iw(t,e)).length;null!=e&&i<n;)e=e[nF(t[i++])];return i&&i==n?e:r}function rK(e,t,r){var i=t(e);return sD(e)?i:th(i,r(e))}function rY(e){return null==e?e===r?"[object Undefined]":"[object Null]":e3&&e3 in eb(e)?function(e){var t=eC.call(e,e3),i=e[e3];try{e[e3]=r;var n=!0}catch(e){}var s=eD.call(e);return n&&(t?e[e3]=i:delete e[e3]),s}(e):eD.call(e)}function rQ(e,t){return e>t}function rz(e,t){return null!=e&&eC.call(e,t)}function rX(e,t){return null!=e&&t in eb(e)}function rZ(e,t,i){for(var n=i?td:tu,s=e[0].length,a=e.length,o=a,l=J(a),u=1/0,d=[];o--;){var c=e[o];o&&t&&(c=tc(c,tC(t))),u=t0(c.length,u),l[o]=!i&&(t||s>=120&&c.length>=120)?new ry(o&&c):r}c=e[0];var h=-1,f=l[0];e:for(;++h<s&&d.length<u;){var _=c[h],g=t?t(_):_;if(_=i||0!==_?_:0,!(f?tO(f,g):n(d,g,i))){for(o=a;--o;){var p=l[o];if(!(p?tO(p,g):n(e[o],g,i)))continue e}f&&f.push(g),d.push(_)}}return d}function rJ(e,t,i){var n=null==(e=nT(e,t=iw(t,e)))?e:e[nF(nY(t))];return null==n?r:tn(n,e,i)}function r0(e){return sW(e)&&rY(e)==u}function r1(e,t,i,n,s){return e===t||(null!=e&&null!=t&&(sW(e)||sW(t))?function(e,t,i,n,s,a){var o=sD(e),l=sD(t),_=o?d:nh(e),g=l?d:nh(t),y=(_=_==u?v:_)==v,T=(g=g==u?v:g)==v,P=_==g;if(P&&sN(e)){if(!sN(t))return!1;o=!0,y=!1}if(P&&!y)return a||(a=new rb),o||sX(e)?nt(e,t,i,n,s,a):function(e,t,r,i,n,s,a){switch(r){case A:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case L:return!(e.byteLength!=t.byteLength||!s(new ex(e),new ex(t)));case c:case h:case m:return sB(+e,+t);case f:return e.name==t.name&&e.message==t.message;case b:case R:return e==t+"";case p:var o=tx;case E:var l=1&i;if(o||(o=tq),e.size!=t.size&&!l)break;var u=a.get(e);if(u)return u==t;i|=2,a.set(e,t);var d=nt(o(e),o(t),i,n,s,a);return a.delete(e),d;case S:if(ru)return ru.call(e)==ru.call(t)}return!1}(e,t,_,i,n,s,a);if(!(1&i)){var B=y&&eC.call(e,"__wrapped__"),C=T&&eC.call(t,"__wrapped__");if(B||C){var w=B?e.value():e,O=C?t.value():t;return a||(a=new rb),s(w,O,i,n,a)}}return!!P&&(a||(a=new rb),function(e,t,i,n,s,a){var o=1&i,l=rK(e,au,nd),u=l.length;if(u!=rK(t,au,nd).length&&!o)return!1;for(var d=u;d--;){var c=l[d];if(!(o?c in t:eC.call(t,c)))return!1}var h=a.get(e),f=a.get(t);if(h&&f)return h==t&&f==e;var _=!0;a.set(e,t),a.set(t,e);for(var g=o;++d<u;){var p=e[c=l[d]],m=t[c];if(n)var v=o?n(m,p,c,t,e,a):n(p,m,c,e,t,a);if(!(v===r?p===m||s(p,m,i,n,a):v)){_=!1;break}g||(g="constructor"==c)}if(_&&!g){var y=e.constructor,b=t.constructor;y==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b||(_=!1)}return a.delete(e),a.delete(t),_}(e,t,i,n,s,a))}(e,t,i,n,r1,s):e!=e&&t!=t)}function r2(e,t,i,n){var s=i.length,a=s,o=!n;if(null==e)return!a;for(e=eb(e);s--;){var l=i[s];if(o&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++s<a;){var u=(l=i[s])[0],d=e[u],c=l[1];if(o&&l[2]){if(d===r&&!(u in e))return!1}else{var h=new rb;if(n)var f=n(d,c,u,e,t,h);if(!(f===r?r1(c,d,3,n,h):f))return!1}}return!0}function r3(e){return!(!sG(e)||eO&&eO in e)&&(sU(e)?eF:ed).test(nN(e))}function r8(e){return"function"==typeof e?e:null==e?aF:"object"==typeof e?sD(e)?r7(e[0],e[1]):r5(e):aj(e)}function r4(e){if(!nE(e))return tZ(e);var t=[];for(var r in eb(e))eC.call(e,r)&&"constructor"!=r&&t.push(r);return t}function r9(e,t){return e<t}function r6(e,t){var r=-1,i=sM(e)?J(e.length):[];return rF(e,function(e,n,s){i[++r]=t(e,n,s)}),i}function r5(e){var t=nl(e);return 1==t.length&&t[0][2]?nR(t[0][0],t[0][1]):function(r){return r===e||r2(r,e,t)}}function r7(e,t){var i;return nv(e)&&(i=t)==i&&!sG(i)?nR(nF(e),t):function(i){var n=an(i,e);return n===r&&n===t?as(i,e):r1(t,n,3)}}function ie(e,t,i,n,s){e!==t&&rq(t,function(a,o){if(s||(s=new rb),sG(a))!function(e,t,i,n,s,a,o){var l=nL(e,i),u=nL(t,i),d=o.get(u);if(d)return void rS(e,i,d);var c=a?a(l,u,i+"",e,t,o):r,h=c===r;if(h){var f=sD(u),_=!f&&sN(u),g=!f&&!_&&sX(u);c=u,f||_||g?sD(l)?c=l:sF(l)?c=iU(l):_?(h=!1,c=iI(u,!0)):g?(h=!1,c=iF(u,!0)):c=[]:s$(u)||sO(u)?(c=l,sO(l)?c=s4(l):sG(l)&&!sU(l)||(c=n_(u))):h=!1}h&&(o.set(u,c),s(c,u,n,a,o),o.delete(u)),rS(e,i,c)}(e,t,o,i,ie,n,s);else{var l=n?n(nL(e,o),a,o+"",e,t,s):r;l===r&&(l=a),rS(e,o,l)}},ad)}function it(e,t){var i=e.length;if(i)return np(t+=t<0?i:0,i)?e[t]:r}function ir(e,t,r){t=t.length?tc(t,function(e){return sD(e)?function(t){return r$(t,1===e.length?e[0]:e)}:e}):[aF];var i=-1;return t=tc(t,tC(na())),function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}(r6(e,function(e,r,n){return{criteria:tc(t,function(t){return t(e)}),index:++i,value:e}}),function(e,t){return function(e,t,r){for(var i=-1,n=e.criteria,s=t.criteria,a=n.length,o=r.length;++i<a;){var l=iN(n[i],s[i]);if(l)return i>=o?l:l*("desc"==r[i]?-1:1)}return e.index-t.index}(e,t,r)})}function ii(e,t,r){for(var i=-1,n=t.length,s={};++i<n;){var a=t[i],o=r$(e,a);r(o,a)&&id(s,iw(a,e),o)}return s}function is(e,t,r,i){var n=i?tb:ty,s=-1,a=t.length,o=e;for(e===t&&(t=iU(t)),r&&(o=tc(e,tC(r)));++s<a;)for(var l=0,u=t[s],d=r?r(u):u;(l=n(o,d,l,i))>-1;)o!==e&&eX.call(o,l,1),eX.call(e,l,1);return e}function ia(e,t){for(var r=e?t.length:0,i=r-1;r--;){var n=t[r];if(r==i||n!==s){var s=n;np(n)?eX.call(e,n,1):iR(e,n)}}return e}function io(e,t){return e+tK(t3()*(t-e+1))}function il(e,t){var r="";if(!e||t<1||t>0x1fffffffffffff)return r;do t%2&&(r+=e),(t=tK(t/2))&&(e+=e);while(t)return r}function iu(e,t){return nB(nS(e,t,aF),e+"")}function id(e,t,i,n){if(!sG(e))return e;for(var s=-1,a=(t=iw(t,e)).length,o=a-1,l=e;null!=l&&++s<a;){var u=nF(t[s]),d=i;if("__proto__"===u||"constructor"===u||"prototype"===u)break;if(s!=o){var c=l[u];(d=n?n(c,u,l):r)===r&&(d=sG(c)?c:np(t[s+1])?[]:{})}rT(l,u,d),l=l[u]}return e}var ic=rt?function(e,t){return rt.set(e,t),e}:aF,ih=e8?function(e,t){return e8(e,"toString",{configurable:!0,enumerable:!1,value:aD(t),writable:!0})}:aF;function i_(e,t,r){var i=-1,n=e.length;t<0&&(t=-t>n?0:n+t),(r=r>n?n:r)<0&&(r+=n),n=t>r?0:r-t>>>0,t>>>=0;for(var s=J(n);++i<n;)s[i]=e[i+t];return s}function ig(e,t){var r;return rF(e,function(e,i,n){return!(r=t(e,i,n))}),!!r}function ip(e,t,r){var i=0,n=null==e?i:e.length;if("number"==typeof t&&t==t&&n<=0x7fffffff){for(;i<n;){var s=i+n>>>1,a=e[s];null!==a&&!sz(a)&&(r?a<=t:a<t)?i=s+1:n=s}return n}return im(e,t,aF,r)}function im(e,t,i,n){var s=0,a=null==e?0:e.length;if(0===a)return 0;for(var o=(t=i(t))!=t,l=null===t,u=sz(t),d=t===r;s<a;){var c=tK((s+a)/2),h=i(e[c]),f=h!==r,_=null===h,g=h==h,p=sz(h);if(o)var m=n||g;else m=d?g&&(n||f):l?g&&f&&(n||!_):u?g&&f&&!_&&(n||!p):!_&&!p&&(n?h<=t:h<t);m?s=c+1:a=c}return t0(a,0xfffffffe)}function iv(e,t){for(var r=-1,i=e.length,n=0,s=[];++r<i;){var a=e[r],o=t?t(a):a;if(!r||!sB(o,l)){var l=o;s[n++]=0===a?0:a}}return s}function iy(e){return"number"==typeof e?e:sz(e)?o:+e}function ib(e){if("string"==typeof e)return e;if(sD(e))return tc(e,ib)+"";if(sz(e))return rd?rd.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function iE(e,t,r){var i=-1,n=tu,s=e.length,a=!0,o=[],l=o;if(r)a=!1,n=td;else if(s>=200){var u=t?null:i4(e);if(u)return tq(u);a=!1,n=tO,l=new ry}else l=t?[]:o;e:for(;++i<s;){var d=e[i],c=t?t(d):d;if(d=r||0!==d?d:0,a&&c==c){for(var h=l.length;h--;)if(l[h]===c)continue e;t&&l.push(c),o.push(d)}else n(l,c,r)||(l!==o&&l.push(c),o.push(d))}return o}function iR(e,t){return null==(e=nT(e,t=iw(t,e)))||delete e[nF(nY(t))]}function iS(e,t,r,i){return id(e,t,r(r$(e,t)),i)}function iT(e,t,r,i){for(var n=e.length,s=i?n:-1;(i?s--:++s<n)&&t(e[s],s,e););return r?i_(e,i?0:s,i?s+1:n):i_(e,i?s+1:0,i?n:s)}function iL(e,t){var r=e;return r instanceof rg&&(r=r.value()),tf(t,function(e,t){return t.func.apply(t.thisArg,th([e],t.args))},r)}function iA(e,t,r){var i=e.length;if(i<2)return i?iE(e[0]):[];for(var n=-1,s=J(i);++n<i;)for(var a=e[n],o=-1;++o<i;)o!=n&&(s[n]=rM(s[n]||a,e[o],t,r));return iE(rV(s,1),t,r)}function iP(e,t,i){for(var n=-1,s=e.length,a=t.length,o={};++n<s;){var l=n<a?t[n]:r;i(o,e[n],l)}return o}function iB(e){return sF(e)?e:[]}function iC(e){return"function"==typeof e?e:aF}function iw(e,t){return sD(e)?e:nv(e,t)?[e]:nM(s9(e))}function iO(e,t,i){var n=e.length;return i=i===r?n:i,!t&&i>=n?e:i_(e,t,i)}var iD=e9||function(e){return e2.clearTimeout(e)};function iI(e,t){if(t)return e.slice();var r=e.length,i=eU?eU(r):new e.constructor(r);return e.copy(i),i}function iM(e){var t=new e.constructor(e.byteLength);return new ex(t).set(new ex(e)),t}function iF(e,t){var r=t?iM(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function iN(e,t){if(e!==t){var i=e!==r,n=null===e,s=e==e,a=sz(e),o=t!==r,l=null===t,u=t==t,d=sz(t);if(!l&&!d&&!a&&e>t||a&&o&&u&&!l&&!d||n&&o&&u||!i&&u||!s)return 1;if(!n&&!a&&!d&&e<t||d&&i&&s&&!n&&!a||l&&i&&s||!o&&s||!u)return -1}return 0}function ik(e,t,r,i){for(var n=-1,s=e.length,a=r.length,o=-1,l=t.length,u=tJ(s-a,0),d=J(l+u),c=!i;++o<l;)d[o]=t[o];for(;++n<a;)(c||n<s)&&(d[r[n]]=e[n]);for(;u--;)d[o++]=e[n++];return d}function ix(e,t,r,i){for(var n=-1,s=e.length,a=-1,o=r.length,l=-1,u=t.length,d=tJ(s-o,0),c=J(d+u),h=!i;++n<d;)c[n]=e[n];for(var f=n;++l<u;)c[f+l]=t[l];for(;++a<o;)(h||n<s)&&(c[f+r[a]]=e[n++]);return c}function iU(e,t){var r=-1,i=e.length;for(t||(t=J(i));++r<i;)t[r]=e[r];return t}function iV(e,t,i,n){var s=!i;i||(i={});for(var a=-1,o=t.length;++a<o;){var l=t[a],u=n?n(i[l],e[l],l,i,e):r;u===r&&(u=e[l]),s?rB(i,l,u):rT(i,l,u)}return i}function iq(e,t){return function(r,i){var n=sD(r)?ts:rA,s=t?t():{};return n(r,e,na(i,2),s)}}function iG(e){return iu(function(t,i){var n=-1,s=i.length,a=s>1?i[s-1]:r,o=s>2?i[2]:r;for(a=e.length>3&&"function"==typeof a?(s--,a):r,o&&nm(i[0],i[1],o)&&(a=s<3?r:a,s=1),t=eb(t);++n<s;){var l=i[n];l&&e(t,l,n,a)}return t})}function iW(e,t){return function(r,i){if(null==r)return r;if(!sM(r))return e(r,i);for(var n=r.length,s=t?n:-1,a=eb(r);(t?s--:++s<n)&&!1!==i(a[s],s,a););return r}}function ij(e){return function(t,r,i){for(var n=-1,s=eb(t),a=i(t),o=a.length;o--;){var l=a[e?o:++n];if(!1===r(s[l],l,s))break}return t}}function iH(e){return function(t){var i=tk(t=s9(t))?tW(t):r,n=i?i[0]:t.charAt(0),s=i?iO(i,1).join(""):t.slice(1);return n[e]()+s}}function i$(e){return function(t){return tf(aC(aE(t).replace(eq,"")),e,"")}}function iK(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=rh(e.prototype),i=e.apply(r,t);return sG(i)?i:r}}function iY(e){return function(t,i,n){var s=eb(t);if(!sM(t)){var a=na(i,3);t=au(t),i=function(e){return a(s[e],e,s)}}var o=e(t,i,n);return o>-1?s[a?t[o]:o]:r}}function iQ(e){return nr(function(t){var n=t.length,s=n,a=r_.prototype.thru;for(e&&t.reverse();s--;){var o=t[s];if("function"!=typeof o)throw new eS(i);if(a&&!l&&"wrapper"==nn(o))var l=new r_([],!0)}for(s=l?s:n;++s<n;){var u=nn(o=t[s]),d="wrapper"==u?ni(o):r;l=d&&ny(d[0])&&424==d[1]&&!d[4].length&&1==d[9]?l[nn(d[0])].apply(l,d[3]):1==o.length&&ny(o)?l[u]():l.thru(o)}return function(){var e=arguments,r=e[0];if(l&&1==e.length&&sD(r))return l.plant(r).value();for(var i=0,s=n?t[i].apply(this,e):r;++i<n;)s=t[i].call(this,s);return s}})}function iz(e,t,i,n,s,a,o,l,u,d){var c=128&t,h=1&t,f=2&t,_=24&t,g=512&t,p=f?r:iK(e);return function m(){for(var v=arguments.length,y=J(v),b=v;b--;)y[b]=arguments[b];if(_)var E=ns(m),R=function(e,t){for(var r=e.length,i=0;r--;)e[r]===t&&++i;return i}(y,E);if(n&&(y=ik(y,n,s,_)),a&&(y=ix(y,a,o,_)),v-=R,_&&v<d){var S=tV(y,E);return i3(e,t,iz,m.placeholder,i,y,S,l,u,d-v)}var T=h?i:this,L=f?T[e]:e;return v=y.length,l?y=function(e,t){for(var i=e.length,n=t0(t.length,i),s=iU(e);n--;){var a=t[n];e[n]=np(a,i)?s[a]:r}return e}(y,l):g&&v>1&&y.reverse(),c&&u<v&&(y.length=u),this&&this!==e2&&this instanceof m&&(L=p||iK(L)),L.apply(T,y)}}function iX(e,t){return function(r,i){var n,s;return n=t(i),s={},rW(r,function(t,r,i){e(s,n(t),r,i)}),s}}function iZ(e,t){return function(i,n){var s;if(i===r&&n===r)return t;if(i!==r&&(s=i),n!==r){if(s===r)return n;"string"==typeof i||"string"==typeof n?(i=ib(i),n=ib(n)):(i=iy(i),n=iy(n)),s=e(i,n)}return s}}function iJ(e){return nr(function(t){return t=tc(t,tC(na())),iu(function(r){var i=this;return e(t,function(e){return tn(e,i,r)})})})}function i0(e,t){var i=(t=t===r?" ":ib(t)).length;if(i<2)return i?il(t,e):t;var n=il(t,tT(e/tG(t)));return tk(t)?iO(tW(n),0,e).join(""):n.slice(0,e)}function i1(e){return function(t,i,n){return n&&"number"!=typeof n&&nm(t,i,n)&&(i=n=r),t=s1(t),i===r?(i=t,t=0):i=s1(i),function(e,t,r,i){for(var n=-1,s=tJ(tT((t-e)/(r||1)),0),a=J(s);s--;)a[i?s:++n]=e,e+=r;return a}(t,i,n=n===r?t<i?1:-1:s1(n),e)}}function i2(e){return function(t,r){return"string"==typeof t&&"string"==typeof r||(t=s8(t),r=s8(r)),e(t,r)}}function i3(e,t,i,n,s,a,o,l,u,d){var c=8&t;t|=c?32:64,4&(t&=~(c?64:32))||(t&=-4);var h=[e,t,s,c?a:r,c?o:r,c?r:a,c?r:o,l,u,d],f=i.apply(r,h);return ny(e)&&nA(f,h),f.placeholder=n,nC(f,e,t)}function i8(e){var t=ey[e];return function(e,r){if(e=s8(e),(r=null==r?0:t0(s2(r),292))&&tz(e)){var i=(s9(e)+"e").split("e");return+((i=(s9(t(i[0]+"e"+(+i[1]+r)))+"e").split("e"))[0]+"e"+(+i[1]-r))}return t(e)}}var i4=t5&&1/tq(new t5([,-0]))[1]==a?function(e){return new t5(e)}:aV;function i9(e){return function(t){var r,i,n=nh(t);return n==p?tx(t):n==E?(r=-1,i=Array(t.size),t.forEach(function(e){i[++r]=[e,e]}),i):tc(e(t),function(e){return[e,t[e]]})}}function i6(e,t,n,a,o,l,u,d){var c=2&t;if(!c&&"function"!=typeof e)throw new eS(i);var h=a?a.length:0;if(h||(t&=-97,a=o=r),u=u===r?u:tJ(s2(u),0),d=d===r?d:s2(d),h-=o?o.length:0,64&t){var f=a,_=o;a=o=r}var g=c?r:ni(e),p=[e,t,n,a,o,f,_,l,u,d];if(g&&function(e,t){var r=e[1],i=t[1],n=r|i,a=n<131,o=128==i&&8==r||128==i&&256==r&&e[7].length<=t[8]||384==i&&t[7].length<=t[8]&&8==r;if(a||o){1&i&&(e[2]=t[2],n|=1&r?0:4);var l=t[3];if(l){var u=e[3];e[3]=u?ik(u,l,t[4]):l,e[4]=u?tV(e[3],s):t[4]}(l=t[5])&&(u=e[5],e[5]=u?ix(u,l,t[6]):l,e[6]=u?tV(e[5],s):t[6]),(l=t[7])&&(e[7]=l),128&i&&(e[8]=null==e[8]?t[8]:t0(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=n}}(p,g),e=p[0],t=p[1],n=p[2],a=p[3],o=p[4],(d=p[9]=p[9]===r?c?0:e.length:tJ(p[9]-h,0))||!(24&t)||(t&=-25),t&&1!=t)D=8==t||16==t?(m=e,v=t,y=d,b=iK(m),function e(){for(var t=arguments.length,i=J(t),n=t,s=ns(e);n--;)i[n]=arguments[n];var a=t<3&&i[0]!==s&&i[t-1]!==s?[]:tV(i,s);return(t-=a.length)<y?i3(m,v,iz,e.placeholder,r,i,a,r,r,y-t):tn(this&&this!==e2&&this instanceof e?b:m,this,i)}):32!=t&&33!=t||o.length?iz.apply(r,p):(E=e,R=t,S=n,T=a,L=1&R,A=iK(E),function e(){for(var t=-1,r=arguments.length,i=-1,n=T.length,s=J(n+r),a=this&&this!==e2&&this instanceof e?A:E;++i<n;)s[i]=T[i];for(;r--;)s[i++]=arguments[++t];return tn(a,L?S:this,s)});else var m,v,y,b,E,R,S,T,L,A,P,B,C,w,O,D=(P=e,B=t,C=n,w=1&B,O=iK(P),function e(){return(this&&this!==e2&&this instanceof e?O:P).apply(w?C:this,arguments)});return nC((g?ic:nA)(D,p),e,t)}function i5(e,t,i,n){return e===r||sB(e,eA[i])&&!eC.call(n,i)?t:e}function i7(e,t,i,n,s,a){return sG(e)&&sG(t)&&(a.set(t,e),ie(e,t,r,i7,a),a.delete(t)),e}function ne(e){return s$(e)?r:e}function nt(e,t,i,n,s,a){var o=1&i,l=e.length,u=t.length;if(l!=u&&!(o&&u>l))return!1;var d=a.get(e),c=a.get(t);if(d&&c)return d==t&&c==e;var h=-1,f=!0,_=2&i?new ry:r;for(a.set(e,t),a.set(t,e);++h<l;){var g=e[h],p=t[h];if(n)var m=o?n(p,g,h,t,e,a):n(g,p,h,e,t,a);if(m!==r){if(m)continue;f=!1;break}if(_){if(!tg(t,function(e,t){if(!tO(_,t)&&(g===e||s(g,e,i,n,a)))return _.push(t)})){f=!1;break}}else if(g!==p&&!s(g,p,i,n,a)){f=!1;break}}return a.delete(e),a.delete(t),f}function nr(e){return nB(nS(e,r,nW),e+"")}var ni=rt?function(e){return rt.get(e)}:aV;function nn(e){for(var t=e.name+"",r=rr[t],i=eC.call(rr,t)?r.length:0;i--;){var n=r[i],s=n.func;if(null==s||s==e)return n.name}return t}function ns(e){return(eC.call(rc,"placeholder")?rc:e).placeholder}function na(){var e=rc.iteratee||aN;return e=e===aN?r8:e,arguments.length?e(arguments[0],arguments[1]):e}function no(e,t){var r,i=e.__data__;return("string"==(r=typeof t)||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t)?i["string"==typeof t?"string":"hash"]:i.map}function nl(e){for(var t=au(e),r=t.length;r--;){var i=t[r],n=e[i];t[r]=[i,n,n==n&&!sG(n)]}return t}function nu(e,t){var i=null==e?r:e[t];return r3(i)?i:r}var nd=tY?function(e){return null==e?[]:tl(tY(e=eb(e)),function(t){return eH.call(e,t)})}:aK,nc=tY?function(e){for(var t=[];e;)th(t,nd(e)),e=eV(e);return t}:aK,nh=rY;function nf(e,t,r){for(var i=-1,n=(t=iw(t,e)).length,s=!1;++i<n;){var a=nF(t[i]);if(!(s=null!=e&&r(e,a)))break;e=e[a]}return s||++i!=n?s:!!(n=null==e?0:e.length)&&sq(n)&&np(a,n)&&(sD(e)||sO(e))}function n_(e){return"function"!=typeof e.constructor||nE(e)?{}:rh(eV(e))}function ng(e){return sD(e)||sO(e)||!!(e0&&e&&e[e0])}function np(e,t){var r=typeof e;return!!(t=null==t?0x1fffffffffffff:t)&&("number"==r||"symbol"!=r&&eh.test(e))&&e>-1&&e%1==0&&e<t}function nm(e,t,r){if(!sG(r))return!1;var i=typeof t;return!!("number"==i?sM(r)&&np(t,r.length):"string"==i&&t in r)&&sB(r[t],e)}function nv(e,t){if(sD(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!sz(e))||K.test(e)||!$.test(e)||null!=t&&e in eb(t)}function ny(e){var t=nn(e),r=rc[t];if("function"!=typeof r||!(t in rg.prototype))return!1;if(e===r)return!0;var i=ni(r);return!!i&&e===i[0]}(t4&&nh(new t4(new ArrayBuffer(1)))!=A||t9&&nh(new t9)!=p||t6&&nh(t6.resolve())!=y||t5&&nh(new t5)!=E||t7&&nh(new t7)!=T)&&(nh=function(e){var t=rY(e),i=t==v?e.constructor:r,n=i?nN(i):"";if(n)switch(n){case ri:return A;case rn:return p;case rs:return y;case ra:return E;case ro:return T}return t});var nb=eP?sU:aY;function nE(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||eA)}function nR(e,t){return function(i){return null!=i&&i[e]===t&&(t!==r||e in eb(i))}}function nS(e,t,i){return t=tJ(t===r?e.length-1:t,0),function(){for(var r=arguments,n=-1,s=tJ(r.length-t,0),a=J(s);++n<s;)a[n]=r[t+n];n=-1;for(var o=J(t+1);++n<t;)o[n]=r[n];return o[t]=i(a),tn(e,this,o)}}function nT(e,t){return t.length<2?e:r$(e,i_(t,0,-1))}function nL(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var nA=nw(ic),nP=tp||function(e,t){return e2.setTimeout(e,t)},nB=nw(ih);function nC(e,t,r){var i,n,s=t+"";return nB(e,function(e,t){var r=t.length;if(!r)return e;var i=r-1;return t[i]=(r>1?"& ":"")+t[i],t=t.join(r>2?", ":" "),e.replace(ee,"{\n/* [wrapped with "+t+"] */\n")}(s,(n=(i=s.match(et))?i[1].split(er):[],ta(l,function(e){var t="_."+e[0];r&e[1]&&!tu(n,t)&&n.push(t)}),n.sort())))}function nw(e){var t=0,i=0;return function(){var n=t1(),s=16-(n-i);if(i=n,s>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(r,arguments)}}function nO(e,t){var i=-1,n=e.length,s=n-1;for(t=t===r?n:t;++i<t;){var a=io(i,s),o=e[a];e[a]=e[i],e[i]=o}return e.length=t,e}var nD,nI,nM=(nI=(nD=sR(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Y,function(e,r,i,n){t.push(i?n.replace(es,"$1"):r||e)}),t},function(e){return 500===nI.size&&nI.clear(),e})).cache,nD);function nF(e){if("string"==typeof e||sz(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function nN(e){if(null!=e){try{return eB.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function nk(e){if(e instanceof rg)return e.clone();var t=new r_(e.__wrapped__,e.__chain__);return t.__actions__=iU(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var nx=iu(function(e,t){return sF(e)?rM(e,rV(t,1,sF,!0)):[]}),nU=iu(function(e,t){var i=nY(t);return sF(i)&&(i=r),sF(e)?rM(e,rV(t,1,sF,!0),na(i,2)):[]}),nV=iu(function(e,t){var i=nY(t);return sF(i)&&(i=r),sF(e)?rM(e,rV(t,1,sF,!0),r,i):[]});function nq(e,t,r){var i=null==e?0:e.length;if(!i)return -1;var n=null==r?0:s2(r);return n<0&&(n=tJ(i+n,0)),tv(e,na(t,3),n)}function nG(e,t,i){var n=null==e?0:e.length;if(!n)return -1;var s=n-1;return i!==r&&(s=s2(i),s=i<0?tJ(n+s,0):t0(s,n-1)),tv(e,na(t,3),s,!0)}function nW(e){return(null==e?0:e.length)?rV(e,1):[]}function nj(e){return e&&e.length?e[0]:r}var nH=iu(function(e){var t=tc(e,iB);return t.length&&t[0]===e[0]?rZ(t):[]}),n$=iu(function(e){var t=nY(e),i=tc(e,iB);return t===nY(i)?t=r:i.pop(),i.length&&i[0]===e[0]?rZ(i,na(t,2)):[]}),nK=iu(function(e){var t=nY(e),i=tc(e,iB);return(t="function"==typeof t?t:r)&&i.pop(),i.length&&i[0]===e[0]?rZ(i,r,t):[]});function nY(e){var t=null==e?0:e.length;return t?e[t-1]:r}var nQ=iu(nz);function nz(e,t){return e&&e.length&&t&&t.length?is(e,t):e}var nX=nr(function(e,t){var r=null==e?0:e.length,i=rC(e,t);return ia(e,tc(t,function(e){return np(e,r)?+e:e}).sort(iN)),i});function nZ(e){return null==e?e:t8.call(e)}var nJ=iu(function(e){return iE(rV(e,1,sF,!0))}),n0=iu(function(e){var t=nY(e);return sF(t)&&(t=r),iE(rV(e,1,sF,!0),na(t,2))}),n1=iu(function(e){var t=nY(e);return t="function"==typeof t?t:r,iE(rV(e,1,sF,!0),r,t)});function n2(e){if(!e||!e.length)return[];var t=0;return e=tl(e,function(e){if(sF(e))return t=tJ(e.length,t),!0}),tP(t,function(t){return tc(e,tS(t))})}function n3(e,t){if(!e||!e.length)return[];var i=n2(e);return null==t?i:tc(i,function(e){return tn(t,r,e)})}var n8=iu(function(e,t){return sF(e)?rM(e,t):[]}),n4=iu(function(e){return iA(tl(e,sF))}),n9=iu(function(e){var t=nY(e);return sF(t)&&(t=r),iA(tl(e,sF),na(t,2))}),n6=iu(function(e){var t=nY(e);return t="function"==typeof t?t:r,iA(tl(e,sF),r,t)}),n5=iu(n2),n7=iu(function(e){var t=e.length,i=t>1?e[t-1]:r;return i="function"==typeof i?(e.pop(),i):r,n3(e,i)});function se(e){var t=rc(e);return t.__chain__=!0,t}function st(e,t){return t(e)}var sr=nr(function(e){var t=e.length,i=t?e[0]:0,n=this.__wrapped__,s=function(t){return rC(t,e)};return!(t>1||this.__actions__.length)&&n instanceof rg&&np(i)?((n=n.slice(i,+i+ +!!t)).__actions__.push({func:st,args:[s],thisArg:r}),new r_(n,this.__chain__).thru(function(e){return t&&!e.length&&e.push(r),e})):this.thru(s)}),si=iq(function(e,t,r){eC.call(e,r)?++e[r]:rB(e,r,1)}),sn=iY(nq),ss=iY(nG);function sa(e,t){return(sD(e)?ta:rF)(e,na(t,3))}function so(e,t){return(sD(e)?function(e,t){for(var r=null==e?0:e.length;r--&&!1!==t(e[r],r,e););return e}:rN)(e,na(t,3))}var sl=iq(function(e,t,r){eC.call(e,r)?e[r].push(t):rB(e,r,[t])}),su=iu(function(e,t,r){var i=-1,n="function"==typeof t,s=sM(e)?J(e.length):[];return rF(e,function(e){s[++i]=n?tn(t,e,r):rJ(e,t,r)}),s}),sd=iq(function(e,t,r){rB(e,r,t)});function sc(e,t){return(sD(e)?tc:r6)(e,na(t,3))}var sh=iq(function(e,t,r){e[+!r].push(t)},function(){return[[],[]]}),sf=iu(function(e,t){if(null==e)return[];var r=t.length;return r>1&&nm(e,t[0],t[1])?t=[]:r>2&&nm(t[0],t[1],t[2])&&(t=[t[0]]),ir(e,rV(t,1),[])}),s_=e6||function(){return e2.Date.now()};function sg(e,t,i){return t=i?r:t,t=e&&null==t?e.length:t,i6(e,128,r,r,r,r,t)}function sp(e,t){var n;if("function"!=typeof t)throw new eS(i);return e=s2(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=r),n}}var sm=iu(function(e,t,r){var i=1;if(r.length){var n=tV(r,ns(sm));i|=32}return i6(e,i,t,r,n)}),sv=iu(function(e,t,r){var i=3;if(r.length){var n=tV(r,ns(sv));i|=32}return i6(t,i,e,r,n)});function sy(e,t,n){var s,a,o,l,u,d,c=0,h=!1,f=!1,_=!0;if("function"!=typeof e)throw new eS(i);function g(t){var i=s,n=a;return s=a=r,c=t,l=e.apply(n,i)}function p(e){var i=e-d;return d===r||i>=t||i<0||f&&e-c>=o}function m(){var e,r=s_();if(p(r))return v(r);u=nP(m,(e=t-(r-d),f?t0(e,o-(r-c)):e))}function v(e){return u=r,_&&s?g(e):(s=a=r,l)}function y(){var e,i=s_(),n=p(i);if(s=arguments,a=this,d=i,n){if(u===r)return c=e=d,u=nP(m,t),h?g(e):l;if(f)return iD(u),u=nP(m,t),g(d)}return u===r&&(u=nP(m,t)),l}return t=s8(t)||0,sG(n)&&(h=!!n.leading,o=(f="maxWait"in n)?tJ(s8(n.maxWait)||0,t):o,_="trailing"in n?!!n.trailing:_),y.cancel=function(){u!==r&&iD(u),c=0,s=d=a=u=r},y.flush=function(){return u===r?l:v(s_())},y}var sb=iu(function(e,t){return rI(e,1,t)}),sE=iu(function(e,t,r){return rI(e,s8(t)||0,r)});function sR(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new eS(i);var r=function(){var i=arguments,n=t?t.apply(this,i):i[0],s=r.cache;if(s.has(n))return s.get(n);var a=e.apply(this,i);return r.cache=s.set(n,a)||s,a};return r.cache=new(sR.Cache||rv),r}function sS(e){if("function"!=typeof e)throw new eS(i);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}sR.Cache=rv;var sT=iu(function(e,t){var r=(t=1==t.length&&sD(t[0])?tc(t[0],tC(na())):tc(rV(t,1),tC(na()))).length;return iu(function(i){for(var n=-1,s=t0(i.length,r);++n<s;)i[n]=t[n].call(this,i[n]);return tn(e,this,i)})}),sL=iu(function(e,t){var i=tV(t,ns(sL));return i6(e,32,r,t,i)}),sA=iu(function(e,t){var i=tV(t,ns(sA));return i6(e,64,r,t,i)}),sP=nr(function(e,t){return i6(e,256,r,r,r,t)});function sB(e,t){return e===t||e!=e&&t!=t}var sC=i2(rQ),sw=i2(function(e,t){return e>=t}),sO=r0(function(){return arguments}())?r0:function(e){return sW(e)&&eC.call(e,"callee")&&!eH.call(e,"callee")},sD=J.isArray,sI=e5?tC(e5):function(e){return sW(e)&&rY(e)==L};function sM(e){return null!=e&&sq(e.length)&&!sU(e)}function sF(e){return sW(e)&&sM(e)}var sN=tQ||aY,sk=e7?tC(e7):function(e){return sW(e)&&rY(e)==h};function sx(e){if(!sW(e))return!1;var t=rY(e);return t==f||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!s$(e)}function sU(e){if(!sG(e))return!1;var t=rY(e);return t==_||t==g||"[object AsyncFunction]"==t||"[object Proxy]"==t}function sV(e){return"number"==typeof e&&e==s2(e)}function sq(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=0x1fffffffffffff}function sG(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function sW(e){return null!=e&&"object"==typeof e}var sj=te?tC(te):function(e){return sW(e)&&nh(e)==p};function sH(e){return"number"==typeof e||sW(e)&&rY(e)==m}function s$(e){if(!sW(e)||rY(e)!=v)return!1;var t=eV(e);if(null===t)return!0;var r=eC.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&eB.call(r)==eI}var sK=tt?tC(tt):function(e){return sW(e)&&rY(e)==b},sY=tr?tC(tr):function(e){return sW(e)&&nh(e)==E};function sQ(e){return"string"==typeof e||!sD(e)&&sW(e)&&rY(e)==R}function sz(e){return"symbol"==typeof e||sW(e)&&rY(e)==S}var sX=ti?tC(ti):function(e){return sW(e)&&sq(e.length)&&!!eQ[rY(e)]},sZ=i2(r9),sJ=i2(function(e,t){return e<=t});function s0(e){if(!e)return[];if(sM(e))return sQ(e)?tW(e):iU(e);if(e1&&e[e1])return function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}(e[e1]());var t=nh(e);return(t==p?tx:t==E?tq:av)(e)}function s1(e){return e?(e=s8(e))===a||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function s2(e){var t=s1(e),r=t%1;return t==t?r?t-r:t:0}function s3(e){return e?rw(s2(e),0,0xffffffff):0}function s8(e){if("number"==typeof e)return e;if(sz(e))return o;if(sG(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=sG(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=tB(e);var r=eu.test(e);return r||ec.test(e)?eJ(e.slice(2),r?2:8):el.test(e)?o:+e}function s4(e){return iV(e,ad(e))}function s9(e){return null==e?"":ib(e)}var s6=iG(function(e,t){if(nE(t)||sM(t))iV(t,au(t),e);else for(var r in t)eC.call(t,r)&&rT(e,r,t[r])}),s5=iG(function(e,t){iV(t,ad(t),e)}),s7=iG(function(e,t,r,i){iV(t,ad(t),e,i)}),ae=iG(function(e,t,r,i){iV(t,au(t),e,i)}),at=nr(rC),ar=iu(function(e,t){e=eb(e);var i=-1,n=t.length,s=n>2?t[2]:r;for(s&&nm(t[0],t[1],s)&&(n=1);++i<n;)for(var a=t[i],o=ad(a),l=-1,u=o.length;++l<u;){var d=o[l],c=e[d];(c===r||sB(c,eA[d])&&!eC.call(e,d))&&(e[d]=a[d])}return e}),ai=iu(function(e){return e.push(r,i7),tn(ah,r,e)});function an(e,t,i){var n=null==e?r:r$(e,t);return n===r?i:n}function as(e,t){return null!=e&&nf(e,t,rX)}var aa=iX(function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=eD.call(t)),e[t]=r},aD(aF)),ao=iX(function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=eD.call(t)),eC.call(e,t)?e[t].push(r):e[t]=[r]},na),al=iu(rJ);function au(e){return sM(e)?rE(e):r4(e)}function ad(e){return sM(e)?rE(e,!0):function(e){if(!sG(e))return function(e){var t=[];if(null!=e)for(var r in eb(e))t.push(r);return t}(e);var t=nE(e),r=[];for(var i in e)("constructor"!=i||!t&&eC.call(e,i))&&r.push(i);return r}(e)}var ac=iG(function(e,t,r){ie(e,t,r)}),ah=iG(function(e,t,r,i){ie(e,t,r,i)}),af=nr(function(e,t){var r={};if(null==e)return r;var i=!1;t=tc(t,function(t){return t=iw(t,e),i||(i=t.length>1),t}),iV(e,rK(e,ad,nc),r),i&&(r=rO(r,7,ne));for(var n=t.length;n--;)iR(r,t[n]);return r}),a_=nr(function(e,t){return null==e?{}:ii(e,t,function(t,r){return as(e,r)})});function ag(e,t){if(null==e)return{};var r=tc(rK(e,ad,nc),function(e){return[e]});return t=na(t),ii(e,r,function(e,r){return t(e,r[0])})}var ap=i9(au),am=i9(ad);function av(e){return null==e?[]:tw(e,au(e))}var ay=i$(function(e,t,r){return t=t.toLowerCase(),e+(r?ab(t):t)});function ab(e){return aB(s9(e).toLowerCase())}function aE(e){return(e=s9(e))&&e.replace(ef,tM).replace(eG,"")}var aR=i$(function(e,t,r){return e+(r?"-":"")+t.toLowerCase()}),aS=i$(function(e,t,r){return e+(r?" ":"")+t.toLowerCase()}),aT=iH("toLowerCase"),aL=i$(function(e,t,r){return e+(r?"_":"")+t.toLowerCase()}),aA=i$(function(e,t,r){return e+(r?" ":"")+aB(t)}),aP=i$(function(e,t,r){return e+(r?" ":"")+t.toUpperCase()}),aB=iH("toUpperCase");function aC(e,t,i){var n;return e=s9(e),(t=i?r:t)===r?(n=e,e$.test(n))?e.match(ej)||[]:e.match(ei)||[]:e.match(t)||[]}var aw=iu(function(e,t){try{return tn(e,r,t)}catch(e){return sx(e)?e:new em(e)}}),aO=nr(function(e,t){return ta(t,function(t){rB(e,t=nF(t),sm(e[t],e))}),e});function aD(e){return function(){return e}}var aI=iQ(),aM=iQ(!0);function aF(e){return e}function aN(e){return r8("function"==typeof e?e:rO(e,1))}var ak=iu(function(e,t){return function(r){return rJ(r,e,t)}}),ax=iu(function(e,t){return function(r){return rJ(e,r,t)}});function aU(e,t,r){var i=au(t),n=rH(t,i);null!=r||sG(t)&&(n.length||!i.length)||(r=t,t=e,e=this,n=rH(t,au(t)));var s=!(sG(r)&&"chain"in r&&!r.chain),a=sU(e);return ta(n,function(r){var i=t[r];e[r]=i,a&&(e.prototype[r]=function(){var t=this.__chain__;if(s||t){var r=e(this.__wrapped__);return(r.__actions__=iU(this.__actions__)).push({func:i,args:arguments,thisArg:e}),r.__chain__=t,r}return i.apply(e,th([this.value()],arguments))})}),e}function aV(){}var aq=iJ(tc),aG=iJ(to),aW=iJ(tg);function aj(e){return nv(e)?tS(nF(e)):function(t){return r$(t,e)}}var aH=i1(),a$=i1(!0);function aK(){return[]}function aY(){return!1}var aQ,az=iZ(function(e,t){return e+t},0),aX=i8("ceil"),aZ=iZ(function(e,t){return e/t},1),aJ=i8("floor"),a0=iZ(function(e,t){return e*t},1),a1=i8("round"),a2=iZ(function(e,t){return e-t},0);return rc.after=function(e,t){if("function"!=typeof t)throw new eS(i);return e=s2(e),function(){if(--e<1)return t.apply(this,arguments)}},rc.ary=sg,rc.assign=s6,rc.assignIn=s5,rc.assignInWith=s7,rc.assignWith=ae,rc.at=at,rc.before=sp,rc.bind=sm,rc.bindAll=aO,rc.bindKey=sv,rc.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return sD(e)?e:[e]},rc.chain=se,rc.chunk=function(e,t,i){t=(i?nm(e,t,i):t===r)?1:tJ(s2(t),0);var n=null==e?0:e.length;if(!n||t<1)return[];for(var s=0,a=0,o=J(tT(n/t));s<n;)o[a++]=i_(e,s,s+=t);return o},rc.compact=function(e){for(var t=-1,r=null==e?0:e.length,i=0,n=[];++t<r;){var s=e[t];s&&(n[i++]=s)}return n},rc.concat=function(){var e=arguments.length;if(!e)return[];for(var t=J(e-1),r=arguments[0],i=e;i--;)t[i-1]=arguments[i];return th(sD(r)?iU(r):[r],rV(t,1))},rc.cond=function(e){var t=null==e?0:e.length,r=na();return e=t?tc(e,function(e){if("function"!=typeof e[1])throw new eS(i);return[r(e[0]),e[1]]}):[],iu(function(r){for(var i=-1;++i<t;){var n=e[i];if(tn(n[0],this,r))return tn(n[1],this,r)}})},rc.conforms=function(e){var t,r;return r=au(t=rO(e,1)),function(e){return rD(e,t,r)}},rc.constant=aD,rc.countBy=si,rc.create=function(e,t){var r=rh(e);return null==t?r:rP(r,t)},rc.curry=function e(t,i,n){var s=i6(t,8,r,r,r,r,r,i=n?r:i);return s.placeholder=e.placeholder,s},rc.curryRight=function e(t,i,n){var s=i6(t,16,r,r,r,r,r,i=n?r:i);return s.placeholder=e.placeholder,s},rc.debounce=sy,rc.defaults=ar,rc.defaultsDeep=ai,rc.defer=sb,rc.delay=sE,rc.difference=nx,rc.differenceBy=nU,rc.differenceWith=nV,rc.drop=function(e,t,i){var n=null==e?0:e.length;return n?i_(e,(t=i||t===r?1:s2(t))<0?0:t,n):[]},rc.dropRight=function(e,t,i){var n=null==e?0:e.length;return n?i_(e,0,(t=n-(t=i||t===r?1:s2(t)))<0?0:t):[]},rc.dropRightWhile=function(e,t){return e&&e.length?iT(e,na(t,3),!0,!0):[]},rc.dropWhile=function(e,t){return e&&e.length?iT(e,na(t,3),!0):[]},rc.fill=function(e,t,i,n){var s=null==e?0:e.length;return s?(i&&"number"!=typeof i&&nm(e,t,i)&&(i=0,n=s),function(e,t,i,n){var s=e.length;for((i=s2(i))<0&&(i=-i>s?0:s+i),(n=n===r||n>s?s:s2(n))<0&&(n+=s),n=i>n?0:s3(n);i<n;)e[i++]=t;return e}(e,t,i,n)):[]},rc.filter=function(e,t){return(sD(e)?tl:rU)(e,na(t,3))},rc.flatMap=function(e,t){return rV(sc(e,t),1)},rc.flatMapDeep=function(e,t){return rV(sc(e,t),a)},rc.flatMapDepth=function(e,t,i){return i=i===r?1:s2(i),rV(sc(e,t),i)},rc.flatten=nW,rc.flattenDeep=function(e){return(null==e?0:e.length)?rV(e,a):[]},rc.flattenDepth=function(e,t){return(null==e?0:e.length)?rV(e,t=t===r?1:s2(t)):[]},rc.flip=function(e){return i6(e,512)},rc.flow=aI,rc.flowRight=aM,rc.fromPairs=function(e){for(var t=-1,r=null==e?0:e.length,i={};++t<r;){var n=e[t];i[n[0]]=n[1]}return i},rc.functions=function(e){return null==e?[]:rH(e,au(e))},rc.functionsIn=function(e){return null==e?[]:rH(e,ad(e))},rc.groupBy=sl,rc.initial=function(e){return(null==e?0:e.length)?i_(e,0,-1):[]},rc.intersection=nH,rc.intersectionBy=n$,rc.intersectionWith=nK,rc.invert=aa,rc.invertBy=ao,rc.invokeMap=su,rc.iteratee=aN,rc.keyBy=sd,rc.keys=au,rc.keysIn=ad,rc.map=sc,rc.mapKeys=function(e,t){var r={};return t=na(t,3),rW(e,function(e,i,n){rB(r,t(e,i,n),e)}),r},rc.mapValues=function(e,t){var r={};return t=na(t,3),rW(e,function(e,i,n){rB(r,i,t(e,i,n))}),r},rc.matches=function(e){return r5(rO(e,1))},rc.matchesProperty=function(e,t){return r7(e,rO(t,1))},rc.memoize=sR,rc.merge=ac,rc.mergeWith=ah,rc.method=ak,rc.methodOf=ax,rc.mixin=aU,rc.negate=sS,rc.nthArg=function(e){return e=s2(e),iu(function(t){return it(t,e)})},rc.omit=af,rc.omitBy=function(e,t){return ag(e,sS(na(t)))},rc.once=function(e){return sp(2,e)},rc.orderBy=function(e,t,i,n){return null==e?[]:(sD(t)||(t=null==t?[]:[t]),sD(i=n?r:i)||(i=null==i?[]:[i]),ir(e,t,i))},rc.over=aq,rc.overArgs=sT,rc.overEvery=aG,rc.overSome=aW,rc.partial=sL,rc.partialRight=sA,rc.partition=sh,rc.pick=a_,rc.pickBy=ag,rc.property=aj,rc.propertyOf=function(e){return function(t){return null==e?r:r$(e,t)}},rc.pull=nQ,rc.pullAll=nz,rc.pullAllBy=function(e,t,r){return e&&e.length&&t&&t.length?is(e,t,na(r,2)):e},rc.pullAllWith=function(e,t,i){return e&&e.length&&t&&t.length?is(e,t,r,i):e},rc.pullAt=nX,rc.range=aH,rc.rangeRight=a$,rc.rearg=sP,rc.reject=function(e,t){return(sD(e)?tl:rU)(e,sS(na(t,3)))},rc.remove=function(e,t){var r=[];if(!e||!e.length)return r;var i=-1,n=[],s=e.length;for(t=na(t,3);++i<s;){var a=e[i];t(a,i,e)&&(r.push(a),n.push(i))}return ia(e,n),r},rc.rest=function(e,t){if("function"!=typeof e)throw new eS(i);return iu(e,t=t===r?t:s2(t))},rc.reverse=nZ,rc.sampleSize=function(e,t,i){return t=(i?nm(e,t,i):t===r)?1:s2(t),(sD(e)?function(e,t){return nO(iU(e),rw(t,0,e.length))}:function(e,t){var r=av(e);return nO(r,rw(t,0,r.length))})(e,t)},rc.set=function(e,t,r){return null==e?e:id(e,t,r)},rc.setWith=function(e,t,i,n){return n="function"==typeof n?n:r,null==e?e:id(e,t,i,n)},rc.shuffle=function(e){return(sD(e)?function(e){return nO(iU(e))}:function(e){return nO(av(e))})(e)},rc.slice=function(e,t,i){var n=null==e?0:e.length;return n?(i&&"number"!=typeof i&&nm(e,t,i)?(t=0,i=n):(t=null==t?0:s2(t),i=i===r?n:s2(i)),i_(e,t,i)):[]},rc.sortBy=sf,rc.sortedUniq=function(e){return e&&e.length?iv(e):[]},rc.sortedUniqBy=function(e,t){return e&&e.length?iv(e,na(t,2)):[]},rc.split=function(e,t,i){return i&&"number"!=typeof i&&nm(e,t,i)&&(t=i=r),(i=i===r?0xffffffff:i>>>0)?(e=s9(e))&&("string"==typeof t||null!=t&&!sK(t))&&!(t=ib(t))&&tk(e)?iO(tW(e),0,i):e.split(t,i):[]},rc.spread=function(e,t){if("function"!=typeof e)throw new eS(i);return t=null==t?0:tJ(s2(t),0),iu(function(r){var i=r[t],n=iO(r,0,t);return i&&th(n,i),tn(e,this,n)})},rc.tail=function(e){var t=null==e?0:e.length;return t?i_(e,1,t):[]},rc.take=function(e,t,i){return e&&e.length?i_(e,0,(t=i||t===r?1:s2(t))<0?0:t):[]},rc.takeRight=function(e,t,i){var n=null==e?0:e.length;return n?i_(e,(t=n-(t=i||t===r?1:s2(t)))<0?0:t,n):[]},rc.takeRightWhile=function(e,t){return e&&e.length?iT(e,na(t,3),!1,!0):[]},rc.takeWhile=function(e,t){return e&&e.length?iT(e,na(t,3)):[]},rc.tap=function(e,t){return t(e),e},rc.throttle=function(e,t,r){var n=!0,s=!0;if("function"!=typeof e)throw new eS(i);return sG(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),sy(e,t,{leading:n,maxWait:t,trailing:s})},rc.thru=st,rc.toArray=s0,rc.toPairs=ap,rc.toPairsIn=am,rc.toPath=function(e){return sD(e)?tc(e,nF):sz(e)?[e]:iU(nM(s9(e)))},rc.toPlainObject=s4,rc.transform=function(e,t,r){var i=sD(e),n=i||sN(e)||sX(e);if(t=na(t,4),null==r){var s=e&&e.constructor;r=n?i?new s:[]:sG(e)&&sU(s)?rh(eV(e)):{}}return(n?ta:rW)(e,function(e,i,n){return t(r,e,i,n)}),r},rc.unary=function(e){return sg(e,1)},rc.union=nJ,rc.unionBy=n0,rc.unionWith=n1,rc.uniq=function(e){return e&&e.length?iE(e):[]},rc.uniqBy=function(e,t){return e&&e.length?iE(e,na(t,2)):[]},rc.uniqWith=function(e,t){return t="function"==typeof t?t:r,e&&e.length?iE(e,r,t):[]},rc.unset=function(e,t){return null==e||iR(e,t)},rc.unzip=n2,rc.unzipWith=n3,rc.update=function(e,t,r){return null==e?e:iS(e,t,iC(r))},rc.updateWith=function(e,t,i,n){return n="function"==typeof n?n:r,null==e?e:iS(e,t,iC(i),n)},rc.values=av,rc.valuesIn=function(e){return null==e?[]:tw(e,ad(e))},rc.without=n8,rc.words=aC,rc.wrap=function(e,t){return sL(iC(t),e)},rc.xor=n4,rc.xorBy=n9,rc.xorWith=n6,rc.zip=n5,rc.zipObject=function(e,t){return iP(e||[],t||[],rT)},rc.zipObjectDeep=function(e,t){return iP(e||[],t||[],id)},rc.zipWith=n7,rc.entries=ap,rc.entriesIn=am,rc.extend=s5,rc.extendWith=s7,aU(rc,rc),rc.add=az,rc.attempt=aw,rc.camelCase=ay,rc.capitalize=ab,rc.ceil=aX,rc.clamp=function(e,t,i){return i===r&&(i=t,t=r),i!==r&&(i=(i=s8(i))==i?i:0),t!==r&&(t=(t=s8(t))==t?t:0),rw(s8(e),t,i)},rc.clone=function(e){return rO(e,4)},rc.cloneDeep=function(e){return rO(e,5)},rc.cloneDeepWith=function(e,t){return rO(e,5,t="function"==typeof t?t:r)},rc.cloneWith=function(e,t){return rO(e,4,t="function"==typeof t?t:r)},rc.conformsTo=function(e,t){return null==t||rD(e,t,au(t))},rc.deburr=aE,rc.defaultTo=function(e,t){return null==e||e!=e?t:e},rc.divide=aZ,rc.endsWith=function(e,t,i){e=s9(e),t=ib(t);var n=e.length,s=i=i===r?n:rw(s2(i),0,n);return(i-=t.length)>=0&&e.slice(i,s)==t},rc.eq=sB,rc.escape=function(e){return(e=s9(e))&&G.test(e)?e.replace(V,tF):e},rc.escapeRegExp=function(e){return(e=s9(e))&&z.test(e)?e.replace(Q,"\\$&"):e},rc.every=function(e,t,i){var n=sD(e)?to:rk;return i&&nm(e,t,i)&&(t=r),n(e,na(t,3))},rc.find=sn,rc.findIndex=nq,rc.findKey=function(e,t){return tm(e,na(t,3),rW)},rc.findLast=ss,rc.findLastIndex=nG,rc.findLastKey=function(e,t){return tm(e,na(t,3),rj)},rc.floor=aJ,rc.forEach=sa,rc.forEachRight=so,rc.forIn=function(e,t){return null==e?e:rq(e,na(t,3),ad)},rc.forInRight=function(e,t){return null==e?e:rG(e,na(t,3),ad)},rc.forOwn=function(e,t){return e&&rW(e,na(t,3))},rc.forOwnRight=function(e,t){return e&&rj(e,na(t,3))},rc.get=an,rc.gt=sC,rc.gte=sw,rc.has=function(e,t){return null!=e&&nf(e,t,rz)},rc.hasIn=as,rc.head=nj,rc.identity=aF,rc.includes=function(e,t,r,i){e=sM(e)?e:av(e),r=r&&!i?s2(r):0;var n=e.length;return r<0&&(r=tJ(n+r,0)),sQ(e)?r<=n&&e.indexOf(t,r)>-1:!!n&&ty(e,t,r)>-1},rc.indexOf=function(e,t,r){var i=null==e?0:e.length;if(!i)return -1;var n=null==r?0:s2(r);return n<0&&(n=tJ(i+n,0)),ty(e,t,n)},rc.inRange=function(e,t,i){var n,s,a;return t=s1(t),i===r?(i=t,t=0):i=s1(i),(n=e=s8(e))>=t0(s=t,a=i)&&n<tJ(s,a)},rc.invoke=al,rc.isArguments=sO,rc.isArray=sD,rc.isArrayBuffer=sI,rc.isArrayLike=sM,rc.isArrayLikeObject=sF,rc.isBoolean=function(e){return!0===e||!1===e||sW(e)&&rY(e)==c},rc.isBuffer=sN,rc.isDate=sk,rc.isElement=function(e){return sW(e)&&1===e.nodeType&&!s$(e)},rc.isEmpty=function(e){if(null==e)return!0;if(sM(e)&&(sD(e)||"string"==typeof e||"function"==typeof e.splice||sN(e)||sX(e)||sO(e)))return!e.length;var t=nh(e);if(t==p||t==E)return!e.size;if(nE(e))return!r4(e).length;for(var r in e)if(eC.call(e,r))return!1;return!0},rc.isEqual=function(e,t){return r1(e,t)},rc.isEqualWith=function(e,t,i){var n=(i="function"==typeof i?i:r)?i(e,t):r;return n===r?r1(e,t,r,i):!!n},rc.isError=sx,rc.isFinite=function(e){return"number"==typeof e&&tz(e)},rc.isFunction=sU,rc.isInteger=sV,rc.isLength=sq,rc.isMap=sj,rc.isMatch=function(e,t){return e===t||r2(e,t,nl(t))},rc.isMatchWith=function(e,t,i){return i="function"==typeof i?i:r,r2(e,t,nl(t),i)},rc.isNaN=function(e){return sH(e)&&e!=+e},rc.isNative=function(e){if(nb(e))throw new em("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return r3(e)},rc.isNil=function(e){return null==e},rc.isNull=function(e){return null===e},rc.isNumber=sH,rc.isObject=sG,rc.isObjectLike=sW,rc.isPlainObject=s$,rc.isRegExp=sK,rc.isSafeInteger=function(e){return sV(e)&&e>=-0x1fffffffffffff&&e<=0x1fffffffffffff},rc.isSet=sY,rc.isString=sQ,rc.isSymbol=sz,rc.isTypedArray=sX,rc.isUndefined=function(e){return e===r},rc.isWeakMap=function(e){return sW(e)&&nh(e)==T},rc.isWeakSet=function(e){return sW(e)&&"[object WeakSet]"==rY(e)},rc.join=function(e,t){return null==e?"":tX.call(e,t)},rc.kebabCase=aR,rc.last=nY,rc.lastIndexOf=function(e,t,i){var n=null==e?0:e.length;if(!n)return -1;var s=n;return i!==r&&(s=(s=s2(i))<0?tJ(n+s,0):t0(s,n-1)),t==t?function(e,t,r){for(var i=r+1;i--&&e[i]!==t;);return i}(e,t,s):tv(e,tE,s,!0)},rc.lowerCase=aS,rc.lowerFirst=aT,rc.lt=sZ,rc.lte=sJ,rc.max=function(e){return e&&e.length?rx(e,aF,rQ):r},rc.maxBy=function(e,t){return e&&e.length?rx(e,na(t,2),rQ):r},rc.mean=function(e){return tR(e,aF)},rc.meanBy=function(e,t){return tR(e,na(t,2))},rc.min=function(e){return e&&e.length?rx(e,aF,r9):r},rc.minBy=function(e,t){return e&&e.length?rx(e,na(t,2),r9):r},rc.stubArray=aK,rc.stubFalse=aY,rc.stubObject=function(){return{}},rc.stubString=function(){return""},rc.stubTrue=function(){return!0},rc.multiply=a0,rc.nth=function(e,t){return e&&e.length?it(e,s2(t)):r},rc.noConflict=function(){return e2._===this&&(e2._=eM),this},rc.noop=aV,rc.now=s_,rc.pad=function(e,t,r){e=s9(e);var i=(t=s2(t))?tG(e):0;if(!t||i>=t)return e;var n=(t-i)/2;return i0(tK(n),r)+e+i0(tT(n),r)},rc.padEnd=function(e,t,r){e=s9(e);var i=(t=s2(t))?tG(e):0;return t&&i<t?e+i0(t-i,r):e},rc.padStart=function(e,t,r){e=s9(e);var i=(t=s2(t))?tG(e):0;return t&&i<t?i0(t-i,r)+e:e},rc.parseInt=function(e,t,r){return r||null==t?t=0:t&&(t*=1),t2(s9(e).replace(Z,""),t||0)},rc.random=function(e,t,i){if(i&&"boolean"!=typeof i&&nm(e,t,i)&&(t=i=r),i===r&&("boolean"==typeof t?(i=t,t=r):"boolean"==typeof e&&(i=e,e=r)),e===r&&t===r?(e=0,t=1):(e=s1(e),t===r?(t=e,e=0):t=s1(t)),e>t){var n=e;e=t,t=n}if(i||e%1||t%1){var s=t3();return t0(e+s*(t-e+eZ("1e-"+((s+"").length-1))),t)}return io(e,t)},rc.reduce=function(e,t,r){var i=sD(e)?tf:tL,n=arguments.length<3;return i(e,na(t,4),r,n,rF)},rc.reduceRight=function(e,t,r){var i=sD(e)?t_:tL,n=arguments.length<3;return i(e,na(t,4),r,n,rN)},rc.repeat=function(e,t,i){return t=(i?nm(e,t,i):t===r)?1:s2(t),il(s9(e),t)},rc.replace=function(){var e=arguments,t=s9(e[0]);return e.length<3?t:t.replace(e[1],e[2])},rc.result=function(e,t,i){var n=-1,s=(t=iw(t,e)).length;for(s||(s=1,e=r);++n<s;){var a=null==e?r:e[nF(t[n])];a===r&&(n=s,a=i),e=sU(a)?a.call(e):a}return e},rc.round=a1,rc.runInContext=e,rc.sample=function(e){return(sD(e)?rR:function(e){return rR(av(e))})(e)},rc.size=function(e){if(null==e)return 0;if(sM(e))return sQ(e)?tG(e):e.length;var t=nh(e);return t==p||t==E?e.size:r4(e).length},rc.snakeCase=aL,rc.some=function(e,t,i){var n=sD(e)?tg:ig;return i&&nm(e,t,i)&&(t=r),n(e,na(t,3))},rc.sortedIndex=function(e,t){return ip(e,t)},rc.sortedIndexBy=function(e,t,r){return im(e,t,na(r,2))},rc.sortedIndexOf=function(e,t){var r=null==e?0:e.length;if(r){var i=ip(e,t);if(i<r&&sB(e[i],t))return i}return -1},rc.sortedLastIndex=function(e,t){return ip(e,t,!0)},rc.sortedLastIndexBy=function(e,t,r){return im(e,t,na(r,2),!0)},rc.sortedLastIndexOf=function(e,t){if(null==e?0:e.length){var r=ip(e,t,!0)-1;if(sB(e[r],t))return r}return -1},rc.startCase=aA,rc.startsWith=function(e,t,r){return e=s9(e),r=null==r?0:rw(s2(r),0,e.length),t=ib(t),e.slice(r,r+t.length)==t},rc.subtract=a2,rc.sum=function(e){return e&&e.length?tA(e,aF):0},rc.sumBy=function(e,t){return e&&e.length?tA(e,na(t,2)):0},rc.template=function(e,t,i){var n=rc.templateSettings;i&&nm(e,t,i)&&(t=r),e=s9(e),t=s7({},t,n,i5);var s,a,o=s7({},t.imports,n.imports,i5),l=au(o),u=tw(o,l),d=0,c=t.interpolate||e_,h="__p += '",f=eE((t.escape||e_).source+"|"+c.source+"|"+(c===H?ea:e_).source+"|"+(t.evaluate||e_).source+"|$","g"),_="//# sourceURL="+(eC.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++eY+"]")+"\n";e.replace(f,function(t,r,i,n,o,l){return i||(i=n),h+=e.slice(d,l).replace(eg,tN),r&&(s=!0,h+="' +\n__e("+r+") +\n'"),o&&(a=!0,h+="';\n"+o+";\n__p += '"),i&&(h+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),d=l+t.length,t}),h+="';\n";var g=eC.call(t,"variable")&&t.variable;if(g){if(en.test(g))throw new em("Invalid `variable` option passed into `_.template`")}else h="with (obj) {\n"+h+"\n}\n";h=(a?h.replace(N,""):h).replace(k,"$1").replace(x,"$1;"),h="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var p=aw(function(){return ev(l,_+"return "+h).apply(r,u)});if(p.source=h,sx(p))throw p;return p},rc.times=function(e,t){if((e=s2(e))<1||e>0x1fffffffffffff)return[];var r=0xffffffff,i=t0(e,0xffffffff);t=na(t),e-=0xffffffff;for(var n=tP(i,t);++r<e;)t(r);return n},rc.toFinite=s1,rc.toInteger=s2,rc.toLength=s3,rc.toLower=function(e){return s9(e).toLowerCase()},rc.toNumber=s8,rc.toSafeInteger=function(e){return e?rw(s2(e),-0x1fffffffffffff,0x1fffffffffffff):0===e?e:0},rc.toString=s9,rc.toUpper=function(e){return s9(e).toUpperCase()},rc.trim=function(e,t,i){if((e=s9(e))&&(i||t===r))return tB(e);if(!e||!(t=ib(t)))return e;var n=tW(e),s=tW(t);return iO(n,tD(n,s),tI(n,s)+1).join("")},rc.trimEnd=function(e,t,i){if((e=s9(e))&&(i||t===r))return e.slice(0,tj(e)+1);if(!e||!(t=ib(t)))return e;var n=tW(e);return iO(n,0,tI(n,tW(t))+1).join("")},rc.trimStart=function(e,t,i){if((e=s9(e))&&(i||t===r))return e.replace(Z,"");if(!e||!(t=ib(t)))return e;var n=tW(e);return iO(n,tD(n,tW(t))).join("")},rc.truncate=function(e,t){var i=30,n="...";if(sG(t)){var s="separator"in t?t.separator:s;i="length"in t?s2(t.length):i,n="omission"in t?ib(t.omission):n}var a=(e=s9(e)).length;if(tk(e)){var o=tW(e);a=o.length}if(i>=a)return e;var l=i-tG(n);if(l<1)return n;var u=o?iO(o,0,l).join(""):e.slice(0,l);if(s===r)return u+n;if(o&&(l+=u.length-l),sK(s)){if(e.slice(l).search(s)){var d,c=u;for(s.global||(s=eE(s.source,s9(eo.exec(s))+"g")),s.lastIndex=0;d=s.exec(c);)var h=d.index;u=u.slice(0,h===r?l:h)}}else if(e.indexOf(ib(s),l)!=l){var f=u.lastIndexOf(s);f>-1&&(u=u.slice(0,f))}return u+n},rc.unescape=function(e){return(e=s9(e))&&q.test(e)?e.replace(U,tH):e},rc.uniqueId=function(e){var t=++ew;return s9(e)+t},rc.upperCase=aP,rc.upperFirst=aB,rc.each=sa,rc.eachRight=so,rc.first=nj,aU(rc,(aQ={},rW(rc,function(e,t){eC.call(rc.prototype,t)||(aQ[t]=e)}),aQ),{chain:!1}),rc.VERSION="4.17.21",ta(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){rc[e].placeholder=rc}),ta(["drop","take"],function(e,t){rg.prototype[e]=function(i){i=i===r?1:tJ(s2(i),0);var n=this.__filtered__&&!t?new rg(this):this.clone();return n.__filtered__?n.__takeCount__=t0(i,n.__takeCount__):n.__views__.push({size:t0(i,0xffffffff),type:e+(n.__dir__<0?"Right":"")}),n},rg.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),ta(["filter","map","takeWhile"],function(e,t){var r=t+1,i=1==r||3==r;rg.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:na(e,3),type:r}),t.__filtered__=t.__filtered__||i,t}}),ta(["head","last"],function(e,t){var r="take"+(t?"Right":"");rg.prototype[e]=function(){return this[r](1).value()[0]}}),ta(["initial","tail"],function(e,t){var r="drop"+(t?"":"Right");rg.prototype[e]=function(){return this.__filtered__?new rg(this):this[r](1)}}),rg.prototype.compact=function(){return this.filter(aF)},rg.prototype.find=function(e){return this.filter(e).head()},rg.prototype.findLast=function(e){return this.reverse().find(e)},rg.prototype.invokeMap=iu(function(e,t){return"function"==typeof e?new rg(this):this.map(function(r){return rJ(r,e,t)})}),rg.prototype.reject=function(e){return this.filter(sS(na(e)))},rg.prototype.slice=function(e,t){e=s2(e);var i=this;return i.__filtered__&&(e>0||t<0)?new rg(i):(e<0?i=i.takeRight(-e):e&&(i=i.drop(e)),t!==r&&(i=(t=s2(t))<0?i.dropRight(-t):i.take(t-e)),i)},rg.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},rg.prototype.toArray=function(){return this.take(0xffffffff)},rW(rg.prototype,function(e,t){var i=/^(?:filter|find|map|reject)|While$/.test(t),n=/^(?:head|last)$/.test(t),s=rc[n?"take"+("last"==t?"Right":""):t],a=n||/^find/.test(t);s&&(rc.prototype[t]=function(){var t=this.__wrapped__,o=n?[1]:arguments,l=t instanceof rg,u=o[0],d=l||sD(t),c=function(e){var t=s.apply(rc,th([e],o));return n&&h?t[0]:t};d&&i&&"function"==typeof u&&1!=u.length&&(l=d=!1);var h=this.__chain__,f=!!this.__actions__.length,_=a&&!h,g=l&&!f;if(!a&&d){t=g?t:new rg(this);var p=e.apply(t,o);return p.__actions__.push({func:st,args:[c],thisArg:r}),new r_(p,h)}return _&&g?e.apply(this,o):(p=this.thru(c),_?n?p.value()[0]:p.value():p)})}),ta(["pop","push","shift","sort","splice","unshift"],function(e){var t=eT[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:pop|shift)$/.test(e);rc.prototype[e]=function(){var e=arguments;if(i&&!this.__chain__){var n=this.value();return t.apply(sD(n)?n:[],e)}return this[r](function(r){return t.apply(sD(r)?r:[],e)})}}),rW(rg.prototype,function(e,t){var r=rc[t];if(r){var i=r.name+"";eC.call(rr,i)||(rr[i]=[]),rr[i].push({name:t,func:r})}}),rr[iz(r,2).name]=[{name:"wrapper",func:r}],rg.prototype.clone=function(){var e=new rg(this.__wrapped__);return e.__actions__=iU(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=iU(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=iU(this.__views__),e},rg.prototype.reverse=function(){if(this.__filtered__){var e=new rg(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},rg.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,r=sD(e),i=t<0,n=r?e.length:0,s=function(e,t,r){for(var i=-1,n=r.length;++i<n;){var s=r[i],a=s.size;switch(s.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=t0(t,e+a);break;case"takeRight":e=tJ(e,t-a)}}return{start:e,end:t}}(0,n,this.__views__),a=s.start,o=s.end,l=o-a,u=i?o:a-1,d=this.__iteratees__,c=d.length,h=0,f=t0(l,this.__takeCount__);if(!r||!i&&n==l&&f==l)return iL(e,this.__actions__);var _=[];e:for(;l--&&h<f;){for(var g=-1,p=e[u+=t];++g<c;){var m=d[g],v=m.iteratee,y=m.type,b=v(p);if(2==y)p=b;else if(!b){if(1==y)continue e;break e}}_[h++]=p}return _},rc.prototype.at=sr,rc.prototype.chain=function(){return se(this)},rc.prototype.commit=function(){return new r_(this.value(),this.__chain__)},rc.prototype.next=function(){this.__values__===r&&(this.__values__=s0(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?r:this.__values__[this.__index__++]}},rc.prototype.plant=function(e){for(var t,i=this;i instanceof rf;){var n=nk(i);n.__index__=0,n.__values__=r,t?s.__wrapped__=n:t=n;var s=n;i=i.__wrapped__}return s.__wrapped__=e,t},rc.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof rg){var t=e;return this.__actions__.length&&(t=new rg(this)),(t=t.reverse()).__actions__.push({func:st,args:[nZ],thisArg:r}),new r_(t,this.__chain__)}return this.thru(nZ)},rc.prototype.toJSON=rc.prototype.valueOf=rc.prototype.value=function(){return iL(this.__wrapped__,this.__actions__)},rc.prototype.first=rc.prototype.head,e1&&(rc.prototype[e1]=function(){return this}),rc}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(e2._=t$,define(function(){return t$})):e8?((e8.exports=t$)._=t$,e3._=t$):e2._=t$}).call(this)}),et.register("3264a",function(e,t){var r;let i;E(e.exports,"ECommand",function(){return i}),(r=i||(i={})).CONNECT_TO_ROOM="connectToRoom",r.MODULES_INFO_AVAILABLE="modulesInfoAvailable",r.MODULE_LIFECYCLE_EVENT_AVAILABLE="moduleLifecycleEventAvailable",r.CLIENT_CONNECTED="clientConnected",r.CLIENT_INFO_AVAILABLE="clientInfoAvailable",r.CLIENT_DISCONNECTED="clientDisconnected"}),et.register("iVqGx",function(e,t){e.exports=o("jecYn").then(()=>et("8GHQT"))}),et("8NFq9");var er=et("a8VW4");function ei(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==X?X:void 0}"undefined"==typeof globalThis&&(globalThis=ei());let en="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==X&&X;function es(e){try{new e("")}catch(e){return!1}return!0}"function"==typeof en.Event&&es(en.Event)||(en.Event=function(e,t){this.bubbles=!!t&&!!t.bubbles,this.cancelable=!!t&&!!t.cancelable,this.composed=!!t&&!!t.composed,this.type=e}),void 0!==en.EventTarget&&es(en.EventTarget)||(en.EventTarget=function(){function e(){this.__listeners=new Map}return e.prototype=Object.create(Object.prototype),e.prototype.addEventListener=function(e,t,r){if(arguments.length<2)throw TypeError(`TypeError: Failed to execute 'addEventListener' on 'EventTarget': 2 arguments required, but only ${arguments.length} present.`);let i=this.__listeners,n=e.toString();i.has(n)||i.set(n,new Map);let s=i.get(n);s.has(t)||s.set(t,r)},e.prototype.removeEventListener=function(e,t,r){if(arguments.length<2)throw TypeError(`TypeError: Failed to execute 'addEventListener' on 'EventTarget': 2 arguments required, but only ${arguments.length} present.`);let i=this.__listeners,n=e.toString();if(i.has(n)){let e=i.get(n);e.has(t)&&e.delete(t)}},e.prototype.dispatchEvent=function(e){if(!(e instanceof Event))throw TypeError("Failed to execute 'dispatchEvent' on 'EventTarget': parameter 1 is not of type 'Event'.");let t=e.type,r=this.__listeners.get(t);if(r)for(let[t,i]of r.entries()){try{"function"==typeof t?t.call(this,e):t&&"function"==typeof t.handleEvent&&t.handleEvent(e)}catch(e){setTimeout(()=>{throw e})}i&&i.once&&r.delete(t)}return!0},e}());class ea{constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}addEventListener(e,t,r){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:r})}removeEventListener(e,t){if(!(e in this.listeners))return;let r=this.listeners[e];for(let e=0,i=r.length;e<i;e++)if(r[e].callback===t)return void r.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;let t=this.listeners[e.type].slice();for(let r=0,i=t.length;r<i;r++){let i=t[r];try{i.callback.call(this,e)}catch(e){Promise.resolve().then(function(){return o("jecYn")}).then(t=>{throw e})}i.options&&i.options.once&&this.removeEventListener(e.type,i.callback)}return!e.defaultPrevented}}class eo extends ea{constructor(){super(),this.listeners||ea.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}}class el{constructor(){Object.defineProperty(this,"signal",{value:new eo,writable:!0,configurable:!0})}abort(e){let t=new Event("abort"),r=e;void 0===r&&((r=Error("This operation was aborted")).name="AbortError"),this.signal.reason=r,this.signal.dispatchEvent(t)}toString(){return"[object AbortController]"}}("function"!=typeof(ec=ed="undefined"!=typeof self?self:X).Request||Object.prototype.hasOwnProperty.call(ec.Request.prototype,"signal"))&&ec.AbortController||("undefined"!=typeof Symbol&&Symbol.toStringTag&&(el.prototype[Symbol.toStringTag]="AbortController",eo.prototype[Symbol.toStringTag]="AbortSignal"),ed.AbortController=el,ed.AbortSignal=eo);let eu=ei();"function"!=typeof eu.queueMicrotask&&(eu.queueMicrotask=function(e){Promise.resolve().then(e).catch(e=>setTimeout(()=>{throw e}))}),Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(...t){let r=isNaN(t[0])?1:Number(t[0]);return r?Array.prototype.reduce.call(this,function(t,i){return Array.isArray(i)?t.push(...e.call(i,r-1)):t.push(i),t},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(...e){return this.map(...e).flat()},writable:!0}),et("8NFq9"),er=et("a8VW4");var ed,ec,eh,ef,e_,eg,ep,em,ev,ey,eb,eE,eR,eS,eT="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==X?X:{};function eL(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==eT?eT:void 0}"undefined"==typeof globalThis&&(globalThis=eL());let eA="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==eT&&eT;function eP(e){try{new e("")}catch(e){return!1}return!0}"function"==typeof eA.Event&&eP(eA.Event)||(eA.Event=function(e,t){this.bubbles=!!t&&!!t.bubbles,this.cancelable=!!t&&!!t.cancelable,this.composed=!!t&&!!t.composed,this.type=e}),void 0!==eA.EventTarget&&eP(eA.EventTarget)||(eA.EventTarget=function(){function e(){this.__listeners=new Map}return e.prototype=Object.create(Object.prototype),e.prototype.addEventListener=function(e,t,r){if(arguments.length<2)throw TypeError(`TypeError: Failed to execute 'addEventListener' on 'EventTarget': 2 arguments required, but only ${arguments.length} present.`);let i=this.__listeners,n=e.toString();i.has(n)||i.set(n,new Map);let s=i.get(n);s.has(t)||s.set(t,r)},e.prototype.removeEventListener=function(e,t,r){if(arguments.length<2)throw TypeError(`TypeError: Failed to execute 'addEventListener' on 'EventTarget': 2 arguments required, but only ${arguments.length} present.`);let i=this.__listeners,n=e.toString();if(i.has(n)){let e=i.get(n);e.has(t)&&e.delete(t)}},e.prototype.dispatchEvent=function(e){if(!(e instanceof Event))throw TypeError("Failed to execute 'dispatchEvent' on 'EventTarget': parameter 1 is not of type 'Event'.");let t=e.type,r=this.__listeners.get(t);if(r)for(let[t,i]of r.entries()){try{"function"==typeof t?t.call(this,e):t&&"function"==typeof t.handleEvent&&t.handleEvent(e)}catch(e){setTimeout(()=>{throw e})}i&&i.once&&r.delete(t)}return!0},e}());let eB=class{constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}addEventListener(e,t,r){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:r})}removeEventListener(e,t){if(!(e in this.listeners))return;let r=this.listeners[e];for(let e=0,i=r.length;e<i;e++)if(r[e].callback===t)return void r.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;let t=this.listeners[e.type].slice();for(let r=0,i=t.length;r<i;r++){let i=t[r];try{i.callback.call(this,e)}catch(e){Promise.resolve().then(()=>{throw e})}i.options&&i.options.once&&this.removeEventListener(e.type,i.callback)}return!e.defaultPrevented}},eC=class extends eB{constructor(){super(),this.listeners||eB.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}},ew=class{constructor(){Object.defineProperty(this,"signal",{value:new eC,writable:!0,configurable:!0})}abort(e){let t;t=new Event("abort");let r=e;void 0===r&&((r=Error("This operation was aborted")).name="AbortError"),this.signal.reason=r,this.signal.dispatchEvent(t)}toString(){return"[object AbortController]"}};("function"!=typeof(R="undefined"!=typeof self?self:eT).Request||R.Request.prototype.hasOwnProperty("signal"))&&R.AbortController||("undefined"!=typeof Symbol&&Symbol.toStringTag&&(ew.prototype[Symbol.toStringTag]="AbortController",eC.prototype[Symbol.toStringTag]="AbortSignal"),R.AbortController=ew,R.AbortSignal=eC);let eO=eL();"function"!=typeof eO.queueMicrotask&&(eO.queueMicrotask=function(e){Promise.resolve().then(e).catch(e=>setTimeout(()=>{throw e}))}),Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){let t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(r,i){return Array.isArray(i)?r.push.apply(r,e.call(i,t-1)):r.push(i),r},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0}),(S=eh||(eh={})).CLICK="videoElement.click",S.PLAYING="videoElement.playing",S.LOADING="videoElement.loading",S.PAUSE="videoElement.pause",S.VIDEO_PLAYBACK_STATE_CHANGE="videoElement.videoPlaybackStateChange",S.NATIVE_EVENT="videoElement.nativeEvent",S.UPDATE_PLAYER_RESOLUTION="videoElement.updatePlayerResolution",S.TIME_UPDATE="videoElement.timeUpdate";let eD=class{constructor(e=!0){this.appId=null,this._lastUid=-1,this._messages={},this._immediateExceptions=!1,this._allSubscribingMsg="*",this._immediateExceptions=e}setAppId(e){this.appId=e}getAppId(){return this.appId}publish(e,t){return this._publish(e,t,!1,this._immediateExceptions)}publishSync(e,t){return this._publish(e,t,!0,this._immediateExceptions)}subscribe(e,t){if("function"!=typeof t)return"";let r="uid_"+String(++this._lastUid);return this._messages[e]||(this._messages[e]={}),(this._messages[e]||{})[r]=t,r}toggleSubscriptionBulk(e){"subscribe"===e.action?Object.entries(e.callbacks).forEach(([e,t])=>{this.subscribe.call(this,e,t)}):Object.entries(e.callbacks).forEach(([e,t])=>{this.unsubscribe.call(this,t)})}subscribeAll(e){return this.subscribe(this._allSubscribingMsg,e)}subscribeOnce(e,t){let r=this.subscribe(e,(...e)=>{this.unsubscribe(r),t.apply(this,e)});return this}clearAllSubscriptions(){this._messages={}}clearSubscriptions(e){for(let t in this._messages)Object.prototype.hasOwnProperty.call(this._messages,t)&&0===t.indexOf(e)&&delete this._messages[t]}unsubscribe(e){let t="string"==typeof e&&(Object.prototype.hasOwnProperty.call(this._messages,e)||this._descendantTopicExists(e)),r=!t&&"string"==typeof e,i="function"==typeof e,n=!1;if(!t){for(let t in this._messages)if(Object.prototype.hasOwnProperty.call(this._messages,t)){let s=this._messages[t]||{};if(r&&s[e]){delete s[e],n=e;break}if(i)for(let t in s)Object.prototype.hasOwnProperty.call(s,t)&&s[t]===e&&(delete s[t],n=!0)}return n}this.clearSubscriptions(e)}_hasKeys(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!0;return!1}_throwException(e){return()=>{throw e}}_callSubscriberWithDelayedExceptions(e,t){try{e(t)}catch(e){setTimeout(this._throwException(e),0)}}_callSubscriberWithImmediateExceptions(e,t){e(t)}_deliverMessage(e,t,r,i){let n=this._messages[t]||{},s=i?this._callSubscriberWithImmediateExceptions:this._callSubscriberWithDelayedExceptions;if(Object.prototype.hasOwnProperty.call(this._messages,t))for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&s(n[e],r)}_createDeliveryFunction(e,t,r){return()=>{let i=String(e),n=i.lastIndexOf(".");for(this._deliverMessage(e,e,t,r);n>-1;)n=(i=i.substr(0,n)).lastIndexOf("."),this._deliverMessage(e,i,t,r);this._deliverMessage(e,this._allSubscribingMsg,t,r)}}_hasDirectSubscribersFor(e){let t=String(e);return!(!Object.prototype.hasOwnProperty.call(this._messages,t)||!this._hasKeys(this._messages[t]||{}))}_messageHasSubscribers(e){let t=String(e),r=this._hasDirectSubscribersFor(t)||this._hasDirectSubscribersFor(this._allSubscribingMsg),i=t.lastIndexOf(".");for(;!r&&-1!==i;)i=(t=t.substr(0,i)).lastIndexOf("."),r=this._hasDirectSubscribersFor(t);return r}_publish(e,t,r,i){let n="symbol"==typeof e?e.toString():e,s=this._createDeliveryFunction(n,t,i);return!!this._messageHasSubscribers(n)&&(r?s():setTimeout(s,0),!0)}_descendantTopicExists(e){for(let t in this._messages)if(Object.prototype.hasOwnProperty.call(this._messages,t)&&0===t.indexOf(e))return!0;return!1}};new eD,new eD;let eI=e=>`configProvider.configUpdated.${e}`,eM=e=>{let t={};return{configConsumerConstructor:class{constructor(r,i){this._onConfigUpdatedWithContext=this._onConfigUpdated.bind(this),this._configKey=r,this._eventBus=i||e;let n=eI(r);this._onConfigUpdatedListener=this._eventBus.subscribe(n,this._onConfigUpdatedWithContext),this.config=t[r]}destroy(){this._eventBus.unsubscribe(this._onConfigUpdatedListener)}_handleConfigUpdated(e,t){}_onConfigUpdated(e){t=e.newConfig;let r=e.newConfig[this._configKey];this.config=r,this._handleConfigUpdated(e.updatedValues,r)}},setConsumerConfig:e=>{t=e}}},eF=e=>e instanceof Date,eN=e=>e instanceof Element||e instanceof Document,ek=e=>null!=e&&"object"==typeof e,ex=(e,...t)=>Object.prototype.hasOwnProperty.call(e,...t),eU=e=>ek(e)&&0===Object.keys(e).length,eV=e=>t=>new Promise((r,i)=>{e(t,e=>{r(e)},e=>{i(e)})}),eq=(e,t)=>{if(e===t)return{};if(!ek(e)||!ek(t)||eN(e)||eN(t))return t;let r=Object.keys(e).reduce((e,r)=>(ex(t,r)||(e[r]=void 0),e),{});return eF(e)||eF(t)?e.valueOf()==t.valueOf()?{}:t:Object.keys(t).reduce((r,i)=>{if(!ex(e,i))return r[i]=t[i],r;let n=eq(e[i],t[i]);return eU(n)&&!eF(n)&&(eU(e[i])||!eU(t[i]))||(r[i]=n),r},r)},eG=e=>{let t={...e},{configConsumerConstructor:r,setConsumerConfig:i}=eM(new eD);return i(e),{getConfigField:e=>t[e],setConfig:(e,r,n=!1)=>{let s=Object.entries(e).reduce((e,[t,r])=>(e[t]={...e[t],...r},e),{...t}),a=eq(t,s);t=s,Object.entries(a).forEach(([e,t])=>{let i=eI(e);n?r.publishSync(i,{updatedValues:t,newConfig:s}):r.publish(i,{updatedValues:t,newConfig:s})}),i(t)},getConfig:()=>t,resetConfig:()=>{t={...e}},ConfigConsumer:r}};function eW(e,t,r){if(!r||"function"!=typeof r.value)throw TypeError(`Only methods can be decorated with @bind. <${t}> is not a method!`);return{configurable:!0,get(){let e=r.value?.bind(this);return Object.defineProperty(this,t,{value:e,configurable:!0,writable:!0}),e}}}function ej(e,t,r,i){var n,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,r,a):n(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a}(P=ef||(ef={})).HLS="hls",P.WEBRTC="webrtc",P.NATIVE="native",P.BROADCAST="broadcast",(A=e_||(e_={})).IDLE="idle",A.LOADING="loading",A.PAUSED="paused",A.PLAYING="playing",A.ERROR="error",(L=eg||(eg={})).WAITING="waiting",L.AUTO="auto",L.MANUAL="manual",(T=ep||(ep={})).BROADCAST_STATE_CHANGED="commonEvents.broadcastStateChanged",T.BROADCAST_REMOTE_STATS_AVAILABLE="commonEvents.broadcastRemoteStatsAvailable",T.PLAYING_STATE_CHANGED="commonEvents.playingStateChanged",T.COMMON_ERROR="commonEvents.commonError",new eD,(em||(em={})).LOG="logger.log";let eH=(e,t,r)=>(i,n)=>{e.publish(em.LOG,{domain:t,timestamp:performance.now(),level:r,message:i,payload:n})},e$=(e,t)=>{let r=`${t}{${(Math.random()+1).toString(36).substring(2,6)}}`;return{debug:eH(e,r,"debug"),verbose:eH(e,r,"verbose"),info:eH(e,r,"info"),warn:eH(e,r,"warn"),error:eH(e,r,"error"),fatal:eH(e,r,"fatal")}},eK=(...e)=>console.log(...e.filter(e=>void 0!==e)),eY={debug:(e,t)=>eK(`%c${e}`,"color: rgb(102, 102, 102)",t),verbose:(e,t)=>eK(`%c${e}`,"color: rgb(36, 114, 200)",t),info:(e,t)=>eK(`%c${e}`,"color: rgb(13, 188, 121)",t),warn:(e,t)=>eK(`%c${e}`,"color: rgb(229, 229, 16)",t),error:(e,t)=>eK(`%c${e}`,"color: rgb(241, 76, 76)",t),fatal:(e,t)=>eK(`%c${e}`,"background: rgb(241, 76, 76); color: #fff",t)},eQ=[],ez=class{constructor(e,t=eQ,r=[],i=[],n=!0){this._levels=t,this._eventBus=e,this._enableErrorAutoLog=n,this._onLogMessageReceivedToken=this._eventBus.subscribe(em.LOG,this._onMessageReceived),this._onErrorReceivedToken=this._eventBus.subscribe(ep.COMMON_ERROR,this._onErrorReceived),this._ignoreDomains=i,this._additionalScopeSubscriptions=r.map(e=>this._eventBus.subscribe(e,t=>{this._onAdditionalScopeMessageReceived(e,t)})),this._appId=`${(Math.random()+1).toString(36).substring(2,6)}`}destroy(){this._eventBus.unsubscribe(this._onLogMessageReceivedToken),this._eventBus.unsubscribe(this._onErrorReceivedToken),this._additionalScopeSubscriptions.forEach(this._eventBus.unsubscribe)}_onMessageReceived(e){let{domain:t,timestamp:r,level:i,message:n,payload:s}=e;this._levels.includes(i)&&!this._ignoreDomains.includes(t)&&(eY[i]||eY.info)(`(${this._appId}) :: [${t}] ${i.toUpperCase()}:${n}@${r}`,s)}_onAdditionalScopeMessageReceived(e,t){(0,eY.verbose)(`[${e}] Event receiver with payload ${t} @ ${performance.now()}`)}_onErrorReceived({error:e}){this._enableErrorAutoLog&&e$(this._eventBus,"COMMON ERROR").error(`Error in ${e.domain}: ${e.message} ${e.info&&" ("+e.info+")"}`)}};ej([eW],ez.prototype,"_onMessageReceived",null),ej([eW],ez.prototype,"_onAdditionalScopeMessageReceived",null),ej([eW],ez.prototype,"_onErrorReceived",null);let eX={videoElementControllerConfig:{limitCheckingAutoplay:5,minimalPossibleVideoDimension:50,timeoutUpdateStatusPlaying:2e3,timeoutUpdateVideoDuration:500}},{ConfigConsumer:eZ,setConfig:eJ,resetConfig:e0}=eG(eX);(B=ev||(ev={})).NATIVE_EVENT="videoElementController.nativeEvent",B.CLICK="videoElementController.click",B.FORCE_PLAY_AFTER_PAUSE="videoElementController.forcePlayAfterPause",B.VIDEO_START="videoElementController.videoStart",B.VIDEO_PAUSE="videoElementController.videoPause",B.VIDEO_RESET="videoElementController.videoReset",B.PAUSED="videoElementController.paused",B.PLAYING="videoElementController.playing",B.LOADING="videoElementController.loading",B.LOADED="videoElementController.loaded",B.UPDATED="videoElementController.updated",B.DESTROY="videoElementController.destroy",B.STREAM_RESET="videoElementController.streamReset",B.CAN_PLAY="videoElementController.canPlay",B.REMOVE_MEDIA_STREAM="videoElementController.removeMediaStream",B.ERROR="videoElementController.error",B.ABORT="videoElementController.abort",B.STALLED="videoElementController.stalled",B.WAITING="videoElementController.waiting",B.UPDATE_PLAYER_RESOLUTION="videoElementController.updatePlayerResolution",B.RESET_CHECKING_AUTOPLAY_COUNT="videoElementController.resetCheckingAutoplayCount",B.CANCEL_RESET_STREAM="videoElementController.cancelResetStream",B.RESTART="videoElementController.restart",B.TIME_UPDATE_NATIVE="videoElementController.native",B.UPDATE_MEDIA_STREAM="videoElementController.updateMediaStream",B.VIDEO_ELEMENT_RECREATED="videoElementController.videoElementRecreated",B.VIDEO_PLAYBACK_STATE_CHANGED="videoElementController.videoPlaybackStateChanged",B.SET_VOLUME="videoElementController.setVolume";let e1=0,e2=class{constructor(e){this._config={},this._eventsMap={[ev.CAN_PLAY]:this._checkAutoplayEnabled,[ev.DESTROY]:this.destroy,[ev.FORCE_PLAY_AFTER_PAUSE]:this._forcePlayAfterPause,[ev.RESET_CHECKING_AUTOPLAY_COUNT]:this._resetCheckingAutoplayCount},this._state=e.state,this._eventBus=e.eventBus,this._logger=e$(this._eventBus,"VideoElementController - AutoplayController"),this._logger.info("Created"),this._logger.debug("Initial config",this._config),this._logger.debug("Initial state",this._state),this.init()}setConfig(e){this._logger.debug("Config update received, the new one:",e),this._config=e}destroy(){this._logger.info("Destroying"),this._eventBus.toggleSubscriptionBulk({action:"unsubscribe",callbacks:this._eventsMap})}init(){this._logger.info("Initialization requested, attaching eventBus listeners"),this._eventBus.toggleSubscriptionBulk({action:"subscribe",callbacks:this._eventsMap})}_handleConfigUpdated(){}_forcePlayAfterPause(e){if(void 0!==this._config.autoplay&&!this._config.autoplay)return void this._logger.verbose("Autoplay is disabled.");this._logger.verbose(`Trying to force video to play.    Reason: ${e.reason}`);let t=this._state.getState();!t.startedPlaying||t.isPlaying||this._config.canBePaused?this._logger.verbose("Currently unable to autoplay the video"):this._checkAutoplayEnabled()}_checkAutoplayEnabled(){if(this._logger.debug("Checking if autoplay is possible"),this._state.getState().canPlay){if(void 0===this._config.autoplay||this._config.autoplay)return e1>this._config.limitCheckingAutoplay?(this._logger.verbose(`Unable to autoplay the video. The limit of autoplay checking (${this._config.limitCheckingAutoplay}) is exceeded`),void this._eventBus.publish(ev.PAUSED,{})):(e1+=1,this._logger.verbose("Autoplay is used to play the video"),void this._eventBus.publish(ev.VIDEO_START,{}));this._logger.verbose("Autoplay is disabled.")}else this._logger.verbose("No canPlay event caught, skipping check")}_resetCheckingAutoplayCount(){e1=0}};ej([eW],e2.prototype,"destroy",null),ej([eW],e2.prototype,"init",null),ej([eW],e2.prototype,"_forcePlayAfterPause",null),ej([eW],e2.prototype,"_checkAutoplayEnabled",null),ej([eW],e2.prototype,"_resetCheckingAutoplayCount",null);let e3=class extends EventTarget{constructor(){super()}emitEvent(e,t){this.dispatchEvent(new CustomEvent(e,{detail:t}))}},e8=class extends e3{constructor(e){super(),this._eventsMap={[ev.PLAYING]:this._handlePlaying,[ev.LOADING]:this._handleLoading,[ev.VIDEO_PAUSE]:this._handlePause,[ev.CLICK]:this._handleClick,[ev.DESTROY]:this.destroy,[ev.NATIVE_EVENT]:this._handleNativeEvent,[ev.UPDATE_PLAYER_RESOLUTION]:this._handleUpdatePlayerResolution,[ev.VIDEO_PLAYBACK_STATE_CHANGED]:this._handleVideoPlaybackStateChange,[ev.TIME_UPDATE_NATIVE]:this._handleTimeUpdate},this._eventBus=e.eventBus,this.init()}destroy(){this._eventBus.toggleSubscriptionBulk({action:"unsubscribe",callbacks:this._eventsMap})}init(){this._eventBus.toggleSubscriptionBulk({action:"subscribe",callbacks:this._eventsMap})}_handlePlaying(e){this.emitEvent(eh.PLAYING,e)}_handleLoading(){this.emitEvent(eh.LOADING,{})}_handlePause(){this.emitEvent(eh.PAUSE,{})}_handleClick(e){this.emitEvent(eh.CLICK,{originalEvent:e.originalEvent})}_handleNativeEvent(e){this.emitEvent(eh.NATIVE_EVENT,e)}_handleUpdatePlayerResolution(e){this.emitEvent(eh.UPDATE_PLAYER_RESOLUTION,e)}_handleTimeUpdate(e){this.emitEvent(eh.TIME_UPDATE,e)}_handleVideoPlaybackStateChange(e){this.emitEvent(eh.VIDEO_PLAYBACK_STATE_CHANGE,{prevState:e.prevState,nextState:e.nextState})}};ej([eW],e8.prototype,"destroy",null),ej([eW],e8.prototype,"init",null),ej([eW],e8.prototype,"_handlePlaying",null),ej([eW],e8.prototype,"_handleLoading",null),ej([eW],e8.prototype,"_handlePause",null),ej([eW],e8.prototype,"_handleClick",null),ej([eW],e8.prototype,"_handleNativeEvent",null),ej([eW],e8.prototype,"_handleUpdatePlayerResolution",null),ej([eW],e8.prototype,"_handleTimeUpdate",null),ej([eW],e8.prototype,"_handleVideoPlaybackStateChange",null),C=function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,(function(t){return e[t]}).bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){t.__esModule=!0,t.default=void 0;var i=r(18),n=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,i){void 0===i&&(i=!1);var n=e.getVersionPrecision(t),s=e.getVersionPrecision(r),a=Math.max(n,s),o=0,l=e.map([t,r],function(t){var r=a-e.getVersionPrecision(t),i=t+Array(r+1).join(".0");return e.map(i.split("."),function(e){return Array(20-e.length).join("0")+e}).reverse()});for(i&&(o=a-Math.min(n,s)),a-=1;a>=o;){if(l[0][a]>l[1][a])return 1;if(l[0][a]===l[1][a]){if(a===o)return 0;a-=1}else if(l[0][a]<l[1][a])return -1}},e.map=function(e,t){var r,i=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)i.push(t(e[r]));return i},e.find=function(e,t){var r,i;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,i=e.length;r<i;r+=1){var n=e[r];if(t(n,r))return n}},e.assign=function(e){for(var t,r,i=arguments.length,n=Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[e].concat(n));for(t=0,r=n.length;t<r;t+=1)!function(){var r=n[t];"object"==typeof r&&null!==r&&Object.keys(r).forEach(function(t){e[t]=r[t]})}();return e},e.getBrowserAlias=function(e){return i.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return i.BROWSER_MAP[e]||""},e}();t.default=n,e.exports=t.default},18:function(e,t,r){t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){t.__esModule=!0,t.default=void 0;var i,n=(i=r(91))&&i.__esModule?i:{default:i},s=r(18),a=function(){function e(){}return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw Error("UserAgent should be a string");return new n.default(e,t)},e.parse=function(e){return new n.default(e).getResult()},function(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e,[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}]),e}();t.default=a,e.exports=t.default},91:function(e,t,r){t.__esModule=!0,t.default=void 0;var i=l(r(92)),n=l(r(93)),s=l(r(94)),a=l(r(95)),o=l(r(17));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=o.default.find(i.default,function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw Error("Browser's test function is not valid")});return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=o.default.find(n.default,function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw Error("Browser's test function is not valid")});return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=o.default.find(s.default,function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw Error("Browser's test function is not valid")});return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=o.default.find(a.default,function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw Error("Browser's test function is not valid")});return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return o.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},i=0,n={},s=0;if(Object.keys(e).forEach(function(t){var a=e[t];"string"==typeof a?(n[t]=a,s+=1):"object"==typeof a&&(r[t]=a,i+=1)}),i>0){var a=Object.keys(r),l=o.default.find(a,function(e){return t.isOS(e)});if(l){var u=this.satisfies(r[l]);if(void 0!==u)return u}var d=o.default.find(a,function(e){return t.isPlatform(e)});if(d){var c=this.satisfies(r[d]);if(void 0!==c)return c}}if(s>0){var h=Object.keys(n),f=o.default.find(h,function(e){return t.isBrowser(e,!0)});if(void 0!==f)return this.compareVersion(n[f])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),i=e.toLowerCase(),n=o.default.getBrowserTypeByAlias(i);return t&&n&&(i=n.toLowerCase()),i===r},t.compareVersion=function(e){var t=[0],r=e,i=!1,n=this.getBrowserVersion();if("string"==typeof n)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(i=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(i=!0,r=e.substr(1)),t.indexOf(o.default.compareVersions(n,r,i))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some(function(e){return t.is(e)})},e}();t.default=u,e.exports=t.default},92:function(e,t,r){t.__esModule=!0,t.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},s=/version\/(\d+(\.?_?\d+)+)/i,a=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=n.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=n.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=n.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=n.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=n.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=n.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=n.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=n.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=n.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=n.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=n.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=n.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=n.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=n.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=n.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=n.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=n.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=n.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=n.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=n.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=n.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=n.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=n.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=n.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=n.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=n.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=n.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:n.default.getFirstMatch(t,e),version:n.default.getSecondMatch(t,e)}}}];t.default=a,e.exports=t.default},93:function(e,t,r){t.__esModule=!0,t.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},s=r(18),a=[{test:[/Roku\/DVP/],describe:function(e){var t=n.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:s.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=n.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=n.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=n.default.getWindowsVersionName(t);return{name:s.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:s.OS_MAP.iOS},r=n.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=n.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=n.default.getMacOSVersionName(t),i={name:s.OS_MAP.MacOS,version:t};return r&&(i.versionName=r),i}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=n.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=n.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=n.default.getAndroidVersionName(t),i={name:s.OS_MAP.Android,version:t};return r&&(i.versionName=r),i}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=n.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:s.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=n.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||n.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||n.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:s.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=n.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=n.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=n.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.PlayStation4,version:t}}}];t.default=a,e.exports=t.default},94:function(e,t,r){t.__esModule=!0,t.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},s=r(18),a=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=n.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=n.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];t.default=a,e.exports=t.default},95:function(e,t,r){t.__esModule=!0,t.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},s=r(18),a=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:s.ENGINE_MAP.Blink};var t=n.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:s.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:s.ENGINE_MAP.Trident},r=n.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:s.ENGINE_MAP.Presto},r=n.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:s.ENGINE_MAP.Gecko},r=n.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:s.ENGINE_MAP.WebKit},r=n.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=a,e.exports=t.default}});let e4=globalThis?.navigator?.userAgent?(C&&C.__esModule?C.default:C).getParser(globalThis.navigator.userAgent):null,e9=e=>!!e4&&(e4.satisfies(e)||!1),e6=e9({safari:">=15"}),e5=e9({firefox:">0"}),e7=e9({safari:">0"}),te=e9({chrome:">0"}),tt=e9({edge:">0"}),tr=new WeakMap,ti=(e,t)=>e instanceof HTMLMediaElement?(((e,t)=>{let r=0===e.readyState,i=2!==e.networkState&&1!==e.networkState;if(e5&&"play"===t&&r&&i)throw Error("Can not play audio")})(e,t),"function"==typeof t?t(e):e[t]()):null,tn=(e,t)=>{let r=(tr.get(e)||Promise.resolve()).then(()=>{let r=ti(e,t);return r?.then?Promise.resolve(r):new Promise(e=>{setTimeout(()=>{e(r)},150)})}).then(()=>{tr.delete(e)}).catch(t=>{throw tr.delete(e),t});return tr.set(e,r),r},ts=class{constructor(e){this._eventsMap={[ev.VIDEO_START]:this._startVideo,[ev.VIDEO_PAUSE]:this._pauseVideo,[ev.VIDEO_RESET]:this._resetVideo,[ev.RESTART]:this._restart,[ev.DESTROY]:this._destroy},this._state=e.state,this._eventBus=e.eventBus,this._logger=e$(this._eventBus,"VideoElementController - PlaybackController"),this._logger.info("Created"),this._logger.debug("Initial state",this._state),this.init()}init(){this._logger.info("Initialization requested, attaching eventBus listeners"),this._eventBus.toggleSubscriptionBulk({action:"subscribe",callbacks:this._eventsMap})}_startVideo(){let e=this._state.getState().videoElement;if(this._logger.verbose("Starting the video"),e)return e.playbackRate||(e.playbackRate=1),this._logger.debug("Play call is added to the promises queue"),tn(e,"play").then(()=>{this._logger.debug("Play call resolved"),this._state.getState().canPlay&&this._eventBus.publish(ev.PLAYING,{})}).catch(e=>{this._state.setState({isAutoplayError:!0}),this._logger.error("An error occured when trying to play the video.",{error:e}),this._state.getState().canPlay&&this._eventBus.publish(ev.PAUSED,{})})}_pauseVideo(){this._logger.debug("Pausing the video");let e=this._state.getState().videoElement;if(e)return this._logger.debug("Pause call is added to the promises queue"),tn(e,"pause").then(()=>{this._logger.debug("Pause call resolved")}).catch(e=>{this._logger.warn("Could not pause video",e)})}_loadVideo(){this._logger.verbose("Loading the video");let e=this._state.getState().videoElement;if(!e?.src||!e.src.startsWith("blob"))return e?(this._logger.debug("Load call is added to the promises queue"),tn(e,"load").then(()=>{this._logger.debug("Load call resolved")}).catch(e=>{this._logger.warn("Could not load video",e)})):void 0;this._logger.debug("Stream seems to be blob. Skipping load")}_resetVideo(){this._logger.verbose("Resetting the video"),this._state.getState().videoElement&&(this._eventBus.publish(ev.LOADING,{}),this._loadVideo())}async _restart(){this._logger.verbose("Restarting the video"),await this._pauseVideo(),this._startVideo()}_destroy(){this._logger.info("Destroying"),this._eventBus.toggleSubscriptionBulk({action:"unsubscribe",callbacks:this._eventsMap})}};ej([eW],ts.prototype,"init",null),ej([eW],ts.prototype,"_startVideo",null),ej([eW],ts.prototype,"_pauseVideo",null),ej([eW],ts.prototype,"_loadVideo",null),ej([eW],ts.prototype,"_resetVideo",null),ej([eW],ts.prototype,"_restart",null),ej([eW],ts.prototype,"_destroy",null);let ta=e=>{e&&e.parentNode&&e.parentNode.removeChild(e)},to="\n  width: 100%;\n",tl=class{constructor(e){this._knownVideoElementStyles="",this._eventsMap={[ev.PLAYING]:this.startAnimationFrame,[ev.LOADING]:this.cancelAnimationFrame,[ev.REMOVE_MEDIA_STREAM]:this.cancelAnimationFrame},this._applyStyles=()=>{this._logger.debug("Apply styles for canvas and video elements");let{canvasElement:e,videoElement:t}=this._getElements();e&&t&&(this._knownVideoElementStyles=t.style.cssText,e.style.cssText=to,t.style.cssText=`      ${to}      opacity: 0;      position: absolute;      left: 0;      top: 0;    `)},this._state=e.state,this._eventBus=e.eventBus,this._logger=e$(this._eventBus,"VideoElementController - CanvasVideoRenderer");let t=document.createElement("canvas");this._canvasContext=t.getContext("2d"),e.className&&(t.className=e.className),this.init(),this._state.setState({canvasElement:t}),this._applyStyles(),this._logger.verbose("Canvas renderer has been created")}startAnimationFrame(){let{canvasElement:e,videoElement:t}=this._getElements();if(this.cancelAnimationFrame(),!e||!t)return;let{width:r,height:i}=e.getBoundingClientRect(),{videoWidth:n,videoHeight:s}=t;if(r/i<1&&n/s>1){let a=Math.max(r,n),o=r/n*s;if(this._canvasContext){let t=devicePixelRatio;e.width=a*t,e.height=i*t,this._canvasContext.scale(t,t)}this._canvasContext?.drawImage(t,r>a?(r-a)/2:0,(i-o)/2,a,o)}else{let a=Math.max(i,s),o=i/s*n;if(this._canvasContext){let t=devicePixelRatio;e.width=r*t,e.height=a*t,this._canvasContext.scale(t,t)}this._canvasContext?.drawImage(t,(r-o)/2,i>a?(i-a)/2:0,o,a)}this._state.getState().isLoading||(this._canvasAnimationFrameId=requestAnimationFrame(this.startAnimationFrame))}getCanvasElement(){return this._getElements().canvasElement}destroy(){this._eventBus.toggleSubscriptionBulk({action:"unsubscribe",callbacks:this._eventsMap});let{canvasElement:e,videoElement:t}=this._getElements();e&&e.parentNode&&e.parentNode.removeChild(e),t&&(t.style.cssText=this._knownVideoElementStyles,this._knownVideoElementStyles=""),this._state.setState({canvasElement:null}),this._logger.verbose("Canvas renderer was destroyed")}init(){this._eventBus.toggleSubscriptionBulk({action:"subscribe",callbacks:this._eventsMap})}cancelAnimationFrame(){this._canvasAnimationFrameId&&(cancelAnimationFrame(this._canvasAnimationFrameId),this._canvasAnimationFrameId=null)}_getElements(){let{videoElement:e,canvasElement:t}=this._state.getState();return{videoElement:e,canvasElement:t}}};ej([eW],tl.prototype,"startAnimationFrame",null),ej([eW],tl.prototype,"destroy",null),ej([eW],tl.prototype,"init",null),ej([eW],tl.prototype,"cancelAnimationFrame",null),ej([eW],tl.prototype,"_getElements",null);let tu=class{constructor(e){this._canvasVideoRenderer=null,this._config={},this._isLocalVideo=!1,this._eventsMap={[ev.SET_VOLUME]:this._setVolume,[ev.DESTROY]:this._destroy},this._state=e.state,this._eventBus=e.eventBus,this._logger=e$(this._eventBus,"VideoElementController - RenderController"),this._logger.info("Created"),this._logger.debug("Initial config",this._config),this._logger.debug("Initial state",this._state),this.init()}setConfig(e){this._logger.debug("Config update received, the new one:",e),this._config=e,this.applyConfigToVideoElement()}init(){this._logger.info("Initialization requested, attaching eventBus listeners"),this._eventBus.toggleSubscriptionBulk({action:"subscribe",callbacks:this._eventsMap})}getElements(){let{videoElement:e,canvasElement:t,ownContainer:r}=this._state.getState();return{videoElement:e,canvasElement:t,ownContainer:r}}getVideoElement(){return this.getElements().videoElement}getCanvasElement(){return this.getElements().canvasElement}renderVideoInto(e){let{ownContainer:t,videoElement:r}=this.getElements();this._logger.debug("renderVideoInto method was called");let i=!1;if(e&&r){let n=t||e;r.parentElement!==n&&(i=!0,n.appendChild(r));let s=this._canvasVideoRenderer?.getCanvasElement();this._canvasVideoRenderer&&s?.parentElement!==n&&(i=!0,n.appendChild(s),this._logger.info("Canvas element has been rendered to DOM")),n===t&&t.parentElement!==e&&(i=!0,e.appendChild(t)),i?this._logger.info("Video element has been rendered to DOM"):this._logger.verbose("Skipping video element render: video element is already mounted to the DOM.")}}setVideoElement(e,t){this._logger.debug("Video element updated",{videoElement:e}),e!==this.getVideoElement()?(this._isLocalVideo&&(this._logger.verbose("Removing video element and container from document"),ta(this.getElements().videoElement),ta(this.getElements().ownContainer)),this._state.setState({videoElement:e,ownContainer:t}),this.applyConfigToVideoElement()):this._logger.verbose("Received video element is equal to the previous one. Skipping")}applyConfigToVideoElement(){if(this._logger.debug("Applying config to the video element"),!this.getVideoElement())return void this._logger.verbose("No video element known, could not apply config");let e=this.getVideoElement();if(!e)return;let{isNonAnonymous:t,isMuted:r,nativeControls:i,videoElementClassName:n,canvasElementClassName:s,shouldUseCanvas:a,rootElement:o,autoplay:l}=this._config;this._logger.verbose("Applied config",this._config),l&&(e.autoplay=!0),e.playsInline=!0,void 0!==i&&(e.controls=!!i),void 0!==r&&(e.muted=!!r),void 0!==t&&(t?e.removeAttribute("crossOrigin"):e.crossOrigin="anonymous"),n&&(e.className=n);let u=[this._state.getState().volume,this._config.volume].find(e=>void 0!==e);if(void 0!==u&&this._setVolume({volume:u}),a&&!this._canvasVideoRenderer&&(this._logger.verbose("Adding canvas as requested"),this._addCanvasVideoRenderer(),this._state.getState().isPlaying&&this._canvasVideoRenderer.startAnimationFrame()),!a&&this._canvasVideoRenderer){let e=this._state.getState().stream;this._logger.verbose("Removing canvas renderer"),e&&this._eventBus.publish(ev.UPDATE_MEDIA_STREAM,e),this._destroyCanvasRenderer()}let d=this.getCanvasElement();d&&(e.className="",s&&(d.className=s)),o&&this.renderVideoInto(o)}destroy(){if(this._logger.info("Destroying"),this._destroyCanvasRenderer(),this._isLocalVideo){this._logger.debug("Removing video element and container from document in destroy");let{videoElement:e,ownContainer:t}=this.getElements();ta(e),ta(t)}}createVideoElement(){let e,t;this._logger.info("Creating video element"),this._config.videoElement?(this._logger.debug("External video element passed from config - using existing one",this._config.videoElement),this._isLocalVideo=!1,e=this._config.videoElement):(this._isLocalVideo=!0,e=document.createElement("video"),t=document.createElement("div"),this._logger.debug("No external video element provided in config - created the new one",{videoElement:e,ownContainer:t}),t.style.position="relative"),this.setVideoElement(e,t),this._eventBus.publish(ev.VIDEO_ELEMENT_RECREATED,{videoElement:this.getVideoElement()})}_addCanvasVideoRenderer(){this._logger.debug("Adding canvas renderer"),this._canvasVideoRenderer||(this._canvasVideoRenderer=new tl({videoElement:this.getVideoElement(),className:this._config.videoElementClassName,state:this._state,eventBus:this._eventBus}))}_destroyCanvasRenderer(){this._logger.debug("Destroying canvas renderer"),this._canvasVideoRenderer&&(this._canvasVideoRenderer.destroy(),this._canvasVideoRenderer=null)}_setVolume({volume:e}){let t=this.getVideoElement();t&&(((e,t)=>{if(!t||t<0)e.muted=!0,e.volume=0;else{let r=Math.min(t,1);isNaN(r)||(e.muted=!1,e.volume=r)}})(t,e),this._logger.verbose(`Video volume level has been set to ${e}`))}_destroy(){this._logger.info("Destroying"),this._eventBus.toggleSubscriptionBulk({action:"unsubscribe",callbacks:this._eventsMap})}};ej([eW],tu.prototype,"getElements",null),ej([eW],tu.prototype,"getVideoElement",null),ej([eW],tu.prototype,"getCanvasElement",null),ej([eW],tu.prototype,"renderVideoInto",null),ej([eW],tu.prototype,"setVideoElement",null),ej([eW],tu.prototype,"applyConfigToVideoElement",null),ej([eW],tu.prototype,"createVideoElement",null),ej([eW],tu.prototype,"_addCanvasVideoRenderer",null),ej([eW],tu.prototype,"_destroyCanvasRenderer",null),ej([eW],tu.prototype,"_setVolume",null),ej([eW],tu.prototype,"_destroy",null);let td=class{constructor(e){this._config={},this._eventsMap={[ev.PLAYING]:this._handlePlaying,[ev.LOADING]:this._handleLoading,[ev.VIDEO_PAUSE]:this._handlePause,[ev.CAN_PLAY]:this._handleCanPlay,[ev.PAUSED]:this._handlePaused,[ev.RESTART]:this._handleRestart,[ev.UPDATED]:this._handleUpdate,[ev.STALLED]:this._handleStalled,[ev.WAITING]:this._handleWaiting,[ev.UPDATE_PLAYER_RESOLUTION]:this._handleUpdatePlayerResolution,[ev.ERROR]:this._handleError,[ev.SET_VOLUME]:this._handleSetVolume,[ev.DESTROY]:this.destroy},this._state=e.state,this._eventBus=e.eventBus,this._logger=e$(this._eventBus,"VideoElementController - StateController"),this._logger.info("Created"),this._logger.verbose("Initial state",e.state),this.init()}setConfig(e){this._logger.debug("Config update received, the new one:",e),this._config=e}destroy(){this._logger.info("Destroy"),this._eventBus.toggleSubscriptionBulk({action:"unsubscribe",callbacks:this._eventsMap}),this._state.resetState(),this._state.setState({isDestroyed:!0})}init(){this._logger.info("Initialization requested, attaching eventBus listeners"),this._eventBus.toggleSubscriptionBulk({action:"subscribe",callbacks:this._eventsMap})}_updateState(e){let t=this._state.getState().videoPlaybackState,r=t;e.isPlaying?r=e_.PLAYING:e.isLoading?r=e_.LOADING:e.isPaused?r=e_.PAUSED:e.isError&&(r=e_.ERROR),this._logger.debug(`State updated: ${t} -> ${r}`),this._state.setState({...e,videoPlaybackState:r}),t!==r&&this._eventBus.publish(ev.VIDEO_PLAYBACK_STATE_CHANGED,{prevState:t,nextState:r})}_handlePlaying(){this._logger.debug("Playing event received"),this._updateState({isPlaying:!0,startedPlaying:!0,isLoading:!1,isStalled:!1,isWaiting:!1,isPaused:!1,isError:!1})}_handleLoading(){this._logger.debug("Loading event received"),this._updateState({isLoading:!0,isPlaying:!1})}_handlePause(){this._logger.debug("Pause event received"),this._updateState({isPlaying:!1,isPaused:!0})}_handlePaused(){this._logger.debug("Paused event received"),this._updateState({isPlaying:!1,isLoading:!1,isPaused:!0})}_handleCanPlay(){this._logger.debug("CanPlay event received"),this._updateState({canPlay:!0,isDestroyed:!1})}_handleRestart(){this._logger.debug("Restart event received"),this._updateState({isRestarted:!0})}_handleStalled(){this._logger.debug("Stalled event received"),this._updateState({isStalled:!0})}_handleWaiting(){this._logger.debug("Waiting event received"),this._updateState({isWaiting:!0})}_handleError(){this._logger.debug("Error event received"),this._updateState({isError:!0})}_handleSetVolume({volume:e}){this._logger.debug("Volume event received",{volume:e}),this._updateState({volume:e})}_handleUpdatePlayerResolution(e){this._logger.debug("Player resolution event received",{height:e.height,width:e.width}),this._updateState({videoElementResolution:{height:e.height,width:e.width}})}_handleUpdate(){this._logger.debug("Update event received"),this._updateState({canPlay:!1,isLoading:!0,isPlaying:!1,isRestarted:!1,isPaused:!1,isError:!1})}};ej([eW],td.prototype,"destroy",null),ej([eW],td.prototype,"init",null),ej([eW],td.prototype,"_updateState",null),ej([eW],td.prototype,"_handlePlaying",null),ej([eW],td.prototype,"_handleLoading",null),ej([eW],td.prototype,"_handlePause",null),ej([eW],td.prototype,"_handlePaused",null),ej([eW],td.prototype,"_handleCanPlay",null),ej([eW],td.prototype,"_handleRestart",null),ej([eW],td.prototype,"_handleStalled",null),ej([eW],td.prototype,"_handleWaiting",null),ej([eW],td.prototype,"_handleError",null),ej([eW],td.prototype,"_handleSetVolume",null),ej([eW],td.prototype,"_handleUpdatePlayerResolution",null),ej([eW],td.prototype,"_handleUpdate",null);let tc=class{constructor(e){this._config={},this._eventsMap={[ev.PLAYING]:this._cancelResetStream,[ev.LOADING]:this._cancelResetStream,[ev.LOADED]:this._cancelResetStream,[ev.PAUSED]:this._cancelResetStream,[ev.UPDATED]:this._cancelResetStream,[ev.CANCEL_RESET_STREAM]:this._cancelResetStream,[ev.STREAM_RESET]:this._resetStream,[ev.UPDATE_MEDIA_STREAM]:this.updateMediaStream,[ev.DESTROY]:this.destroy},this._getIsSrcObjectAvailable=()=>void 0!==this._props.getVideoElement()?.srcObject,this._state=e.state,this._eventBus=e.eventBus,this._logger=e$(this._eventBus,"VideoElementController - StreamController"),this._props=e,this._logger.info("Created"),this._logger.verbose("Initial state",e.state),this.init()}setConfig(e){this._logger.debug("Config update received, the new one:",e),this._config=e}updateMediaStream(e){this._logger.info("Updating media stream",{stream:e}),this._props.getVideoElement()?(this._attachStream(e),this._eventBus.publish(ev.VIDEO_START,{})):this._logger.debug("No video element known. Skipping media stream update")}removeMediaStream(){this._logger.info("Removing media stream");let e=this._props.getVideoElement();e?(this._eventBus.publish(ev.VIDEO_PAUSE,{}),this._eventBus.publish(ev.REMOVE_MEDIA_STREAM,{}),this._getIsSrcObjectAvailable()?(this._logger.debug("Setting srcObject to null"),e.srcObject=null):(this._logger.debug("Revoking object url",{url:e.src}),window.URL.revokeObjectURL(e.src)),e.src&&(this._logger.debug("Removing src attribute from video"),e.removeAttribute("src"))):this._logger.debug("No video element known. Skipping media stream remove")}destroy(){this._logger.info("Destroying"),this._eventBus.toggleSubscriptionBulk({action:"unsubscribe",callbacks:this._eventsMap})}init(){this._logger.info("Initialization requested, attaching eventBus listeners"),this._eventBus.toggleSubscriptionBulk({action:"subscribe",callbacks:this._eventsMap})}_attachStream(e){this._logger.info("Attaching media stream",{stream:e});let t=this._props.getVideoElement();t&&e?t.src!==e?"string"==typeof e?(this._logger.debug("Setting video element src attribute"),t.src=e):this._getIsSrcObjectAvailable()?(this._logger.debug("Setting video element srcObject attribute"),t.srcObject=e):(t.src=window.URL.createObjectURL(e),this._logger.debug(`Got MediaStream as stream, but srcObject is not available. Created new object URL: ${t.src}`)):this._logger.debug("Current video element src attribute value is equal to the new stream. Skipping stream set"):this._logger.debug("No video element or stream defined. Skipping stream set")}_cancelResetStream(){this._logger.debug("Stream reset action cancel required"),this._streamResetDelayId&&(clearTimeout(this._streamResetDelayId),this._logger.debug("Stream reset action cancelled"))}_resetStream({timeout:e}){this._logger.debug("Reset stream required"),e?(this._cancelResetStream(),this._streamResetDelayId=setTimeout(()=>{this._logger.debug("Resetting stream timeout fired");let e=!1;this._config.onResetStream&&(e=this._config.onResetStream());let t=this._state.getState().stream;if(t&&!e){if("string"==typeof t&&t.startsWith("blob"))return void this._logger.debug("Streams seems to be object url. Skipping reset");this._logger.debug("Resetting stream"),this.removeMediaStream(),this.updateMediaStream(t)}},e)):this._logger.verbose("No timeout set, skipping stream reset",{timeout:e})}};ej([eW],tc.prototype,"updateMediaStream",null),ej([eW],tc.prototype,"removeMediaStream",null),ej([eW],tc.prototype,"destroy",null),ej([eW],tc.prototype,"init",null),ej([eW],tc.prototype,"_attachStream",null),ej([eW],tc.prototype,"_cancelResetStream",null),ej([eW],tc.prototype,"_resetStream",null);var th=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},tf="object"==typeof eT&&eT&&eT.Object===Object&&eT,t_="object"==typeof self&&self&&self.Object===Object&&self,tg=tf||t_||Function("return this")(),tp=function(){return tg.Date.now()},tm=/\s/,tv=/^\s+/,ty=tg.Symbol,tb=Object.prototype,tE=tb.hasOwnProperty,tR=tb.toString,tS=ty?ty.toStringTag:void 0,tT=Object.prototype.toString,tL=ty?ty.toStringTag:void 0,tA=/^[-+]0x[0-9a-f]+$/i,tP=/^0b[01]+$/i,tB=/^0o[0-7]+$/i,tC=parseInt,tw=function(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||null!=t&&"object"==typeof t&&"[object Symbol]"==(null==t?void 0===t?"[object Undefined]":"[object Null]":tL&&tL in Object(t)?function(e){var t=tE.call(e,tS),r=e[tS];try{e[tS]=void 0;var i=!0}catch(e){}var n=tR.call(e);return i&&(t?e[tS]=r:delete e[tS]),n}(t):tT.call(t)))return NaN;if(th(e)){var t,r,i="function"==typeof e.valueOf?e.valueOf():e;e=th(i)?i+"":i}if("string"!=typeof e)return 0===e?e:+e;e=(r=e)?r.slice(0,function(e){for(var t=e.length;t--&&tm.test(e.charAt(t)););return t}(r)+1).replace(tv,""):r;var n=tP.test(e);return n||tB.test(e)?tC(e.slice(2),n?2:8):tA.test(e)?NaN:+e},tO=Math.max,tD=Math.min,tI=function(e,t,r){var i=!0,n=!0;if("function"!=typeof e)throw TypeError("Expected a function");return th(r)&&(i="leading"in r?!!r.leading:i,n="trailing"in r?!!r.trailing:n),function(e,t,r){var i,n,s,a,o,l,u=0,d=!1,c=!1,h=!0;if("function"!=typeof e)throw TypeError("Expected a function");function f(t){var r=i,s=n;return i=n=void 0,u=t,a=e.apply(s,r)}function _(e){var r=e-l;return void 0===l||r>=t||r<0||c&&e-u>=s}function g(){var e,r=tp();if(_(r))return p(r);o=setTimeout(g,(e=t-(r-l),c?tD(e,s-(r-u)):e))}function p(e){return o=void 0,h&&i?f(e):(i=n=void 0,a)}function m(){var e,r=tp(),s=_(r);if(i=arguments,n=this,l=r,s){if(void 0===o)return u=e=l,o=setTimeout(g,t),d?f(e):a;if(c)return clearTimeout(o),o=setTimeout(g,t),f(l)}return void 0===o&&(o=setTimeout(g,t)),a}return t=tw(t)||0,th(r)&&(d=!!r.leading,s=(c="maxWait"in r)?tO(tw(r.maxWait)||0,t):s,h="trailing"in r?!!r.trailing:h),m.cancel=function(){void 0!==o&&clearTimeout(o),u=0,i=l=n=o=void 0},m.flush=function(){return void 0===o?a:p(tp())},m}(e,t,{leading:i,maxWait:t,trailing:n})};let tM="ristrettoWasRestarted",tF=0,tN=0,tk=class{constructor(e){this._shouldSetNextUpdateVideoDurationId=!0,this._config={},this._onNativeTimeUpdateHandlerThrottled=tI(this._onNativeTimeUpdateHandler,2e3,{trailing:!1}),this._eventsMap={[ev.TIME_UPDATE_NATIVE]:this._onNativeTimeUpdateHandlerThrottled,[ev.DESTROY]:this._destroy},this._state=e.state,this._eventBus=e.eventBus,this._logger=e$(this._eventBus,"VideoElementController - TimeUpdateController"),this._props=e,this._logger.info("Created"),this._logger.debug("Initial state",e.state),this._logger.debug("Initial props",e)}setConfig(e){this._logger.debug("Config update received, the new one:",e);let t=e.timeoutUpdateStatusPlaying!==this._config.timeoutUpdateStatusPlaying;this._config=e,t&&(this._eventsMap[ev.TIME_UPDATE_NATIVE]=tI(this._onNativeTimeUpdateHandler,e.timeoutUpdateStatusPlaying,{trailing:!1}),this._eventBus.toggleSubscriptionBulk({action:"unsubscribe",callbacks:this._eventsMap}),this.init())}init(){this._logger.info("Initialization requested, attaching eventBus listeners"),this._eventBus.toggleSubscriptionBulk({action:"subscribe",callbacks:this._eventsMap})}startTimeUpdate(){this._stopTimeUpdate(),this._shouldSetNextUpdateVideoDurationId&&this._config?(this._updateVideoDurationId=setTimeout(this._onTimeUpdate,this._config.timeoutUpdateVideoDuration),this._publishUpdatePlayerResolutionIfNeeded()):this._shouldSetNextUpdateVideoDurationId=!0}_onNativeTimeUpdateHandler(e){if(this._logger.debug("Native video timeUpdate caught"),e?.originalEvent?.defaultPrevented)return;let t=this._props.getVideoElement(),{canPlay:r,isPlaying:i,isLoading:n,isRestarted:s}=this._state.getState();if(this._publishUpdatePlayerResolutionIfNeeded(),!r)return void this._logger.verbose("CanPlay shared state is false. Skipping");this._eventBus.publish(ev.RESET_CHECKING_AUTOPLAY_COUNT,{});let a=tF!==t?.currentTime;this._logger.verbose(`Video current time is ${a?"":"not"} changed`),a?(this._eventBus.publish(ev.CANCEL_RESET_STREAM,{}),!e6||s||localStorage?.getItem(tM)||(localStorage.setItem(tM,"1"),this._eventBus.publish(ev.RESTART,{})),t&&(tF=t.currentTime),(!i||n)&&this._eventBus.publish(ev.PLAYING,{})):n?this._eventBus.publish(ev.VIDEO_RESET,{}):this._eventBus.publish(ev.LOADING,{})}_stopTimeUpdate(){clearTimeout(this._updateVideoDurationId)}_onTimeUpdate(){if(!this._state.getState().canPlay)return void this.startTimeUpdate();let e=this._props.getVideoElement();e&&tN!==e.currentTime&&(tN=e.currentTime),this.startTimeUpdate()}_publishUpdatePlayerResolutionIfNeeded(){let e=this._props.getVideoElement();if(e){let{videoWidth:t,videoHeight:r}=e,{videoElementResolution:i}=this._state.getState();(!i||i.height!==r||i.width!==t)&&this._config.minimalPossibleVideoDimension&&Math.min(r,t)>this._config.minimalPossibleVideoDimension&&(this._logger.verbose(`Stored resolution is ${i?.width}x${i?.height}, current is ${t}x${r}`),this._eventBus.publish(ev.UPDATE_PLAYER_RESOLUTION,{width:t,height:r}))}}_destroy(){this._logger.info("Destroying"),this._eventBus.toggleSubscriptionBulk({action:"unsubscribe",callbacks:this._eventsMap}),this._shouldSetNextUpdateVideoDurationId=!1,this._stopTimeUpdate()}};ej([eW],tk.prototype,"init",null),ej([eW],tk.prototype,"startTimeUpdate",null),ej([eW],tk.prototype,"_onNativeTimeUpdateHandler",null),ej([eW],tk.prototype,"_stopTimeUpdate",null),ej([eW],tk.prototype,"_onTimeUpdate",null),ej([eW],tk.prototype,"_publishUpdatePlayerResolutionIfNeeded",null),ej([eW],tk.prototype,"_destroy",null);let tx=class{constructor(e){this._config={},this._timeUpdateEventWasLogged=!1,this._eventsMap={[ev.VIDEO_ELEMENT_RECREATED]:this._handleVideoElementRecreated,[ev.DESTROY]:this._handleDestroy},this._onVideoClick=e=>{this._logger.verbose('"click" video native event fired'),this._handleNativeEvent(e),this._eventBus.publish(ev.CLICK,{originalEvent:e})},this._onSeeked=e=>{this._logger.verbose('"seeked" video native event fired'),this._handleNativeEvent(e),this._eventBus.publish(ev.FORCE_PLAY_AFTER_PAUSE,{reason:"seeked video native event"})},this._onRateChange=e=>{this._logger.verbose('"ratechange" video native event fired'),this._handleNativeEvent(e),e.target&&!e.target.playbackRate&&this._eventBus.publish(ev.FORCE_PLAY_AFTER_PAUSE,{reason:"video playbackRate is 0"})},this._onCanPlayThrough=e=>{this._logger.verbose('"canplaythrough" video native event fired');let t=this._state.getState();this._handleNativeEvent(e),(t.isStalled||t.isWaiting)&&this._eventBus.publish(ev.FORCE_PLAY_AFTER_PAUSE,{reason:"canplaythrough video native event fired, and video is in the state of either stalled or waiting"})},this._onPlayingHandler=e=>{this._logger.verbose('"playing" video native event fired'),this._logger.info("Video has started playing"),this._handleNativeEvent(e),this._eventBus.publish(ev.PLAYING,{isAutoplay:!this._state.getState().isAutoplayError})},this._onAbortHandler=e=>{this._logger.verbose('"abort" video native event fired'),this._handleNativeEvent(e),e.defaultPrevented||this._eventBus.publish(ev.LOADING,{})},this._onPauseHandler=e=>{this._logger.verbose('"pause" video native event fired'),this._handleNativeEvent(e),this._eventBus.publish(ev.VIDEO_PAUSE,{}),this._eventBus.publish(ev.FORCE_PLAY_AFTER_PAUSE,{reason:"pause video event fired (most likely user paused the video manually)"})},this._onCanPlayHandler=e=>{this._logger.verbose('"canplay" video native event fired'),this._handleNativeEvent(e),e.defaultPrevented||(this._state.setState({canPlay:!0}),this._eventBus.publish(ev.CAN_PLAY,{}))},this._onErrorHandler=e=>{if(this._logger.error('"error" video native event fired',{error:e}),this._handleNativeEvent(e),this._eventBus.publish(ev.ERROR,{originalEvent:e}),!e.defaultPrevented){let{MEDIA_ERR_SRC_NOT_SUPPORTED:e}=MediaError,t=this._props.getVideoElement()?.error;t?.code!==e&&(this._logger.verbose("Video element error is not of MEDIA_ERR_SRC_NOT_SUPPORTED kind. Requesting reset"),this._eventBus.publish(ev.VIDEO_RESET,{}))}},this._onTimeUpdateHandler=e=>{this._handleNativeEvent(e),this._timeUpdateEventWasLogged||(this._logger.verbose('"timeupdate" video native event fired for the first time'),this._timeUpdateEventWasLogged=!0),this._eventBus.publishSync(ev.TIME_UPDATE_NATIVE,{originalEvent:e})},this._onLoadStartHandler=e=>{this._handleNativeEvent(e),this._logger.verbose('"loadstart" video native event fired');let{timeoutUpdateStream:t}=this._config;this._eventBus.publish(ev.LOADING,{}),this._eventBus.publish(ev.STREAM_RESET,{reason:"onLoadStartHandler",timeout:t})},this._onLoadedDataHandler=e=>{this._logger.verbose('"loadeddata" video native event fired'),this._handleNativeEvent(e),this._eventBus.publish(ev.LOADED,{})},this._onWaiting=e=>{this._logger.verbose('"waiting" video native event fired');let{timeoutWaitingStream:t}=this._config;this._handleNativeEvent(e),this._eventBus.publish(ev.WAITING,{}),this._eventBus.publish(ev.LOADING,{}),this._eventBus.publish(ev.STREAM_RESET,{reason:"onWaiting",timeout:t})},this._onStalled=e=>{this._logger.verbose('"stalled" video native event fired');let{timeoutWaitingStream:t}=this._config;this._handleNativeEvent(e),this._eventBus.publish(ev.STALLED,{}),this._eventBus.publish(ev.STREAM_RESET,{reason:"onStalled",timeout:t})},this._onEndFullscreenHandler=e=>{this._handleNativeEvent(e)},this._props=e,this._state=e.state,this._eventBus=e.eventBus,this._logger=e$(this._eventBus,"VideoElementController - VideoEventsHandler"),this.init()}setConfig(e){this._config=e}init(){this._eventBus.toggleSubscriptionBulk({action:"subscribe",callbacks:this._eventsMap})}toggleEvents(e,t){let r=t||this._props.getVideoElement();if(!r)return;let i="attach"===e?"addEventListener":"removeEventListener";r[i]("click",this._onVideoClick),r[i]("playing",this._onPlayingHandler),r[i]("abort",this._onAbortHandler),r[i]("pause",this._onPauseHandler),r[i]("canplay",this._onCanPlayHandler),r[i]("error",this._onErrorHandler),r[i]("timeupdate",this._onTimeUpdateHandler),r[i]("loadstart",this._onLoadStartHandler),r[i]("loadeddata",this._onLoadedDataHandler),r[i]("waiting",this._onWaiting),r[i]("stalled",this._onStalled),r[i]("canplaythrough",this._onCanPlayThrough),r[i]("seeked",this._onSeeked),r[i]("ratechange",this._onRateChange),r[i]("webkitendfullscreen",this._onEndFullscreenHandler),"addEventListener"===i?this._logger.verbose("event listeners are ATTACHED to the video element"):this._logger.verbose("event listeners are DETACHED from the video element")}_handleVideoElementRecreated(){this.toggleEvents("attach")}_handleDestroy(){this.toggleEvents("detach"),this._eventBus.toggleSubscriptionBulk({action:"unsubscribe",callbacks:this._eventsMap})}_handleNativeEvent(e){this._eventBus.publishSync(ev.NATIVE_EVENT,{eventName:e.type,event:e})}};ej([eW],tx.prototype,"init",null),ej([eW],tx.prototype,"_handleVideoElementRecreated",null),ej([eW],tx.prototype,"_handleDestroy",null);let tU={canPlay:!1,isLoading:!0,isError:!1,isAutoplayError:!1,isPaused:!1,isPlaying:!1,isRestarted:!1,isStalled:!1,isWaiting:!1,isDestroyed:!1,videoPlaybackState:e_.IDLE,startedPlaying:!1},tV=class{constructor(e){this._initState={...e},this._state={...e}}setState(e,t){Object.assign(this._state,e),t&&t(this._state)}getState(){return this._state}resetState(){this.setState(this._initState)}},tq=class{constructor(){this._config={...eX.videoElementControllerConfig},this.attachVideoElementEvents=()=>{this._logger.debug("Attach event listeners"),this._eventsHandler.toggleEvents("attach"),this._timeUpdateController.startTimeUpdate()},this.detachVideoElementEvents=e=>{this._logger.debug("Detach event listeners"),this._eventsHandler.toggleEvents("detach",e)},this._updated=()=>{this._eventBus.publish(ev.UPDATED,{})},this._eventBus=new eD,this._loggerTransport=new ez(this._eventBus),this._logger=e$(this._eventBus,"VideoController"),this._logger.info("Created"),this._logger.debug("Initial config",this._config),this._createControllers()}addEventListener(e,t){this._logger.verbose(`Attaching ${e} event listener`),this._customEventsEmitter.addEventListener(e,t)}removeEventListener(e,t){this._logger.verbose(`Detaching ${e} event listener`),this._customEventsEmitter.removeEventListener(e,t)}getIsPlaying(){return this._state.getState().isPlaying}getVideoElement(){return this._state.getState().videoElement}getCanvasElement(){return this._state.getState().canvasElement}updateConfig(e){this._config={...this._config,...e},this._logger.debug("Config update received, the new one: ",this._config),e.isRemote&&this.attachVideoElementEvents(),this._syncConfig()}setVideoElement(e){let t=this._state.getState().videoElement;e!==t&&(t&&this.detachVideoElementEvents(t),this._logger.info("Video element set",{videoElement:e}),this._renderController.setVideoElement(e),this.attachVideoElementEvents())}createVideoElement(){return this._logger.info("Creating video element"),this._renderController.createVideoElement(),this.getVideoElement()}setStream(e){if(this._logger.info("Setting media stream"),this._state.getState().stream!==e)return e?this._streamController.updateMediaStream(e):this._streamController.removeMediaStream(),this._updated(),this._state.setState({stream:e}),this;this._logger.verbose("Previous stream is equal to the new one. Skipping.")}renderVideoInto(e){this._logger.info("Rendering video element into container",e),this._renderController.renderVideoInto(e)}setVolume(e){this._logger.info("Setting volume of the video element",{volume:e}),this._eventBus.publish(ev.SET_VOLUME,{volume:e})}getState(){return this._state.getState()}destroy(){this._logger.info("Destroying"),this._config={...eX.videoElementControllerConfig},this.detachVideoElementEvents(),this._streamController.removeMediaStream(),this._renderController.destroy(),this._eventBus.publishSync(ev.DESTROY,{}),this._logger.info("VideoElementController was destroyed"),this._loggerTransport?.destroy()}reinit(){this._logger.info("Reinit requested"),[this._autoplayController,this._customEventsEmitter,this._playbackController,this._streamController,this._stateController,this._timeUpdateController,this._renderController,this._eventsHandler].forEach(e=>{e&&e.init()}),this.attachVideoElementEvents(),this._logger.info("VideoElementController was reinited")}setLoggerLevels(e,t=[],r=[]){this._logger.info("Setting new log level",{levels:e}),this._loggerTransport&&(this._loggerTransport.destroy(),this._loggerTransport=null),e.length&&(this._loggerTransport=new ez(this._eventBus,e,t,r))}_syncConfig(){this._logger.verbose("Sycronizing configs across all controllers"),this._autoplayController?.setConfig(this._config),this._eventsHandler.setConfig(this._config),this._streamController.setConfig(this._config),this._timeUpdateController.setConfig(this._config),this._renderController.setConfig(this._config),this._stateController.setConfig(this._config)}_createControllers(){this._logger.verbose("Creating all controllers"),this._state=new tV(tU);let e={getVideoElement:this.getVideoElement,state:this._state,eventBus:this._eventBus};this._autoplayController=new e2(e),this._customEventsEmitter=new e8(e),this._eventsHandler=new tx(e),this._playbackController=new ts(e),this._streamController=new tc(e),this._stateController=new td(e),this._timeUpdateController=new tk(e),this._renderController=new tu(e),this._logger.verbose("Controllers created")}};ej([eW],tq.prototype,"addEventListener",null),ej([eW],tq.prototype,"removeEventListener",null),ej([eW],tq.prototype,"getIsPlaying",null),ej([eW],tq.prototype,"getVideoElement",null),ej([eW],tq.prototype,"getCanvasElement",null),(w=ey||(ey={}))[w.FATAL=0]="FATAL",w[w.ERROR=1]="ERROR",w[w.WARN=2]="WARN",w[w.INFO=3]="INFO",w[w.DEBUG=4]="DEBUG",w[w.VERBOSE=5]="VERBOSE",ey.FATAL,ey.ERROR,ey.WARN,ey.INFO,ey.DEBUG,ey.VERBOSE,ey.FATAL,ey.WARN,ey.ERROR,ey.INFO,ey.DEBUG,ey.VERBOSE,(O=eb||(eb={}))[O.MEDIA_DEVICES_UPDATED=0]="MEDIA_DEVICES_UPDATED";let tG=()=>{let e=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices)||navigator.getUserMedia&&eV(navigator.getUserMedia.bind(navigator))||navigator.webkitGetUserMedia&&eV(navigator.webkitGetUserMedia.bind(navigator))||navigator.mozGetUserMedia&&eV(navigator.mozGetUserMedia.bind(navigator));return t=>e.call(navigator,t)};(D=eE||(eE={})).VIDEO_INPUT="videoinput",D.AUDIO_INPUT="audioinput",D.AUDIO_OUTPUT="audiooutput";let tW=(e,t)=>e.filter(e=>e.kind===t);(I=eR||(eR={})).SYSTEM_PERMISSION_DENIED="SystemPermissionDenied",I.USER_PERMISSION_DENIED="UserPermissionDenied",I.COULD_NOT_START_VIDEO_SOURCE="CouldNotStartVideoSource",I.GENERIC="Generic";let tj=async e=>new Promise((t,r)=>{navigator.mediaDevices.getUserMedia(e??{audio:!0,video:!0}).then(e=>{e.getTracks().forEach(e=>{e.stop()}),t(!0)}).catch(e=>{let t=e.name,i=e.message,n=eR.GENERIC;te?"NotAllowedError"===t?"Permission denied by system"===i?n=eR.SYSTEM_PERMISSION_DENIED:"Permission denied"===i&&(n=eR.USER_PERMISSION_DENIED):"NotReadableError"===t&&(n=eR.COULD_NOT_START_VIDEO_SOURCE):e7?"NotAllowedError"===t&&(n=eR.USER_PERMISSION_DENIED):tt?"NotAllowedError"===t?n=eR.USER_PERMISSION_DENIED:"NotReadableError"===t&&(n=eR.COULD_NOT_START_VIDEO_SOURCE):e5&&("NotFoundError"===t||"NotReadableError"===t?n=eR.SYSTEM_PERMISSION_DENIED:"NotAllowedError"===t?n=eR.USER_PERMISSION_DENIED:"AbortError"===t&&(n=eR.COULD_NOT_START_VIDEO_SOURCE)),r({type:n,name:e.name,message:e.message})})});(M=eS||(eS={})).LIVE="live",M.ENDED="ended";let tH=e=>{if(!e)return!0;let{muted:t,enabled:r,readyState:i}=e;return t||!r||i===eS.ENDED};ej([eW],(class extends e3{constructor(){super(),this._currentMediaStream=null,this._mediaCheckCache=null,this._mediaDevices=null,this._eventBus=new eD,this._logger=e$(this._eventBus,"UserMedia"),this._loggerTransport=new ez(this._eventBus),this._logger.info("Created"),navigator.mediaDevices.addEventListener("devicechange",this._onDevicesChanged)}destroy(){navigator.mediaDevices.removeEventListener("devicechange",this._onDevicesChanged),this._logger.info("Destroyed"),this._stopCurrentStream()}async requestPermissions(){if(this._logger.info("Requesting permissions"),this._mediaCheckCache)return this._logger.debug("Has previous check results cached. Returning it"),this._logger.info("Check results",{...this._mediaCheckCache}),this._mediaCheckCache;try{return this._logger.verbose("Request both video and audio permissions"),await tj({video:!0,audio:!0}),this._logger.debug("No exceptions thrown while checking permissions. Saving both as available in cache"),this._mediaCheckCache={video:{isAvailable:!0,error:null},audio:{isAvailable:!0,error:null}},this._logger.info("Check results",{...this._mediaCheckCache}),this._mediaCheckCache}catch(t){this._logger.debug("Got an exception while checking both audio and video permissions. Checking them individually",{exception:t.toString()});let e={video:{isAvailable:!1,error:null},audio:{isAvailable:!1,error:null}};return e.video=await this._checkKindPermissions({video:!0,audio:!1}),this._logger.verbose(`Video permissions result: ${e.video.isAvailable}`),e.audio=await this._checkKindPermissions({video:!1,audio:!0}),this._logger.verbose(`Audio permissions result: ${e.audio.isAvailable}`),this._mediaCheckCache=e,this._logger.debug("Got individual check results",{...e}),this._logger.info("Check results",{...this._mediaCheckCache}),this._mediaCheckCache}}async getVideoDevices(){this._logger.info("Getting video devices list");let e=await this._getMediaDevices();return this._logger.info("Got video devices",e),e.videoInputs}async getAudioInputDevices(){this._logger.info("Getting audio input devices list");let e=await this._getMediaDevices();return this._logger.info("Got audio input devices",e),e.audioInputs}async getAudioOutputDevices(){this._logger.info("Getting audio output devices list");let e=await this._getMediaDevices();return this._logger.info("Got audio output devices",e),e.audioOutputs}async getMediaStream(e,t){var r,i;this._logger.info("Getting media stream",{constraints:e,defaults:t});let n={};if(e.audio&&(this._logger.debug("Audio constraints are specified in requested constraints. Mapping it"),n.audio=!!(i=e.audio)&&("boolean"==typeof i?i:!!i.deviceId&&{deviceId:e7?i.deviceId:{exact:i.deviceId},channelCount:2}),this._logger.debug("Audio constraints mapped",{constraints:n.audio})),e.video&&(this._logger.debug("Video constraints are specified in requested constraints. Mapping it"),n.video=((e,t)=>{if(!e)return!1;if("boolean"==typeof e)return!0;let r=e.width&&e.height?Number(e.width)/Number(e.height):t.baseAspectRatio,i={};return e.frameRate&&(i.frameRate={ideal:e.frameRate,min:15}),e.facingMode&&navigator.mediaDevices.getSupportedConstraints().facingMode&&(i.facingMode={exact:e.facingMode}),e.width&&(i.width={ideal:e.width}),e.height&&(i.height={ideal:e.height}),e.width&&e.height&&r&&(i.aspectRatio=r),e.deviceId&&(i.deviceId=e7?e.deviceId:{exact:e.deviceId}),e.width&&e.height&&!i.facingMode&&(i.advanced=[{width:{min:e.width-t.sizeThreshold,max:e.width+t.sizeThreshold},height:{min:e.height-t.sizeThreshold,max:e.height+t.sizeThreshold}},{aspectRatio:r}]),0!==Object.keys(i).length&&i})(e.video,t),this._logger.debug("Video constraints mapped",{constraints:n.video})),this._logger.info("Final constraints for media stream",{mappedConstraints:n}),!this._currentMediaStream){this._logger.debug("No current media stream known. Creating new stream");let e=await this._createNewStream(n);return this._logger.info("Media stream is ready",{mediaStream:e}),e}let s=!(!(r=this._currentMediaStream.stream).active||r.getTracks().every(tH));if(s&&await this._isCurrentStreamSatisfiesConstraints(n))return this._logger.debug("Current stream is active and satisfies constraints. Returning cached one"),this._logger.info("Media stream is ready",{mediaStream:this._currentMediaStream.stream}),this._currentMediaStream.stream;this._logger.debug(`Current stream ${s?"does not satisfies constraints":"is inactive"}. Creating new stream`),await this._stopCurrentStream();let a=await this._createNewStream(n);return this._logger.info("Media stream is ready",{mediaStream:a}),a}async _stopCurrentStream(){var e;(this._logger.debug("Stopping current media stream"),this._currentMediaStream)?(await void((e=this._currentMediaStream.stream)&&(e.getTracks().forEach(t=>{t.stop(),e.removeTrack(t)}),e.stop&&e.stop())),this._currentMediaStream=null):this._logger.verbose("No current stream known. Skipping")}async _checkKindPermissions(e){this._logger.debug("Checking kind permissions",{constraints:e});let t={isAvailable:!1,error:null};try{this._logger.verbose("Requesting media permissions for constraints",{constraints:e}),t.isAvailable=await tj(e),this._logger.verbose("Successfully got permissions for constraints",{constraints:e})}catch(r){this._logger.verbose("Could not get permissions for constraints",{constraints:e,error:r}),t.isAvailable=!1,t.error=r}return this._logger.debug("Final result of permissions check",{constraints:e,checkResults:t}),t}async _getMediaStream(e){this._logger.debug("Getting media stream with constraints",{constraints:e});let t=tG(),r=await t(e);return this._currentMediaStream={constraints:e,stream:r},this._logger.debug("Resulting media stream",{mediaStream:this._currentMediaStream.stream}),this._currentMediaStream.stream}async _createNewStream(e){this._logger.debug("Creating new media stream with constraints",{constraints:e});try{return await this._getMediaStream(e)}catch(t){if(this._logger.warn("Got an error while creating new media stream",{error:t,constraints:e}),"OverconstrainedError"===t.name&&"deviceId"===t.constraint){this._logger.verbose("Trying to get stream with no audio deviceId specified");let t={...e,audio:!0};return await this._getMediaStream(t)}throw t}}async _getMediaDevices(){return this._logger.verbose("Getting media devices"),this._mediaDevices?this._logger.verbose("Has media devices in cache, returning them",{devices:this._mediaDevices}):this._mediaDevices=await (async()=>{let e=await navigator.mediaDevices.enumerateDevices();return{audioInputs:tW(e,eE.AUDIO_INPUT),audioOutputs:tW(e,eE.AUDIO_OUTPUT),videoInputs:tW(e,eE.VIDEO_INPUT)}})(),this._mediaDevices}async _isCurrentStreamSatisfiesConstraints(e){if(this._logger.debug("Checking if current media stream satisfies constraints",{constraints:e,mediaStream:this._currentMediaStream}),!this._currentMediaStream)return this._logger.verbose("No current media stream available"),!1;try{if(e.video){this._logger.verbose("Checking video track constraints");let t=this._currentMediaStream.stream.getVideoTracks()[0];if(!t&&e.video)return this._logger.verbose("No video track in media stream and constraints has video"),!1;if(t&&!e.video)return this._logger.verbose("There is video track in media stream and constraints has no video"),!1;if("object"==typeof e.video&&e.video.deviceId&&t.getCapabilities().deviceId!==e.video.deviceId)return this._logger.verbose("Constraints has video device ID and it not matches current device id"),!1;t&&"boolean"!=typeof e.video&&(this._logger.verbose("Trying to apply new constraints for video"),await t.applyConstraints(e.video))}}catch(e){return this._logger.debug("Could not apply constraints or get capabilities of video track",{error:e}),!1}try{if(e.audio){this._logger.verbose("Checking audio track constraints");let t=this._currentMediaStream.stream.getAudioTracks()[0];if(!t&&e.audio)return this._logger.verbose("No audio track in media stream and constraints has audio"),!1;if(t&&!e.audio)return this._logger.verbose("There is audio track in media stream and constraints has no audio"),!1;if("object"==typeof e.audio&&e.audio.deviceId&&t.getCapabilities().deviceId!==e.audio.deviceId)return this._logger.verbose("Constraints has audio device ID and it not matches current device id"),!1;t&&"boolean"!=typeof e.audio&&(this._logger.verbose("Trying to apply new constraints for audio"),await t.applyConstraints(e.audio))}}catch(e){return this._logger.debug("Could not apply constraints or get capabilities of audio track",{error:e}),!1}return!0}async _onDevicesChanged(){this._logger.debug("Media devices has changed"),this._mediaDevices=null;let e=await this._getMediaDevices();this._mediaDevices=e,this.emitEvent(eb.MEDIA_DEVICES_UPDATED,e)}}).prototype,"_onDevicesChanged",null);let t$,tK=e=>{if(!e)return{};try{let t=new URL(e).pathname.split("/"),r=t[2],i=t[t.length-1];return{streamId:r,resolution:i.match(/\d+_(\w+)/)?.[1]||"source",isMaster:"master"===t[3]}}catch(e){return{}}};(F=t$||(t$={})).THROUGHPUT_ESTIMATOR="throughputEstimator",F.DROPPED_FRAMES_ESTIMATOR="droppedFramesEstimator",F.SWITCH_HISTORY="switchHistory",F.INSUFFICIENT_BUFFER="insufficientBuffer",F.MINIMAL_BUFFER_TO_INCREASE="minimalBufferToIncrease",F.DELTA_BUFFER="deltaBuffer",F.MAX_RESOLUTION_ESTIMATOR="maxResolution";let tY={enabledABRRules:[t$.THROUGHPUT_ESTIMATOR,t$.SWITCH_HISTORY,t$.MINIMAL_BUFFER_TO_INCREASE,t$.INSUFFICIENT_BUFFER,t$.MAX_RESOLUTION_ESTIMATOR],cooldownPeriod:1e4,minimalBufferAmountToSwitchUp:500};t$.DROPPED_FRAMES_ESTIMATOR,t$.THROUGHPUT_ESTIMATOR,t$.SWITCH_HISTORY,t$.MINIMAL_BUFFER_TO_INCREASE,t$.INSUFFICIENT_BUFFER,t$.DELTA_BUFFER,t$.MAX_RESOLUTION_ESTIMATOR,et("8NFq9"),er=et("a8VW4"),(N=i||(i={})).WAIT_FOR_PREFETCH_SEGMENT="waitForSegment",N.WAIT_FOR_PLAYLIST="waitForPlaylist";let tQ={playlistLoader:{playlistLoadingTimeout:2500,forceStaticPlaylistLoadingTimeout:!1,lowLatencyMode:!0,equalPlaylistsAmountToDecline:10,blockingMode:i.WAIT_FOR_PLAYLIST,maxVODPlaylistLoadingRetries:3,maxVODFragmentLoadingRetries:3,baseVODPlaylistRetryTimeout:500,baseVODFragmentRetryTimeout:5e3,VODLoadNextSegmentThreshold:5e3,disableTimeoutsInVOD:!0,retryLowLatencyPlaylistTimeout:1e3,targetBufferMultiplier:1,disableRotateTimeoutIncrease:!0,shouldLogFragmentsHistory:!1,workerMode:!0,partHoldBack:void 0,additionalStartParts:2,sendCustomRefererHeader:!1},fragmentLoader:{fragmentLoadingTimeout:2500,workerMode:!0},resolutionsManager:{autoloadLowestResolution:!0,initialResolutionWidth:0,initialResolutionHeight:720,initialResolutionBitrate:0,initialResolutionBitrateThreshold:1e5,maxPlaylistTimeDifference:4e4,awaitForSegmentEndToSwitch:!0,awaitForSegmentEndToSwitchManual:!1,recreateSourceBufferOnResolutionChange:!1,useFallbackResolutionIfResolutionNotFound:!0},bufferController:{checkMetricsInterval:150,bufferStallThreshold:.2,maxBackBufferAmount:1e4,bufferEdgeThreshold:.3,endOfRangeThreshold:.4,nudgePlaybackAmount:.1,numberOfCandidatesToDetectGap:2,numberOfFragmentToKeep:2,recreateSourceBufferOnResolutionChange:!1,saveLastSegmentsCount:3,sourceBufferStuckTimeout:1e3,timeSyncResyncInterval:-1,enableG2GLatencyMeasurement:!1,timeSyncUrlTemplate:"//time.{{domain}}/time"},throughputHistory:{ewmaFastAlpha:.9,ewmaSlowAlpha:.2,ignorePlaylistsMetrics:!0},abr:tY,switchHistory:{banResolutionDuration:7e3},throughputEstimator:{optimalResolutionLowerBound:.65,optimalResolutionUpperBound:.88,amountOfFragmentToBecomeConfident:10},droppedFramesEstimator:{resetHistoryTimeout:3e5,optimalDroppedFramesFraction:.1,minimalFramesPlayed:200},fragmentParser:{workerMode:!1},debugger:{enableRemoteDebugging:!1,debuggerUrl:"wss://doppio-player-debug.stripcdn.com",maxWSConnectionRetries:3,modulesStateGatheringPeriod:1e3,enableLifecycleEvents:!0},insufficientBufferEstimator:{minimalBufferAmount:.1,ignoreMetricsBeforeBufferExceedsMinimal:!0,switchToMinimalResolution:!1},minimalBufferToIncreaseEstimator:{minimalBufferAmount:500},deltaBufferEstimator:{bufferDeltaFractionToDetectFall:.1,numberOfFallsToDetect:2},playbackStateController:{autoPlay:!1,syncToLiveEdge:!1,syncToLiveDelta:1,playingTimeFractionCollectionWindow:1e5,stallDurationToDisableTargetBufferDecrease:1e4},targetBufferIncreaser:{bufferAmountToIncrease:200,bufferAmountThreshold:300},targetBufferDecreaser:{periodOfEventsToCancelDecrease:1e4},originalTargetBufferDecreaser:{periodOfEventsToCancelDecrease:1e4,allowTargetBufferDecrease:!1,targetBufferDecreaseTimeout:1e4,maxTargetBufferMultiplier:4},playbackSpeedActuator:{maxPlaybackRate:1.05,minPlaybackRate:.9},playbackSpeedWatcher:{maxLiveSyncThreshold:.4,minLiveSyncThreshold:.3,maxTargetBufferMultiplier:3,targetBufferInitialMultiplier:1,targetBufferDecreaseCoefficient:.25},bufferStallsDetector:{bufferAmountToDetectStall:.1},fragmentsFilter:{reportInconsistentTracks:!0,filterOutInconsistentTracks:!1},fragmentBuffer:{numberOfFragmentsToKeepInBuffer:3,baseChunksSaverUrl:"chunks.doppiostreams.com",saveProbability:.05}},tz=(i.WAIT_FOR_PLAYLIST,i.WAIT_FOR_PREFETCH_SEGMENT,["error","fatal"]),{ConfigConsumer:tX,setConfig:tZ}=eG(tQ);class tJ extends tX{}(k=n||(n={})).OK="ok",k.ERROR="error";let t0={playlistType:{multivariantDetected:"basePlaylistRotator.playlistType.multivariantDetected",simpleDetected:"basePlaylistRotator.playlistType.simpleDetected",llDetected:"basePlaylistRotator.playlistType.llDetected",vodDetected:"basePlaylistRotator.playlistType.vodDetected"},playlists:{playlistRequested:"basePlaylistRotator.playlists.playlistRequested",playlistLoaded:"basePlaylistRotator.playlists.playlistLoaded",playlistLoadingError:"basePlaylistRotator.playlists.playlistLoadingError",playlistParsed:"basePlaylistRotator.playlists.playlistLoadingError",playlistInfo:"basePlaylistRotator.playlists.playlistInfo",vodFragmentsInfo:"basePlaylistRotator.playlists.VODFragmentsInfo",independenceTypeUpdate:"basePlaylistRotator.playlists.independenceTypeUpdate",renditionReportsUpdated:"basePlaylistRotator.playlists.renditionReportsUpdated",lastPlaylistOfSegmentLoaded:"basePlaylistRotator.playlists.lastPlaylistOfSegmentLoaded"},fragments:{fragmentsDetected:"basePlaylistRotator.fragments.fragmentsDetected",requestReleaseFromCache:"basePlaylistRotator.fragments.requestReleaseFromCache",periodFragmentsFound:"basePlaylistRotator.fragments.periodFragmentsFound"}};var t1=et("eQOGK");class t2 extends tJ{status="Idle";state=n.OK;additionalInfo={};groups=["abr"];_numberOfFalls=0;_lastKnownBufferAmount=0;_currentBufferAmount=0;constructor(e){super("deltaBufferEstimator",e),this._onPlaylistParsedListener=this._eventBus.subscribe(t0.playlists.playlistInfo,this._onPlaylistParsed)}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onPlaylistParsedListener),this.reset()}reset(){this._numberOfFalls=0}getNextEstimatedResolution(e,t,r){return this._currentBufferAmount=r.bufferAmount,!t||this._numberOfFalls<this.config.numberOfFallsToDetect?null:e[Math.max(0,e.findIndex(({name:e})=>e===t.name)-1)]}_handleConfigUpdated(){this._numberOfFalls=0}_onPlaylistParsed(){let{_currentBufferAmount:e,_lastKnownBufferAmount:t}=this;this._lastKnownBufferAmount=e,e>t&&(this._numberOfFalls=0);let r=t/e;r>1+this.config.bufferDeltaFractionToDetectFall&&this._numberOfFalls++,this.additionalInfo={numberOfFalls:this._numberOfFalls,bufferDelta:r}}}(0,er.__decorate)([t1.default],t2.prototype,"_onPlaylistParsed",null),et("8NFq9"),er=et("a8VW4"),et("8NFq9"),er=et("a8VW4");let t3={requestResetWithOverplay:"buffer.requestResetWithOverplay",bufferMetricsAvailable:"buffer.metricsAvaialable",playbackStallChanged:"buffer.playbackStallChanged",requestSourceBufferOperation:"buffer.requestSourceBufferOperation",playbackStateChanged:"buffer.playbackStateChanged",endOfStreamReached:"buffer.endOfStreamReached",fragmentAdded:"buffer.fragmentAdded",changeCodec:"buffer.changeCodec",sourceBufferStuck:"buffer.sourceBufferStuck",latencyExtraInformationAvailable:"buffer.latencyExtraInformationAvailable"},t8={resolutionsAvailable:"resolutionsManager.resolutionsAvailable",resolutionChanged:"resolutionManager.resolutionChanged",resolutionAutoChanged:"resolutionManager.resolutionAutoChanged",requestResolutionChange:"resolutionManager.requestResolutionChange",requestRestartFromMain:"resolutionManager.requestRestartFromMain",resolutionNotFound:"resolutionManager.resolutionNotFound",entrypointURLUpdated:"resolutionManager.entrypointURLUpdated"};t1=et("eQOGK");class t4{_droppedFrames={};_currentResolution=null;_isFirstMetricsOfResolution=!0;constructor(e){this._eventBus=e,this._onBufferMetricsReadyListener=this._eventBus.subscribe(t3.bufferMetricsAvailable,this._onBufferMetricsReady),this._onResolutionChangedListener=this._eventBus.subscribe(t8.resolutionChanged,this._onResolutionChanged)}destroy(){this._eventBus.unsubscribe(this._onBufferMetricsReadyListener),this._eventBus.unsubscribe(this._onResolutionChangedListener),this.reset()}getCurrentResolutionHistory(){return this._currentResolution&&this._droppedFrames[this._currentResolution.name]?this._droppedFrames[this._currentResolution.name]:null}getResolutionHistoryByName(e){return this._droppedFrames[e]||null}reset(){this._droppedFrames={},this._currentResolution=null,this._isFirstMetricsOfResolution=!0}_onBufferMetricsReady(e){if(!this._currentResolution)return;let{name:t}=this._currentResolution;this._droppedFrames[t]||(this._droppedFrames[t]={droppedFramesNumber:0,totalFramesNumber:0}),this._isFirstMetricsOfResolution?this._isFirstMetricsOfResolution=!1:(this._droppedFrames[t].droppedFramesNumber+=e.droppedVideoFramesDelta,this._droppedFrames[t].totalFramesNumber+=e.totalVideoFramesDelta)}_onResolutionChanged(e){this._currentResolution?.name!==e.name&&(this._currentResolution=e,this._isFirstMetricsOfResolution=!0)}}(0,er.__decorate)([t1.default],t4.prototype,"_onBufferMetricsReady",null),(0,er.__decorate)([t1.default],t4.prototype,"_onResolutionChanged",null),t1=et("eQOGK");class t9 extends tJ{state=n.OK;status="Idle";additionalInfo={droppedFramesByResolution:{}};groups=["abr"];_lastClearTs=0;_droppedFramesHistory=new t4(this._eventBus);constructor(e){super("droppedFramesEstimator",e),this._onMetricsReadyListener=this._eventBus.subscribe(t3.bufferMetricsAvailable,this._onMetricsReady)}destroy(){super.destroy(),this._droppedFramesHistory.destroy(),this._eventBus.unsubscribe(this._onMetricsReadyListener)}reset(){this._droppedFramesHistory.reset()}getNextEstimatedResolution(e){let{minimalFramesPlayed:t}=this.config;return e.find(({name:e})=>{let r=this._droppedFramesHistory.getResolutionHistoryByName(e);return this.additionalInfo.droppedFramesByResolution[e]=r,!r||r.totalFramesNumber<t||r.droppedFramesNumber/r.totalFramesNumber<this.config.optimalDroppedFramesFraction})||null}_handleConfigUpdated(){}_onMetricsReady(e){e.currentTimestamp-this._lastClearTs>this.config.resetHistoryTimeout&&(this._droppedFramesHistory.reset(),this._lastClearTs=e.currentTimestamp)}}(0,er.__decorate)([t1.default],t9.prototype,"_onMetricsReady",null),et("8NFq9"),er=et("a8VW4");var t6=et("3mtZ4");let t5="AbrController.resolutionsConstraintsAvailable";t1=et("eQOGK");class t7{state=n.OK;status="Idle";additionalInfo={};groups=["abr"];_lastAvailableResolutions=[];_currentResolutionsLimit=null;_estimatedResolution=null;constructor(e){this._eventBus=e,this._onResolutionsConstraintsAvailableListener=this._eventBus.subscribe(t5,this._onResolutionsConstraintsAvailable)}destroy(){this._eventBus.unsubscribe(this._onResolutionsConstraintsAvailableListener)}reset(){}getNextEstimatedResolution(e){return this._lastAvailableResolutions!==e&&(this._lastAvailableResolutions=e,this._calculationAvailableResolution(this._currentResolutionsLimit)),this._estimatedResolution}_onResolutionsConstraintsAvailable(e){Z(t6).isEqual(this._currentResolutionsLimit,e)||this._calculationAvailableResolution(e)}_meetsLimits(e,t){return!(void 0!==t?.bitrate&&e.bitrate>t?.bitrate)&&!(void 0!==t?.height&&e.height>t?.height)&&!(void 0!==t?.width&&e.width>t?.width)&&(void 0===t?.fps||!(void 0===e.fps||+e.fps>+t?.fps))}_calculationAvailableResolution(e){if(this._currentResolutionsLimit={...e},0===this._lastAvailableResolutions?.length)return;if(null===e)return void(this._estimatedResolution=null);let t=this._lastAvailableResolutions.filter(t=>!e||this._meetsLimits(t,e));this._estimatedResolution=t[0]||this._lastAvailableResolutions.slice(-1)[0]}}(0,er.__decorate)([t1.default],t7.prototype,"_onResolutionsConstraintsAvailable",null),et("8NFq9"),er=et("a8VW4"),t1=et("eQOGK");class re extends tJ{_lastSelectedResolution=null;_bannedResolutions=[];constructor(e){super("switchHistory",e),this._onResolutionSelectedListener=this._eventBus.subscribe(t8.resolutionChanged,this._onResolutionChanged),this._onMetricsReadyListener=this._eventBus.subscribe(t3.bufferMetricsAvailable,this._checkBanedResolutions)}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onResolutionSelectedListener),this._eventBus.unsubscribe(this._onMetricsReadyListener),this.reset()}reset(){this._bannedResolutions=[]}getBannedResolutions(){return this._bannedResolutions.map(({resolution:e})=>e)}_handleConfigUpdated(e){e.banResolutionDuration&&this._checkBanedResolutions()}_onResolutionChanged(e){!this._lastSelectedResolution||this._lastSelectedResolution.bitrate<e.bitrate?this._lastSelectedResolution=e:this._lastSelectedResolution.bitrate>e.bitrate&&(this._bannedResolutions.push({resolution:e,bannedAt:Date.now()}),this._lastSelectedResolution=e)}_checkBanedResolutions(){if(!this._bannedResolutions.length)return;let e=Date.now();this._bannedResolutions=this._bannedResolutions.filter(({bannedAt:t})=>e-t<this.config.banResolutionDuration)}}(0,er.__decorate)([t1.default],re.prototype,"_handleConfigUpdated",null),(0,er.__decorate)([t1.default],re.prototype,"_onResolutionChanged",null),(0,er.__decorate)([t1.default],re.prototype,"_checkBanedResolutions",null),et("8NFq9"),er=et("a8VW4"),et("8NFq9"),er=et("a8VW4");let rt={events:{browserRedirectDetected:"networkLoader.events.browserRedirectDetected",networkRequestSettled:"networkLoader.events.networkRequestSettled"},stats:{statsReady:"networkLoader.stats.statsEvent"}};t1=et("eQOGK");class rr{_previousFastValue=null;_previousSlowValue=null;constructor(e,t,r){this._eventBus=r,this._fastAlpha=e,this._slowAlpha=t}addValue(e){let{_fastAlpha:t,_slowAlpha:r}=this;this._previousFastValue=t*e+(1-t)*(this._previousFastValue||e),this._previousSlowValue=r*e+(1-r)*(this._previousSlowValue||e),this._eventBus.publish("EWMAMetrics",{fast:this._previousFastValue,slow:this._previousSlowValue})}getCurrentValue(){return this._previousSlowValue&&this._previousFastValue?Math.min(this._previousFastValue,this._previousSlowValue):0}getCurrentMaximalValue(){return this._previousFastValue&&this._previousSlowValue?Math.max(this._previousSlowValue,this._previousFastValue):0}reset(){this._previousSlowValue=null,this._previousFastValue=null}}class ri extends tJ{constructor(e){super("throughputHistory",e),this._measuredSpeedEwmaInstance=new rr(this.config.ewmaFastAlpha,this.config.ewmaSlowAlpha,this._eventBus),this._realSpeedEwmaInstance=new rr(this.config.ewmaFastAlpha,this.config.ewmaSlowAlpha,this._eventBus),this._ttfbEwmaInstance=new rr(this.config.ewmaFastAlpha,this.config.ewmaSlowAlpha,this._eventBus),this._onNetMetricsReadyListener=this._eventBus.subscribe(rt.stats.statsReady,this._onNetworkMetricsReady)}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onNetMetricsReadyListener),this._measuredSpeedEwmaInstance.reset(),this._realSpeedEwmaInstance.reset()}getCurrentBitrateEstimate(){return{measuredSpeed:this._measuredSpeedEwmaInstance.getCurrentValue(),realSpeedWithoutTTFB:this._realSpeedEwmaInstance.getCurrentValue(),ttfb:this._ttfbEwmaInstance.getCurrentMaximalValue()}}reset(){this._measuredSpeedEwmaInstance=new rr(this.config.ewmaFastAlpha,this.config.ewmaSlowAlpha,this._eventBus),this._realSpeedEwmaInstance=new rr(this.config.ewmaFastAlpha,this.config.ewmaSlowAlpha,this._eventBus),this._ttfbEwmaInstance=new rr(this.config.ewmaFastAlpha,this.config.ewmaSlowAlpha,this._eventBus)}_handleConfigUpdated(e){(e.ewmaFastAlpha||e.ewmaSlowAlpha)&&this.reset()}_onNetworkMetricsReady(e){if(this.config.ignorePlaylistsMetrics&&"text"===e.type)return;let t=8*e.sizeInKb/((e.downloadDuration-e.ttfb)/1e3);this._measuredSpeedEwmaInstance.addValue(e.calculatedSpeed),this._realSpeedEwmaInstance.addValue(t),this._ttfbEwmaInstance.addValue(e.ttfb/1e3)}}(0,er.__decorate)([t1.default],ri.prototype,"_handleConfigUpdated",null),(0,er.__decorate)([t1.default],ri.prototype,"_onNetworkMetricsReady",null);let rn=e=>e/1024;t1=et("eQOGK");class rs extends tJ{state=n.OK;status="Idle";additionalInfo={};groups=["abr"];_isResultsConfident=!1;_fragmentsLoadedAmount=0;constructor(e){super("throughputEstimator",e),this._throughputHistory=new ri(this._eventBus),this._onNetworkMetricsReadyListener=this._eventBus.subscribe(rt.stats.statsReady,this._onNetworkStatsReady)}destroy(){super.destroy(),this._throughputHistory.destroy(),this._eventBus.unsubscribe(this._onNetworkMetricsReadyListener)}reset(){this._throughputHistory.reset(),this._isResultsConfident=!1}getNextEstimatedResolution(e){let{realSpeedWithoutTTFB:t,measuredSpeed:r,ttfb:i}=this._throughputHistory.getCurrentBitrateEstimate();if(this.additionalInfo={realSpeedWithoutTTFB:t,measuredSpeed:r,ttfb:i},!e.length||!r||!this._isResultsConfident)return null;let n=rn(e[0].bitrate)/(i+rn(e[0].bitrate)/t);return rn(e[0].bitrate)<n?e[0]:e.find(({bitrate:e})=>{let r=rn(e),n=r/(i+r/t);return n*this.config.optimalResolutionLowerBound<=r&&r<=n*this.config.optimalResolutionUpperBound})||e.find(({bitrate:e})=>rn(e)<=r*this.config.optimalResolutionLowerBound)||e.slice(-1)[0]}_handleConfigUpdated(){}_onNetworkStatsReady(e){"binary"!==e.type||this._isResultsConfident||(this._fragmentsLoadedAmount+=1,this._fragmentsLoadedAmount>=this.config.amountOfFragmentToBecomeConfident&&(this._isResultsConfident=!0))}}(0,er.__decorate)([t1.default],rs.prototype,"_handleConfigUpdated",null),(0,er.__decorate)([t1.default],rs.prototype,"_onNetworkStatsReady",null),t1=et("eQOGK");let ra={[t$.DROPPED_FRAMES_ESTIMATOR]:t9,[t$.THROUGHPUT_ESTIMATOR]:rs,[t$.SWITCH_HISTORY]:class{state=n.OK;status="Idle";additionalInfo={bannedResolution:[]};groups=["abr"];constructor(e){this._eventBus=e,this._switchHistory=new re(this._eventBus)}reset(){this._switchHistory.reset()}destroy(){this._switchHistory.destroy()}getNextEstimatedResolution(e){let t=this._switchHistory.getBannedResolutions().map(({name:e})=>e);return this.additionalInfo.bannedResolution=t,e.find(({name:e})=>!t.includes(e))||null}},[t$.INSUFFICIENT_BUFFER]:class extends tJ{status="Idle";state=n.OK;groups=["abr"];additionalInfo={};_hasPassedMinimalBuffer=!1;constructor(e){super("insufficientBufferEstimator",e)}destroy(){super.destroy()}reset(){this._hasPassedMinimalBuffer=!1}getNextEstimatedResolution(e,t,r){let i=r.bufferAmount>this.config.minimalBufferAmount;!this._hasPassedMinimalBuffer&&i&&(this._hasPassedMinimalBuffer=!0);let n=!this.config.ignoreMetricsBeforeBufferExceedsMinimal||this._hasPassedMinimalBuffer;if(this.additionalInfo.isResultsConfident=n,this.additionalInfo.isBufferExceedsMinimal=i,this.additionalInfo.hasPassedMinimalBuffer=this._hasPassedMinimalBuffer,!n||i||!t)return null;this._hasPassedMinimalBuffer=!1;let s=e.slice(-1)[0],a=t.url===s.url?t:e[e.findIndex(({name:e})=>e===t.name)+1];return this.config.switchToMinimalResolution?s:a}_handleConfigUpdated(){this._hasPassedMinimalBuffer=!1}},[t$.MINIMAL_BUFFER_TO_INCREASE]:class extends tJ{state=n.OK;status="Idle";additionalInfo={};groups=["abr"];constructor(e){super("minimalBufferToIncreaseEstimator",e)}destroy(){super.destroy()}reset(){}getNextEstimatedResolution(e,t,r){return 1e3*r.bufferAmount>this.config.minimalBufferAmount?null:t}_handleConfigUpdated(){}},[t$.DELTA_BUFFER]:t2,[t$.MAX_RESOLUTION_ESTIMATOR]:t7};class ro extends tJ{state=n.OK;status="Idle";groups=["general","abr"];additionalInfo={switchReasonHistory:[]};_currentResolution=null;_availableResolutions=[];_estimators={};_lastSwitchTime=0;constructor(e){super("abr",e),this._logger=e$(e,"Doppio - AbrController"),this._logger=e$(this._eventBus,"Doppio - AbrController"),this._onResolutionChangedListener=this._eventBus.subscribe(t8.resolutionChanged,this._onResolutionChanged),this._onResolutionsAvailableListener=this._eventBus.subscribe(t8.resolutionsAvailable,this._onResolutionsAvailable),this._onMetricsReadyListener=this._eventBus.subscribe(t3.bufferMetricsAvailable,this._recalculateCurrentLevel),this._recreateEstimators(),this._lastSwitchTime=Date.now()}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onMetricsReadyListener),this._eventBus.unsubscribe(this._onResolutionChangedListener),this._eventBus.unsubscribe(this._onResolutionsAvailableListener),Object.values(this._estimators).forEach(e=>{e.destroy()}),this._estimators={}}_handleConfigUpdated(e){e.enabledABRRules&&this._recreateEstimators()}_recreateEstimators(){Object.values(this._estimators).forEach(e=>e.destroy()),this._estimators=this.config.enabledABRRules.reduce((e,t)=>(e[t]=new ra[t](this._eventBus),e),{})}_recalculateCurrentLevel(e){let t=Object.entries(this._estimators).reduce((t,[r,i])=>(t[r]=i.getNextEstimatedResolution(this._availableResolutions,this._currentResolution,e),t),{});if(this.additionalInfo.estimations=Object.entries(t).reduce((e,[t,r])=>(e[t]=r?.name||"null",e),{}),Date.now()-this._lastSwitchTime<this.config.cooldownPeriod||!Object.values(this._estimators).length)return;let r=Object.values(t).filter(e=>e).sort((e,t)=>(e?.bitrate||0)-(t?.bitrate||0))[0];if(r&&r.name!==this._currentResolution?.name){let e=Object.entries(t).reduce((e,[t,i])=>(i?.name===r?.name&&e.push(t),e),[]);this.additionalInfo.switchReasonHistory.unshift(`${this._currentResolution?.name} -> ${r?.name}; ${e.join(",")}`),this._lastSwitchTime=Date.now(),this.additionalInfo.lastSwitchTime=this._lastSwitchTime,this.additionalInfo.lastSwitchReason=Object.entries(t).filter(([,e])=>e?.name===r?.name).map(([e])=>e).join("; "),this._logger.info(`ABR wants to change the resolution, ${this._currentResolution?.name} -> ${r?.name}`),this._eventBus.publish(t8.requestResolutionChange,r)}}_onResolutionsAvailable(e){this._availableResolutions=e}_onResolutionChanged(e){this._currentResolution=e,Object.values(this._estimators).forEach(e=>e.reset())}get additionalModules(){return this._estimators}}(0,er.__decorate)([t1.default],ro.prototype,"_handleConfigUpdated",null),(0,er.__decorate)([t1.default],ro.prototype,"_recalculateCurrentLevel",null),(0,er.__decorate)([t1.default],ro.prototype,"_onResolutionsAvailable",null),(0,er.__decorate)([t1.default],ro.prototype,"_onResolutionChanged",null),et("8NFq9"),er=et("a8VW4"),et("8NFq9"),er=et("a8VW4"),t1=et("eQOGK");class rl extends tJ{_isPaused=!1;_isInVodMode=!1;_fragmentTimeRanges=[];_videoElement=null;constructor(e){super("bufferController",e),this._logger=e$(e,"Doppio - BufferCleaner"),this._logger=e$(this._eventBus,"Doppio - BufferCleaner"),this._onBufferMetricsReadyListener=this._eventBus.subscribe(t3.bufferMetricsAvailable,this._onBufferMetricsAvailable),this._onPeriodFragmentsFound=this._eventBus.subscribe(t0.fragments.periodFragmentsFound,this._onFragmentPeriodFound),this._onVODFragmentsInfoAvailableListener=this._eventBus.subscribe(t0.playlists.vodFragmentsInfo,this._onVODFragmentsInfoAvailable)}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onPeriodFragmentsFound),this._eventBus.unsubscribe(this._onVODFragmentsInfoAvailableListener),this._eventBus.unsubscribe(this._onBufferMetricsReadyListener)}start(){this._isPaused=!1}pause(){this._isPaused=!0}setVODMode(e){this._isInVodMode=e}setVideoElement(e){this._videoElement=e}removeVideoElement(){this._videoElement=null}_handleConfigUpdated(){}_onVODFragmentsInfoAvailable(e){this._fragmentTimeRanges=e.map(({fragmentStartTS:e,fragmentEndTS:t})=>({startTS:e,endTS:t}))}_onBufferMetricsAvailable(e){if(!(this._isPaused||0===e.bufferedTimeRanges.length||this._isInVodMode&&this._fragmentTimeRanges.length)){let t=e.isPaused?[{startTS:e.currentPlaybackPosition-1,endTS:e.currentPlaybackPosition+1},{startTS:e.bufferedTimeRanges.slice(-1)[0]?.end-this.config.maxBackBufferAmount/1e3,endTS:e.bufferedTimeRanges.slice(-1)[0]?.end}]:[{startTS:e.currentPlaybackPosition-this.config.maxBackBufferAmount/1e3,endTS:e.bufferedTimeRanges.slice(-1)[0].end}];this._clearBufferWithSafetyTimeRanges(t)}}_onFragmentPeriodFound({endTsOfPeriod:e}){if(this._isPaused||!this._videoElement||this._videoElement.currentTime<this.config.maxBackBufferAmount/1e3)return;let{currentTime:t}=this._videoElement,r=[{startTS:t-this.config.maxBackBufferAmount/1e3,endTS:e}];this._clearBufferWithSafetyTimeRanges(r)}_clearBufferWithSafetyTimeRanges(e){if(!this._videoElement?.buffered.length)return;let t=e.sort((e,t)=>e.startTS-t.startTS).filter(({startTS:e,endTS:t})=>e<t).map((t,r)=>({startTS:r>0?e[r-1].endTS:0,endTS:t.startTS})).filter(({startTS:e,endTS:t})=>e<t);this._isInVodMode&&Number.isFinite(this._videoElement.duration)&&e.length&&e.slice(-1)[0].endTS<this._videoElement.duration&&t.push({startTS:e.slice(-1)[0].endTS,endTS:this._videoElement.duration}),t.forEach(e=>{this._eventBus.publish(t3.requestSourceBufferOperation,t=>{this._logger.verbose(`Removing buffered range ${e.startTS} -> ${e.endTS}`),t.remove(e.startTS,e.endTS)})})}}(0,er.__decorate)([t1.default],rl.prototype,"destroy",null),(0,er.__decorate)([t1.default],rl.prototype,"_handleConfigUpdated",null),(0,er.__decorate)([t1.default],rl.prototype,"_onVODFragmentsInfoAvailable",null),(0,er.__decorate)([t1.default],rl.prototype,"_onBufferMetricsAvailable",null),(0,er.__decorate)([t1.default],rl.prototype,"_onFragmentPeriodFound",null),et("8NFq9"),er=et("a8VW4"),(x=l||(l={})).MANIFEST_LOADED="ManifestLoaded",x.FIRST_MEDIA_PLAYLIST_LOADED="FirstMediaPlaylistLoaded",x.FIRST_FRAGMENT_LOADED="FirstFragmentLoaded",x.FIRST_FRAGMENT_BUFFERED="FirstFragmentBuffered",(U=u||(u={})).MANIFEST_LOAD_ERROR="ManifestLoadError",U.PLAYLIST_LOAD_ERROR="PlaylistLoadError",U.FRAGMENT_LOAD_ERROR="FragmentLoadError",(V=d||(d={})).VARIANTS_DETECTED="variantDetected",V.RESOLUTION_CHANGED="resolutionChanged",V.METRICS_AVAILABLE="metricsAvailable",V.ERROR="error",V.MANIFEST_LOADING="manifestLoading",V.MANIFEST_LOADED="manifestLoaded",V.MANIFEST_PARSED="manifestParsed",V.LEVEL_LOADED="levelLoaded",V.LEVEL_SWITCHED="levelSwitched",V.LEVEL_SWITCHED_AUTO="levelSwitchedAuto",V.LEVEL_SWITCHING="levelSwitching",V.MEDIA_ATTACHED="mediaAttached",V.MEDIA_DETACHED="mediaDetached",V.FRAG_LOADED="fragmentLoaded",V.LEVEL_METADATA_LOADED="levelMetadataLoaded",V.STREAM_STATE_TRANSITION="streamStateTransition",V.PLAYBACK_STATE_CHANGED="playbackStateChanged",V.FRAG_BUFFERED="fragBuffered",V.DEBUGGER_CONNECTED="debuggerConnected",V.STREAM_ENDED="streamEnded",V.LIFECYCLE_EVENT="lifecycleEvent",V.LIFECYCLE_ERROR="lifecycleError",V.FRAGMENT_FILTERED_OUT="fragmentFilteredOut",V.RESOLUTION_NOT_FOUND="resolutionNotFound",(q=c||(c={})).MEDIA_ERROR="mediaError",q.NETWORK_ERROR="networkError",q.PARSING_ERROR="parsingError",t1=et("eQOGK");class ru extends tJ{_sourceBuffer=null;_opsQueue=[];_sourceBufferStuckTimer=null;constructor(e){super("bufferController",e),this._logger=e$(e,"Doppio - BufferOpsQueue"),this._eventBus=e,this._logger=e$(this._eventBus,"Doppio - BufferOpsQueue")}setSourceBuffer(e){this._sourceBuffer&&this._sourceBuffer.removeEventListener("updateend",this._onBufferReady),this._sourceBuffer=e,this._sourceBuffer.addEventListener("updateend",this._onBufferReady),this._sourceBufferStuckTimer=setTimeout(()=>{this._eventBus.publish(t3.sourceBufferStuck,{})},this.config.sourceBufferStuckTimeout)}destroy(){super.destroy();try{this._disarmSourceBufferStuckTimer(),this._sourceBuffer?.removeEventListener("updateend",this._onBufferReady),this._sourceBuffer?.abort()}catch(e){this._logger.info("Source buffer cannot be aborted. Ignore it")}this._opsQueue=[]}removeSourceBuffer(e){this._sourceBuffer&&(this.immediatelyRecreateSourceBuffer(e),this._sourceBuffer.removeEventListener("updateend",this._onBufferReady),this._sourceBuffer=null)}addBufferOperation(e,t,r){if(!this._sourceBuffer)return this._logger.warn(`There is no sourceBuffer defined. Operation (${r||"unknown"}) will be executed once sourceBuffer will be appended`),void this._opsQueue.push({operation:e,errorHandler:t});if(this._sourceBuffer.updating||this._opsQueue.length>0)this._opsQueue.push({operation:e,errorHandler:t});else try{e(this._sourceBuffer)}catch(r){t?t(this._sourceBuffer,r):(this._eventBus.publish(d.ERROR,{type:c.MEDIA_ERROR,details:r}),this._logger.error(`Cannot recreate source buffer: ${r.toString()}, ${e}`))}}immediatelyRecreateSourceBuffer(e){try{if(!this._sourceBuffer||!e||![...e.sourceBuffers].includes(this._sourceBuffer))return;this._disarmSourceBufferStuckTimer(),this._opsQueue=[],this._sourceBuffer.abort(),this._sourceBuffer.remove(0,Number.POSITIVE_INFINITY)}catch(e){this._logger.error(`Cannot recreate source buffer: ${e.toString()}`)}}_recheckQueue(){if(!this._sourceBuffer||this._sourceBuffer.updating||!this._opsQueue.length)return;let e=this._opsQueue.shift();if(e)try{e.operation(this._sourceBuffer)}catch(t){e.errorHandler?e.errorHandler?.(this._sourceBuffer,t):(this._logger.error(`Cannot perform source buffer operation: ${t.toString()} ${e}`),this._eventBus.publish(d.ERROR,{type:c.MEDIA_ERROR,details:t}))}!this._sourceBuffer.updating&&this._opsQueue.length&&this._recheckQueue()}_onBufferReady(){this._recheckQueue(),this._disarmSourceBufferStuckTimer()}_disarmSourceBufferStuckTimer(){this._sourceBufferStuckTimer&&clearTimeout(this._sourceBufferStuckTimer)}}(0,er.__decorate)([t1.default],ru.prototype,"_onBufferReady",null),(0,er.__decorate)([t1.default],ru.prototype,"_disarmSourceBufferStuckTimer",null),et("8NFq9"),er=et("a8VW4"),t1=et("eQOGK");class rd extends tJ{_isPrevCheckStalled=!1;constructor(e){super("bufferStallsDetector",e),this._onBufferMetricsAvailableListener=this._eventBus.subscribe(t3.bufferMetricsAvailable,this._onBufferMetricsAvailable)}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onBufferMetricsAvailableListener)}_handleConfigUpdated(){}_onBufferMetricsAvailable({isStallCandidate:e,bufferedTimeRanges:t,currentPlaybackPosition:r}){let i=t.slice(-1)[0],n=i?i.end-r:0,s=e&&n<this.config.bufferAmountToDetectStall;this._isPrevCheckStalled!==s&&(this._isPrevCheckStalled=s,this._eventBus.publish(t3.playbackStallChanged,s))}}(0,er.__decorate)([t1.default],rd.prototype,"destroy",null),(0,er.__decorate)([t1.default],rd.prototype,"_handleConfigUpdated",null),(0,er.__decorate)([t1.default],rd.prototype,"_onBufferMetricsAvailable",null),et("8NFq9"),er=et("a8VW4"),t1=et("eQOGK");let rc="debugger.lifecycleEvent",rh="debugger.connected",rf=(e,t)=>r=>{t.publish(rc,{module:e,eventInfo:r,timestamp:Date.now()})};(G=h||(h={})).UNKNOWN="unknown",G.GAP="gap",G.IN_RANGE="inRange",G.END_OF_RANGE="endOfRange";class r_ extends tJ{state=n.OK;status="Idle";additionalInfo={};groups=["buffer"];_lastPlaybackPosition=0;_videoElement=null;_numberOfDetectedStallCandidates=0;constructor(e){super("bufferController",e),this._logger=e$(e,"Doppio - LiveGapController"),this._logger=e$(this._eventBus,"Doppio - LiveGapController"),this._lifecycleEventReporter=rf("LiveGapController",this._eventBus),this._onBufferMetricsReadyListener=this._eventBus.subscribe(t3.bufferMetricsAvailable,this._onBufferMetricsReady)}setVideoElement(e){this._videoElement=e}removeVideoElement(){this._videoElement=null}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onBufferMetricsReadyListener)}_handleConfigUpdated(){}_checkIfJumpNeeded(e){let t=!1,r=h.UNKNOWN,i=this._lastPlaybackPosition!==e.currentPlaybackPosition;this._lastPlaybackPosition=e.currentPlaybackPosition,i?this._numberOfDetectedStallCandidates=0:this._numberOfDetectedStallCandidates+=1;let n=!e.bufferedTimeRanges.some(({isCurrentTimeRange:e})=>e);return!i&&this.config.numberOfCandidatesToDetectGap<=this._numberOfDetectedStallCandidates&&(this._numberOfDetectedStallCandidates=0,this._lifecycleEventReporter("Playback stalled"),this._logger.info("Playback position didnt changed since last check"),t=!0,r=e.currentTimeRange&&e.currentTimeRange.end-e.currentPlaybackPosition<this.config.endOfRangeThreshold?h.END_OF_RANGE:h.IN_RANGE),n&&(this._lifecycleEventReporter("Gap detected"),this._logger.info("Gap detected"),t=!0,r=h.GAP),this.additionalInfo.isInLastBufferedRange=e.isInLastBufferedRange,this.additionalInfo.isPlaybackPositionChanged=i,this.additionalInfo.isInGap=n,this.additionalInfo.stuckType=r,{isJumpNeeded:t,stuckType:r}}_onBufferMetricsReady(e){if(!e.bufferedTimeRanges.length||0===this._videoElement?.currentTime||this._videoElement?.paused)return;let{isJumpNeeded:t,stuckType:r}=this._checkIfJumpNeeded(e);return t?(this._lifecycleEventReporter("Gap detected. Skipping it"),[h.END_OF_RANGE,h.GAP].includes(r)?this._jumpToNextRangeStart(e):this._nudgePlayback(e)):void 0}_setNextPlaybackPosition(e){this._videoElement&&(this._videoElement.currentTime=e)}_jumpToNextRangeStart(e){if(e.isInLastBufferedRange||e.currentPlaybackPosition>=e.bufferedTimeRanges.slice(-1)[0].end)return void this._nudgePlayback(e);let t=e.bufferedTimeRanges.find(({start:t})=>t>e.currentPlaybackPosition);t?(this._lifecycleEventReporter(`Jump to next range requested, jumping to ${t.start+.01}`),this._setNextPlaybackPosition(t.start+.01)):this._nudgePlayback(e)}_nudgePlayback(e){if(e.isOnBufferEdge)return;let t=e.currentPlaybackPosition+this.config.nudgePlaybackAmount;this._lifecycleEventReporter("Nudge playback position"),this._setNextPlaybackPosition(t)}}(0,er.__decorate)([t1.default],r_.prototype,"destroy",null),(0,er.__decorate)([t1.default],r_.prototype,"_handleConfigUpdated",null),(0,er.__decorate)([t1.default],r_.prototype,"_onBufferMetricsReady",null),et("8NFq9"),er=et("a8VW4"),t1=et("eQOGK");class rg extends tJ{state=n.OK;status="Idle";additionalInfo={};groups=["buffer"];_videoElement=null;_fragments=[];_lastPlaybackPosition=0;_numberOfDetectedStallCandidates=0;constructor(e){super("bufferController",e),this._onBufferMetricsReadyListener=this._eventBus.subscribe(t3.bufferMetricsAvailable,this._onBufferMetricsAvailable),this._onVODFragmentInfoAvailableListener=this._eventBus.subscribe(t0.playlists.vodFragmentsInfo,this._onVODFragmentsInfoAvailable)}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onBufferMetricsReadyListener),this._eventBus.unsubscribe(this._onVODFragmentInfoAvailableListener)}setVideoElement(e){this._videoElement=e}removeVideoElement(){this._videoElement=null}_handleConfigUpdated(){}_onVODFragmentsInfoAvailable(e){this._fragments=e.map(({fragmentEndTS:e,fragmentStartTS:t})=>({startTs:t,endTs:e}))}_onBufferMetricsAvailable(e){if(!this._fragments.length||!e.bufferedTimeRanges||this._videoElement?.paused)return;let t=this._lastPlaybackPosition!==e.currentPlaybackPosition;this._lastPlaybackPosition=e.currentPlaybackPosition,t?this._numberOfDetectedStallCandidates=0:this._numberOfDetectedStallCandidates+=1;let r=!e.bufferedTimeRanges.some(({isCurrentTimeRange:e})=>e),i=!t&&this.config.numberOfCandidatesToDetectGap<=this._numberOfDetectedStallCandidates;if(r||i){let t=this._fragments.find(({startTs:t})=>t>e.currentPlaybackPosition)?.startTs||-1,r=e.bufferedTimeRanges.find(({start:t})=>t>e.currentPlaybackPosition)?.start||-1;t===r&&this._videoElement&&(this._videoElement.currentTime=r+.01,this._numberOfDetectedStallCandidates=0)}}}(0,er.__decorate)([t1.default],rg.prototype,"destroy",null),(0,er.__decorate)([t1.default],rg.prototype,"_onVODFragmentsInfoAvailable",null),(0,er.__decorate)([t1.default],rg.prototype,"_onBufferMetricsAvailable",null);class rp{groups=["buffer"];_liveGapController=null;_vodGapController=null;_videoElement=null;_isInVODMode=!1;constructor(e){this._eventBus=e,this._liveGapController=new r_(this._eventBus),this._recreateGapController()}destroy(){this._vodGapController?.destroy(),this._liveGapController?.destroy()}setIsVod(e){this._isInVODMode=e,this._recreateGapController()}setVideoElement(e){this._videoElement=e,this._liveGapController&&this._liveGapController.setVideoElement(e),this._vodGapController&&this._vodGapController.setVideoElement(e)}removeVideoElement(){this._videoElement=null,this._liveGapController?.removeVideoElement(),this._vodGapController?.removeVideoElement()}_recreateGapController(){this._vodGapController?.destroy(),this._liveGapController?.destroy(),this._isInVODMode?this._vodGapController=new rg(this._eventBus):this._liveGapController=new r_(this._eventBus),this._videoElement&&this.setVideoElement(this._videoElement)}get status(){return this._vodGapController?.status||this._liveGapController?.status||"Idle"}get state(){return this._vodGapController?.state||this._liveGapController?.state||n.OK}get additionalInfo(){return this._vodGapController?.additionalInfo||this._liveGapController?.additionalInfo||{}}}et("8NFq9"),er=et("a8VW4");let rm={targetBufferIncreaseRequested:"targetBuffer.targetBufferIncreaseRequested",targetBufferIncreased:"targetBuffer.targetBufferIncreased",targetBufferDecreaseRequested:"targetBuffer.targetBufferDecreaseRequested",originalTargetBufferDecreaseRequested:"targetBuffer.originalTargetBufferDecreaseRequested",originalTargetBufferDisable:"targetBuffer.originalTargetBufferDisable"},rv={setPlaybackSpeed:"playbackSpeed.setPlaybackSpeed"};class ry{_registeredEvents=[];registerEvent(){this._registeredEvents.push(Date.now())}checkEventsInPeriod(e){let t=Date.now()-e;return this._registeredEvents=this._registeredEvents.filter(e=>e>=t),this._registeredEvents.length}clear(){this._registeredEvents=[]}}t1=et("eQOGK");class rb extends tJ{state=n.OK;status="Idle";groups=["PlaybackSpeed"];_nextCheckTimestamp=0;_currentMultiplier=0;_increaseEventsCollector=new ry;constructor(e){super("originalTargetBufferDecreaser",e),this.additionalInfo={isDecreasingDisabled:!1,currentMultiplier:this._currentMultiplier},this._onTargetBufferIncreasedListener=this._eventBus.subscribe(rm.targetBufferIncreased,this._onTargetBufferIncreased),this._onBufferMetricsAvailableListener=this._eventBus.subscribe(t3.bufferMetricsAvailable,this._onBufferMetricsAvailable)}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onTargetBufferIncreasedListener),this._eventBus.unsubscribe(this._onBufferMetricsAvailableListener)}_updateIsDisabledAdditionalInfo(){this.additionalInfo.isDecreasingDisabled=!0}_updateMultiplier(){this._currentMultiplier+=1,this.additionalInfo.currentMultiplier=this._currentMultiplier}_onTargetBufferIncreased(){this._increaseEventsCollector.registerEvent(),this._eventBus.publish(rm.originalTargetBufferDisable,{}),this._updateIsDisabledAdditionalInfo()}_onBufferMetricsAvailable(){0!==this._nextCheckTimestamp&&this._nextCheckTimestamp<performance.now()&&this.config.allowTargetBufferDecrease&&0===this._increaseEventsCollector.checkEventsInPeriod(this.config.targetBufferDecreaseTimeout)&&this._currentMultiplier<this.config.maxTargetBufferMultiplier&&(this._eventBus.publish(rm.originalTargetBufferDecreaseRequested,{}),this._updateMultiplier(),this._nextCheckTimestamp=performance.now()+this.config.targetBufferDecreaseTimeout),this._nextCheckTimestamp=0===this._nextCheckTimestamp?performance.now()+this.config.targetBufferDecreaseTimeout:this._nextCheckTimestamp}}(0,er.__decorate)([t1.default],rb.prototype,"destroy",null),(0,er.__decorate)([t1.default],rb.prototype,"_onTargetBufferIncreased",null),(0,er.__decorate)([t1.default],rb.prototype,"_onBufferMetricsAvailable",null),et("8NFq9"),er=et("a8VW4"),(W=f||(f={})).FAST="fast",W.NORMAL="normal",W.SLOW="slow",t1=et("eQOGK");class rE extends tJ{state=n.OK;status="Idle";groups=["PlaybackSpeed"];_videoElement=null;_currentPlaybackSpeed=f.NORMAL;constructor(e){super("playbackSpeedActuator",e),this._onPlaybackSpeedChangedListener=this._eventBus.subscribe(rv.setPlaybackSpeed,this._onPlaybackSpeedChanged)}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onPlaybackSpeedChangedListener)}setVideoElement(e){this._videoElement=e,this._setPlaybackSpeed()}_handleConfigUpdated(){this._setPlaybackSpeed()}_onPlaybackSpeedChanged(e){this._currentPlaybackSpeed=e,this._setPlaybackSpeed()}_setPlaybackSpeed(){if(!this._videoElement)return;let e={[f.FAST]:this.config.maxPlaybackRate,[f.NORMAL]:1,[f.SLOW]:this.config.minPlaybackRate};this._videoElement.playbackRate=e[this._currentPlaybackSpeed]}get additionalInfo(){return{currentPlaybackMode:this._currentPlaybackSpeed}}}(0,er.__decorate)([t1.default],rE.prototype,"destroy",null),(0,er.__decorate)([t1.default],rE.prototype,"_handleConfigUpdated",null),(0,er.__decorate)([t1.default],rE.prototype,"_onPlaybackSpeedChanged",null),et("8NFq9"),er=et("a8VW4");let rR={getPlaybackSpeedControllerMetrics:"getSideMetricsAsyncEvents.getPlaybackSpeedControllerMetrics",playbackSpeedControllerMetricsAvailable:"getSideMetricsAsyncEvents.playbackSpeedControllerMetricsAvailable",getPlayingTimeFraction:"getSideMetricsAsyncEvents.getPlayingTimeFraction",getPlayingTimeFractionAvailable:"getSideMetricsAsyncEvents.getPlayingTimeFractionAvailable"},rS={fragments:{fragmentLoaded:"fragmentLoader.fragments.fragmentLoaded",fragmentLoadingStarted:"fragmentLoader.fragments.fragmentLoadingStarted",fragmentLoadingAborted:"fragmentLoader.fragments.fragmentLoadingAborted",fragmentLoadingError:"fragmentLoader.fragments.fragmentLoadingError",fragmentHistoryReadyForPrint:"fragmentLoader.fragments.fragmentHistoryReadyForPrint"}},rT={fragmentLoader:rS,playlistRotator:t0,streamLoader:{playlistRotatorTypeChanged:"streamLoader.playlistRotatorTypeChanged"}},rL=(e,t)=>e.partHoldBack||e.serverControl?.partHoldBack||e.serverControl?.holdBack||t;t1=et("eQOGK");class rA extends tJ{state=n.OK;status="Idle";groups=["PlaybackSpeed"];_originalTargetBuffer=2;_currentTargetBufferMultiplier=1;_currentPlaybackRateMode=f.NORMAL;_isPaused=!1;_isDecriseable=!0;_currentOriginalTargetBufferMultiplier=0;constructor(e){super("playbackSpeedWatcher",e),this._logger=e$(this._eventBus,"Doppio - PlaybackSpeedWatcher"),this._onBufferMetricsReadyListener=this._eventBus.subscribe(t3.bufferMetricsAvailable,this._onBufferMetricsAvailable),this._onTargetBufferDecreaseRequestedListener=this._eventBus.subscribe(rm.targetBufferDecreaseRequested,this._targetBufferDecreaseRequested),this._onTargetBufferIncreaseRequestedListener=this._eventBus.subscribe(rm.targetBufferIncreaseRequested,this._targetBufferIncreaseRequested),this._onPlaylistInfoAvailableListener=this._eventBus.subscribe(rT.playlistRotator.playlists.playlistInfo,this._onPlaylistInfoAvailable),this._onPlaybackSpeedControllerMetricsRequestedListener=this._eventBus.subscribe(rR.getPlaybackSpeedControllerMetrics,this._onPlaybackSpeedControllerMetricsRequested),this._onOriginalTargetBufferDecreaseRequestedListener=this._eventBus.subscribe(rm.originalTargetBufferDecreaseRequested,this._originalTargetBufferDecreaseRequested),this._onOriginalTargetBufferDecreaseDisableListener=this._eventBus.subscribe(rm.originalTargetBufferDisable,this._onOriginalTargetBufferDecreaseDisable),this.config.targetBufferInitialMultiplier&&this.config.targetBufferInitialMultiplier<1&&this._logger.warn("Target buffer multiplier set to value lower than 1. It is unsafe to load less than target-duration, forcing no multiplier instead")}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onBufferMetricsReadyListener),this._eventBus.unsubscribe(this._onTargetBufferDecreaseRequestedListener),this._eventBus.unsubscribe(this._onTargetBufferIncreaseRequestedListener),this._eventBus.unsubscribe(this._onPlaylistInfoAvailableListener),this._eventBus.unsubscribe(this._onPlaybackSpeedControllerMetricsRequestedListener),this._eventBus.unsubscribe(this._onOriginalTargetBufferDecreaseRequestedListener),this._eventBus.unsubscribe(this._onOriginalTargetBufferDecreaseDisableListener)}pause(){this._isPaused=!0,this._setNewPlaybackRateMode(f.NORMAL)}resume(){this._isPaused=!1}_handleConfigUpdated(){}_setNewPlaybackRateMode(e){this._currentPlaybackRateMode!==e&&(this._currentPlaybackRateMode=e,this._eventBus.publish(rv.setPlaybackSpeed,e))}_onBufferMetricsAvailable(e){if(this._isPaused)return;let t=this._getTargetBuffer(),r=e.bufferAmountWithoutGaps-t;0!==e.currentPlaybackPosition&&(r>this.config.maxLiveSyncThreshold*t?this._setNewPlaybackRateMode(f.FAST):-1*r>this.config.minLiveSyncThreshold*t?this._setNewPlaybackRateMode(f.SLOW):(this._currentPlaybackRateMode===f.SLOW&&r>0||this._currentPlaybackRateMode===f.FAST&&r<0)&&this._setNewPlaybackRateMode(f.NORMAL))}_targetBufferIncreaseRequested(){this._currentTargetBufferMultiplier<this.config.maxTargetBufferMultiplier&&(this._currentTargetBufferMultiplier+=1,this._eventBus.publish(rm.targetBufferIncreased,{}))}_targetBufferDecreaseRequested(){this._currentTargetBufferMultiplier>1&&(this._currentTargetBufferMultiplier-=1,this._eventBus.publish(rm.targetBufferIncreased,{}))}_onPlaylistInfoAvailable(e){this._originalTargetBuffer=rL(e,3*e.targetDuration)}_onPlaybackSpeedControllerMetricsRequested(){this._eventBus.publish(rR.playbackSpeedControllerMetricsAvailable,this._getTargetBuffer())}_getTargetBuffer(){return this._isDecriseable?this._originalTargetBuffer-this._currentOriginalTargetBufferMultiplier*this.config.targetBufferDecreaseCoefficient:this._originalTargetBuffer*this._currentTargetBufferMultiplier*this.config.targetBufferInitialMultiplier}get additionalInfo(){return{currentTargetBufferMultiplier:this._currentTargetBufferMultiplier,currentTargetBuffer:this._getTargetBuffer()}}_originalTargetBufferDecreaseRequested(){this._currentOriginalTargetBufferMultiplier+=1}_onOriginalTargetBufferDecreaseDisable(){this._isDecriseable=!1}}(0,er.__decorate)([t1.default],rA.prototype,"destroy",null),(0,er.__decorate)([t1.default],rA.prototype,"_onBufferMetricsAvailable",null),(0,er.__decorate)([t1.default],rA.prototype,"_targetBufferIncreaseRequested",null),(0,er.__decorate)([t1.default],rA.prototype,"_targetBufferDecreaseRequested",null),(0,er.__decorate)([t1.default],rA.prototype,"_onPlaylistInfoAvailable",null),(0,er.__decorate)([t1.default],rA.prototype,"_onPlaybackSpeedControllerMetricsRequested",null),(0,er.__decorate)([t1.default],rA.prototype,"_originalTargetBufferDecreaseRequested",null),(0,er.__decorate)([t1.default],rA.prototype,"_onOriginalTargetBufferDecreaseDisable",null),et("8NFq9"),er=et("a8VW4"),t1=et("eQOGK");class rP extends tJ{state=n.OK;status="Idle";groups=["PlaybackSpeed"];additionalInfo={};currentTargetBufferMultiplier=1;_nextCheckTimestamp=0;_currentPlaybackRateMode=f.NORMAL;_slowdownEventsCollector=new ry;constructor(e){super("targetBufferDecreaser",e),this._onPlaybackRateModeChangedListener=this._eventBus.subscribe(rv.setPlaybackSpeed,this._onPlaybackRateModeChanged),this._onBufferMetricsAvailableListener=this._eventBus.subscribe(t3.bufferMetricsAvailable,this._onBufferMetricsAvailable),this._onTargetBufferIncreasedListener=this._eventBus.subscribe(rm.targetBufferIncreased,this._onTargetBufferIncreased)}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onPlaybackRateModeChangedListener),this._eventBus.unsubscribe(this._onBufferMetricsAvailableListener),this._eventBus.unsubscribe(this._onTargetBufferIncreasedListener)}_handleConfigUpdated(){}_onPlaybackRateModeChanged(e){e===this._currentPlaybackRateMode||e!==f.SLOW&&this._currentPlaybackRateMode!==f.SLOW||this._slowdownEventsCollector.registerEvent(),this._currentPlaybackRateMode=e}_onBufferMetricsAvailable(){0!==this._nextCheckTimestamp&&this._nextCheckTimestamp<Date.now()&&this.currentTargetBufferMultiplier>1&&this._currentPlaybackRateMode!==f.SLOW&&0===this._slowdownEventsCollector.checkEventsInPeriod(this.config.periodOfEventsToCancelDecrease)&&(this._eventBus.publish(rm.targetBufferDecreaseRequested,{}),this.currentTargetBufferMultiplier-=1,this._nextCheckTimestamp=this.currentTargetBufferMultiplier>1?Date.now()+this.config.periodOfEventsToCancelDecrease:0)}_onTargetBufferIncreased(){this.currentTargetBufferMultiplier+=1,this._nextCheckTimestamp=Date.now()+this.config.periodOfEventsToCancelDecrease}}(0,er.__decorate)([t1.default],rP.prototype,"destroy",null),(0,er.__decorate)([t1.default],rP.prototype,"_handleConfigUpdated",null),(0,er.__decorate)([t1.default],rP.prototype,"_onPlaybackRateModeChanged",null),(0,er.__decorate)([t1.default],rP.prototype,"_onBufferMetricsAvailable",null),(0,er.__decorate)([t1.default],rP.prototype,"_onTargetBufferIncreased",null),et("8NFq9"),er=et("a8VW4"),t1=et("eQOGK");class rB extends tJ{state=n.OK;status="Idle";groups=["PlaybackSpeed"];_hasFallenBelowLine=!0;constructor(e){super("targetBufferIncreaser",e),this._onBufferMetricsAvailableListener=this._eventBus.subscribe(t3.bufferMetricsAvailable,this._onBufferMetricsAvailable)}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onBufferMetricsAvailableListener)}_handleConfigUpdated(){}_onBufferMetricsAvailable(e){this._hasFallenBelowLine?1e3*e.bufferAmountWithoutGaps>=this.config.bufferAmountThreshold&&(this._hasFallenBelowLine=!1):1e3*e.bufferAmountWithoutGaps<this.config.bufferAmountToIncrease&&(this._hasFallenBelowLine=!0,this._eventBus.publish(rm.targetBufferIncreaseRequested,{}))}get additionalInfo(){return{hasFallenBelowLine:this._hasFallenBelowLine}}}(0,er.__decorate)([t1.default],rB.prototype,"destroy",null),(0,er.__decorate)([t1.default],rB.prototype,"_onBufferMetricsAvailable",null);class rC{state=n.OK;status="Idle";groups=["PlaybackSpeed"];additionalInfo={};constructor(e){this._eventBus=e,this._playbackSpeedActuator=new rE(this._eventBus),this._playbackSpeedWatcher=new rA(this._eventBus),this._targetBufferDecreaser=new rP(this._eventBus),this._targetBufferIncreaser=new rB(this._eventBus),this._originalTargetBufferDecreaser=new rb(this._eventBus)}setVideoElement(e){this._playbackSpeedActuator.setVideoElement(e)}removeVideoElement(){this._playbackSpeedActuator.setVideoElement(null)}pause(){this._playbackSpeedWatcher.pause()}resume(){this._playbackSpeedWatcher.resume()}destroy(){this._playbackSpeedActuator.destroy(),this._playbackSpeedWatcher.destroy(),this._targetBufferDecreaser.destroy(),this._targetBufferIncreaser.destroy(),this._originalTargetBufferDecreaser.destroy()}get additionalModules(){return{playbackSpeedActuator:this._playbackSpeedActuator,playbackSpeedWatcher:this._playbackSpeedWatcher,targetBufferIncreaser:this._targetBufferIncreaser,targetBufferDecreaser:this._targetBufferDecreaser,originalTargetBufferDecreaser:this._originalTargetBufferDecreaser}}}et("8NFq9"),er=et("a8VW4"),(j=_||(_={})).IDLE="idle",j.LOADING="loading",j.PLAYING="playing",j.PAUSED="paused",j.ERROR="error",t1=et("eQOGK");class rw extends tJ{_currentState=_.IDLE;_numberOfStallsOnEdge=0;_videoElement=null;_syncOnNextMetrics=!1;_isInStall=!1;_targetLiveEdge=6;_stallTS=0;_startTS=0;_stalledTimeRanges=[];_stallsToChangeState=3;constructor(e){super("playbackStateController",e),this._onPlaybackMetricsReadyListener=this._eventBus.subscribe(t3.bufferMetricsAvailable,this._onMetricsAvailable),this._onResolutionChangedListener=this._eventBus.subscribe(t8.resolutionChanged,this.reset),this._onFragmentRequestedListener=this._eventBus.subscribe(rT.fragmentLoader.fragments.fragmentLoadingStarted,this._onFragmentRequested),this._onPlaylistInfoAvailableListener=this._eventBus.subscribe(rT.playlistRotator.playlists.playlistInfo,this._onPlaylistInfoAvailable),this._onPlayingTimeFractionRequestedListener=this._eventBus.subscribe(rR.getPlayingTimeFraction,this._onPlayingTimeFractionRequested)}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onPlaybackMetricsReadyListener),this._eventBus.unsubscribe(this._onResolutionChangedListener),this._eventBus.unsubscribe(this._onFragmentRequestedListener),this._eventBus.unsubscribe(this._onPlaylistInfoAvailableListener),this._eventBus.unsubscribe(this._onPlayingTimeFractionRequestedListener),this._videoElement?.removeEventListener("canplaythrough",this._onCanPlayThrough),this._videoElement?.removeEventListener("play",this._onPlay),this._videoElement?.removeEventListener("playing",this._onPlaying)}setVideoElement(e){this._videoElement&&(this._videoElement.removeEventListener("canplaythrough",this._onCanPlayThrough),this._videoElement?.removeEventListener("play",this._onPlay),this._videoElement?.removeEventListener("playing",this._onPlaying)),this._videoElement=e,this._videoElement?.addEventListener("canplaythrough",this._onCanPlayThrough),this._videoElement?.addEventListener("play",this._onPlay),this._videoElement?.addEventListener("playing",this._onPlaying)}reset(){this._currentState=_.IDLE,this._numberOfStallsOnEdge=0}resetPlayingTimeCollector(){this._stallTS=0,this._startTS=0,this._stalledTimeRanges=[]}_handleConfigUpdated(){}_setNextState(e){e!==this._currentState&&(this._eventBus.publish(t3.playbackStateChanged,{prevState:this._currentState,nextState:e}),this._currentState=e)}_onFragmentRequested(){this._currentState===_.IDLE&&this._setNextState(_.LOADING)}_onMetricsAvailable(e){if(this._syncOnNextMetrics&&e.bufferedTimeRanges.length&&(this._syncOnNextMetrics=!1,this._syncToLiveEdge(e.bufferedTimeRanges.slice(-1)[0].end)),this._currentState===_.IDLE)return;this._isInStall!==e.isStallCandidate&&(this._isInStall=e.isStallCandidate,e.isStallCandidate?this._onStall():this._onPlaying());let t=0===e.playbackPositionDelta&&e.isOnBufferEdge;if(!t)return this._numberOfStallsOnEdge=0,void this._setNextState(_.PLAYING);t&&this._currentState===_.PLAYING&&this._numberOfStallsOnEdge++,this._numberOfStallsOnEdge>=this._stallsToChangeState&&this._setNextState(_.PAUSED),this._isInStall&&this.config.stallDurationToDisableTargetBufferDecrease<=Date.now()-this._stallTS&&this._eventBus.publish(rm.originalTargetBufferDisable,{})}_onCanPlayThrough(){this._startTS||(this._startTS=Date.now()),this.config.autoPlay&&this._videoElement?.play()}_onPlaylistInfoAvailable(e){this._targetLiveEdge=rL(e,3*e.targetDuration)}_onPlay(){this.config.syncToLiveEdge&&this._videoElement&&(this._videoElement.buffered.length?this._syncToLiveEdge(this._videoElement.buffered.end(this._videoElement.buffered.length-1)):this._syncOnNextMetrics=!0)}_getDesiredPosition(e){return e-this.config.syncToLiveDelta*this._targetLiveEdge}_syncToLiveEdge(e){if(!this._videoElement||!this._videoElement?.buffered.length)return;let t=this._getDesiredPosition(e);t>this._videoElement.buffered.start(0)&&t>this._videoElement.currentTime&&(this._videoElement.currentTime=t)}_onPlaying(){this._stallTS&&(this._stalledTimeRanges.push({startTS:this._stallTS,endTS:Date.now()}),this._stallTS=0)}_onStall(){this._stallTS=Date.now()}_onPlayingTimeFractionRequested(){let e=this._calculatePlayingTimeFraction();this._eventBus.publish(rR.getPlayingTimeFractionAvailable,e)}_calculatePlayingTimeFraction(){if(!this._startTS)return null;let e=Date.now()-this.config.playingTimeFractionCollectionWindow;this._stalledTimeRanges=this._stalledTimeRanges.filter(({endTS:t})=>t>e);let t=Date.now()-this._startTS,r=t-this._stalledTimeRanges.reduce((e,t)=>e+(t.endTS-t.startTS),0)-(this._stallTS?Date.now()-this._stallTS:0);return this._startTS=Date.now(),r/t}}(0,er.__decorate)([t1.default],rw.prototype,"reset",null),(0,er.__decorate)([t1.default],rw.prototype,"_onFragmentRequested",null),(0,er.__decorate)([t1.default],rw.prototype,"_onMetricsAvailable",null),(0,er.__decorate)([t1.default],rw.prototype,"_onCanPlayThrough",null),(0,er.__decorate)([t1.default],rw.prototype,"_onPlaylistInfoAvailable",null),(0,er.__decorate)([t1.default],rw.prototype,"_onPlay",null),(0,er.__decorate)([t1.default],rw.prototype,"_onPlaying",null),(0,er.__decorate)([t1.default],rw.prototype,"_onPlayingTimeFractionRequested",null);let rO={fragments:{fragmentsParsed:"fragmentParser.fragments.fragmentsParsed",videoFragmentParsed:"fragmentParser.fragments.videoFragmentParsed",audioFragmentParsed:"fragmentParser.fragments.audioFragmentParsed"}};t1=et("eQOGK");class rD extends tJ{_cache=[];_lastMsn=-1;constructor(e){super("bufferController",e)}append(e){for(let t of e)if(this._cache.length){if(t.msn!==this._lastMsn){let e=t.msn-this.config.saveLastSegmentsCount+1;this._cache=[...this._cache.filter(t=>t.isInitSection||t.msn>=e),t]}else this._cache.push(t);this._lastMsn=t.msn}else t.isInitSection&&(this._cache=[t])}getAll(){return this._cache}reset(){this._cache=[],this._lastMsn=-1}destroy(){super.destroy(),this._cache=[],this._lastMsn=-1}}et("8NFq9"),er=et("a8VW4");let rI=e=>new Promise(t=>{e.publish(rR.getPlayingTimeFraction,{}),e.subscribeOnce(rR.getPlayingTimeFractionAvailable,e=>{t(e)})});class rM{_timeServerURL=null;_retryTimeoutId=null;_positionAtZero=0;_abortController=new AbortController;_resyncInterval=-1;constructor(e){this._resyncInterval=e}setUrl(e){this._timeServerURL=e,this._retryTimeoutId&&clearTimeout(this._retryTimeoutId),this._checkDrift()}destroy(){this._abortController.abort(),this._retryTimeoutId&&clearTimeout(this._retryTimeoutId)}async _checkDrift(){if(this._timeServerURL)try{let e=await fetch(`${this._timeServerURL}?orig=doppio`,{cache:"no-cache",signal:this._abortController.signal});if(!e.ok)throw Error(`Could not get time sync response: ${e.status}`);let t=performance.now(),r=0,{requestStart:i,responseStart:n,responseEnd:s}=performance.getEntriesByName(`${this._timeServerURL}/time`)[0]||{};i&&n&&s&&(r=(n-i)/2+(s-n),performance.clearResourceTimings());let a=1e3*Number(await e.text());this._positionAtZero=a+r-t,this._retryTimeoutId&&clearTimeout(this._retryTimeoutId),this._resyncInterval>-1&&(this._retryTimeoutId=setTimeout(()=>this._checkDrift(),this._resyncInterval))}catch(e){if(this._retryTimeoutId&&clearTimeout(this._retryTimeoutId),"AbortController"===e.name)return;this._retryTimeoutId=setTimeout(()=>this._checkDrift(),1e3)}}get currentCorrectedTime(){return this._positionAtZero>0?Math.round(this._positionAtZero+performance.now()):Date.now()}}t1=et("eQOGK");class rF extends tJ{state=n.OK;status="Idle";groups=["buffer","general"];additionalInfo={};_videoElement=null;_checkIntervalId=null;_lastCheckTimestamp=0;_lastFramesTotal=0;_lastFramesDropped=0;_lastFramesPlayed=0;_lastRealFPS=0;_lastPlaybackFPS=0;_lastPlaybackPosition=0;_lastBufferAmount=0;_lastKnownLatencyZeroFrameEncodePosition=0;_timeSync=null;_domainCache=null;constructor(e){super("bufferController",e),this._logger=e$(this._eventBus,"Doppio - BufferMetrics"),this._onLatencyExtraInformationAvailableListener=e.subscribe(t3.latencyExtraInformationAvailable,this._onLatencyExtraInformationAvailable),this._onEntrypointURLUpdatedListener=e.subscribe(t8.entrypointURLUpdated,this._onEntrypointURLUpdated)}destroy(){this._eventBus.unsubscribe(this._onLatencyExtraInformationAvailableListener),this._checkIntervalId&&globalThis.clearInterval(this._checkIntervalId),this._eventBus.unsubscribe(this._onEntrypointURLUpdatedListener),this._timeSync?.destroy(),this._timeSync=null}setVideoElement(e){this._videoElement=e,this._rearmInterval()}removeVideoElement(){this._videoElement=null,this._checkIntervalId&&globalThis.clearInterval(this._checkIntervalId)}_handleConfigUpdated(e){Number.isNaN(e.checkMetricsInterval)||this._rearmInterval()}_rearmInterval(){this._checkIntervalId&&globalThis.clearInterval(this._checkIntervalId),this._checkIntervalId=globalThis.setInterval(this._performCheck,this.config.checkMetricsInterval)}_getCurrentBufferAmount(e){if(!this._videoElement)return this._logger.warn("Cannot compute buffer, there is no video element registered"),0;let{currentTime:t,buffered:r}=this._videoElement;return 0===r.length||t>r.end(r.length-1)?0:e?r.end(r.length-1)-t:0}_getCurrentBufferAmountWithoutGaps(e,t){if(!this._videoElement)return this._logger.warn("Cannot compute buffer, there is no video element registered"),0;if(!e)return 0;let{currentTime:r}=this._videoElement;return e.end-r+t.filter(({start:t})=>t>=e.end).reduce((e,t)=>e+(t.end-t.start),0)}async _performCheck(){var e;if(!this._videoElement)return this._checkIntervalId&&globalThis.clearInterval(this._checkIntervalId),void this._logger.warn("Cannot compute metrics, there is no video element registered");let{creationTime:t,totalVideoFrames:r,droppedVideoFrames:i}=this._videoElement.getVideoPlaybackQuality(),{buffered:n,currentTime:s,paused:a,duration:o,playbackRate:l}=this._videoElement,u=t/1e3;if(!this._lastCheckTimestamp)return this._lastCheckTimestamp=u,this._lastFramesTotal=r,this._lastFramesDropped=i,this._lastFramesPlayed=r-i,void(this._lastPlaybackPosition=s);let d=await (e=this._eventBus,new Promise(t=>{e.publish(rR.getPlaybackSpeedControllerMetrics,{}),e.subscribeOnce(rR.playbackSpeedControllerMetricsAvailable,e=>{t(e)})})),c=await rI(this._eventBus)||0,h=r-i,f=u-this._lastCheckTimestamp,_=s-this._lastPlaybackPosition,g=r-this._lastFramesTotal,p=i-this._lastFramesDropped,m=h-this._lastFramesPlayed,v=g/f,y=g/_,b=this._lastRealFPS-v,E=this._lastPlaybackFPS-y,R=Array(n.length).fill(null).map((e,t)=>{let r={start:n.start(t),end:n.end(t),index:t,isCurrentTimeRange:!1};return(r.start<=s&&s<=r.end||a&&0===t)&&(r.isCurrentTimeRange=!0),r}),S=R.find(({isCurrentTimeRange:e})=>e)||null,T=this._getCurrentBufferAmount(S),L=T<this.config.bufferEdgeThreshold,A=this._lastKnownLatencyZeroFrameEncodePosition?this._lastKnownLatencyZeroFrameEncodePosition+1e3*s:0,P=s>0&&!a&&(T<this.config.bufferStallThreshold||0===_),B=S?.index===R.length-1,C={currentTimestamp:t,currentPlaybackPosition:s,playedVideoFrames:h,totalVideoFramesDelta:g,droppedVideoFramesDelta:p,playedVideoFramesDelta:m,playbackSpeed:l,isOnBufferEdge:L,bufferAmount:T,bufferAmountWithoutGaps:this._getCurrentBufferAmountWithoutGaps(S,R),totalVideoFrames:r,droppedVideoFrames:i,realFPS:v,playbackFPS:y,timeDelta:f,playbackPositionDelta:_,playingTimeFraction:c,realFPSDelta:b,playbackFPSDelta:E,isStallCandidate:P,bufferedTimeRanges:R,currentTimeRange:S,isInLastBufferedRange:B,knownDuration:o,isPaused:a,targetBuffer:d};A&&this._timeSync?.currentCorrectedTime&&(C.latency=this._timeSync.currentCorrectedTime-A),this._lastCheckTimestamp=u,this._lastFramesTotal=r,this._lastFramesDropped=i,this._lastFramesPlayed=r-i,this._lastRealFPS=v,this._lastPlaybackFPS=y,this._lastPlaybackPosition=s,this._lastBufferAmount=T,this._eventBus.publish(t3.bufferMetricsAvailable,C),this.additionalInfo=C}_onLatencyExtraInformationAvailable([e,t]){!this._timeSync&&this.config.enableG2GLatencyMeasurement&&(this._timeSync=new rM(this.config.timeSyncResyncInterval),this._domainCache&&this._timeSync.setUrl(this._domainCache)),this._lastKnownLatencyZeroFrameEncodePosition=t-e/90}_onEntrypointURLUpdated({entrypointURL:e}){let t=new URL(e).host.split(".").slice(-2).join("."),r=this.config.timeSyncUrlTemplate.replace("{{domain}}",t);this._timeSync?.setUrl(r),this._domainCache=r}}(0,er.__decorate)([t1.default],rF.prototype,"_handleConfigUpdated",null),(0,er.__decorate)([t1.default],rF.prototype,"_performCheck",null),(0,er.__decorate)([t1.default],rF.prototype,"_onLatencyExtraInformationAvailable",null),(0,er.__decorate)([t1.default],rF.prototype,"_onEntrypointURLUpdated",null);let rN=e=>`video/mp4; codecs="${e}"`;class rk extends tJ{state=n.OK;status="Idle";additionalInfo={};groups=["buffer","general"];_sourceBuffer=null;_isSourceBufferReady=!1;_awaitingForNextSourceBuffer=!1;_isVODMode=!1;_closeOnNextSegment=!1;_currentVideoDuration=Number.POSITIVE_INFINITY;_videoElement=null;_mediaSource=null;_knownObjectURL="";_mimeType='video/mp4; codecs="mp4a.40.2,avc1.64001f"';_shouldRecreateSourceBufferOnStall=!1;_sourceBufferStuckTimer=null;constructor(e){super("bufferController",e),this._logger=e$(e,"Doppio - BufferController"),this._eventBus=e,this._logger=e$(this._eventBus,"Doppio - BufferController"),this._logger.info("Created"),this._bufferCleaner=new rl(this._eventBus),this._bufferMetrics=new rF(this._eventBus),this._bufferStallsDetector=new rd(this._eventBus),this._bufferOpsQueue=new ru(this._eventBus),this._playbackSpeedController=new rC(this._eventBus),this._playbackStateController=new rw(this._eventBus),this._bufferChunksCache=new rD(this._eventBus),this._onFragmentParsedListener=this._eventBus.subscribe(rO.fragments.fragmentsParsed,this._onFragmentsParsed),this._onSoftResetRequestedListener=this._eventBus.subscribe(t3.requestResetWithOverplay,this._onSoftResetRequested),this._onVODPlaylistDetectedListener=this._eventBus.subscribe(rT.playlistRotator.playlistType.vodDetected,this._onVODPlaylistDetected),this._onSimplePlaylistDetectedListener=this._eventBus.subscribe(rT.playlistRotator.playlistType.simpleDetected,this._onLivePlaylistDetected),this._onLLPlaylistDetectedListener=this._eventBus.subscribe(rT.playlistRotator.playlistType.llDetected,this._onLivePlaylistDetected),this._onSourceBufferOperationRequestedListener=this._eventBus.subscribe(t3.requestSourceBufferOperation,this._onSourceBufferOperationRequested),this._onPlaylistInfoAvailableListener=this._eventBus.subscribe(rT.playlistRotator.playlists.playlistInfo,this._onPlaylistInfoAvailable),this._onEndOfStreamReachedListener=this._eventBus.subscribe(t3.endOfStreamReached,this._onEndOfStreamReached),this._onResolutionCodecChangeRequestListener=this._eventBus.subscribe(t3.changeCodec,this._onResolutionCodecChangeRequest),this._onResolutionChangeListener=this._eventBus.subscribe(t8.resolutionChanged,this._onResolutionChange),this._onPlaybackStallChangedListener=this._eventBus.subscribe(t3.playbackStallChanged,this._onPlaybackStallChanged),this._onSourceBufferStuckListener=this._eventBus.subscribe(t3.sourceBufferStuck,this._onSourceBufferStuck),this._gapController=new rp(this._eventBus)}attachVideoElement(e){this._logger.info("Attach video element",e),this._bufferMetrics.setVideoElement(e),this._playbackSpeedController.setVideoElement(e),this._gapController.setVideoElement(e),this._bufferCleaner.setVideoElement(e),this._playbackStateController.setVideoElement(e),this._videoElement=e,this._recreateMediaSource()}scheduleSourceBufferRecreation(){this._awaitingForNextSourceBuffer=!0}detachVideoElement(){if(this._logger.info("Detaching video element"),this._eventBus.publish(t3.requestResetWithOverplay,{}),this._bufferMetrics.removeVideoElement(),this._playbackSpeedController.removeVideoElement(),this._gapController.removeVideoElement(),this._bufferCleaner.removeVideoElement(),this._playbackStateController.setVideoElement(null),"open"===this._mediaSource?.readyState&&this._videoElement&&this._videoElement.readyState>=this._videoElement.HAVE_METADATA)try{this._logger.verbose("Calling endOfStream of mediaSource"),this._mediaSource.endOfStream()}catch(e){this._logger.warn(`Error occurred while detaching video element. Ignoring it ${e.message}`)}try{this._mediaSource&&this._sourceBuffer&&([...this._mediaSource.sourceBuffers].includes(this._sourceBuffer)&&(this._logger.debug("Removing sourceBuffer from MediaSource"),this._mediaSource.removeSourceBuffer(this._sourceBuffer)),this._sourceBuffer=null)}catch(e){this._logger.error(`Failed to reset source buffer ${e.message}`)}if(this._mediaSource&&(this._mediaSource.removeEventListener("sourceopen",this._onSourceBufferOpened),this._mediaSource.removeEventListener("sourceclose",this._onSourceBufferClosed),this._mediaSource.removeEventListener("error",this._onSourceBufferError)),this._videoElement){if(this._knownObjectURL){let e=this._knownObjectURL;setTimeout(()=>{this._logger.debug(`Revoking Object URL ${e}`),globalThis.URL.revokeObjectURL(e)},100)}this._videoElement.src===this._knownObjectURL&&(this._videoElement.removeAttribute("src"),this._videoElement.load())}this._mediaSource=null,this._videoElement=null,this._knownObjectURL="",this._isSourceBufferReady=!1}destroy(){super.destroy(),this._logger.info("Destroy"),this.detachVideoElement(),this._eventBus.unsubscribe(this._onFragmentParsedListener),this._eventBus.unsubscribe(this._onSoftResetRequestedListener),this._eventBus.unsubscribe(this._onSourceBufferOperationRequestedListener),this._eventBus.unsubscribe(this._onVODPlaylistDetectedListener),this._eventBus.unsubscribe(this._onSimplePlaylistDetectedListener),this._eventBus.unsubscribe(this._onLLPlaylistDetectedListener),this._eventBus.unsubscribe(this._onPlaylistInfoAvailableListener),this._eventBus.unsubscribe(this._onEndOfStreamReachedListener),this._eventBus.unsubscribe(this._onResolutionCodecChangeRequestListener),this._eventBus.unsubscribe(this._onResolutionChangeListener),this._eventBus.unsubscribe(this._onPlaybackStallChangedListener),this._eventBus.unsubscribe(this._onSourceBufferStuckListener),this._gapController.destroy(),this._bufferMetrics.destroy(),this._bufferOpsQueue.destroy(),this._bufferCleaner.destroy(),this._playbackSpeedController.destroy(),this._playbackStateController.destroy(),this._bufferChunksCache.destroy(),this._disarmSourceBufferStuckTimer()}reset(){this._disarmSourceBufferStuckTimer(),this._recreateSourceBuffer(),this._bufferChunksCache.reset()}_onFragmentsParsed(e){for(let t of(this._awaitingForNextSourceBuffer&&(this._awaitingForNextSourceBuffer=!1,this._recreateSourceBuffer()),this._bufferOpsQueue.addBufferOperation(()=>{this._mediaSource&&"open"===this._mediaSource.readyState&&(this._mediaSource.duration=this._currentVideoDuration)},()=>{this._logger.warn("Could not set mediaSource duration")},"setMediaSourceDuration"),e))this._bufferOpsQueue.addBufferOperation(e=>{this._logger.debug(`Adding ${t.getMsnPn()} to buffer`),e.appendBuffer(t.data),t.msn>-1&&(this._logger.debug(`${t.startTs} -> ${t.endTs} loaded (${t.getMsnPn()})`),this._eventBus.publish(t3.fragmentAdded,t)),this._mediaSource&&t.endTs===this._mediaSource.duration&&this._eventBus.publish(t3.endOfStreamReached,{})},(e,r)=>{this._logger.error(`${t.url} (${t.getMsnPn()}) cannot be added to buffer: ${r}`)},"appendBuffer");this._sourceBuffer||this._bufferChunksCache.append(e),this._bufferOpsQueue.addBufferOperation(()=>{this._mediaSource&&"open"===this._mediaSource.readyState&&(this._mediaSource.duration=this._currentVideoDuration,this._videoElement&&0===this._videoElement.currentTime&&this._videoElement.buffered.length>0&&this._videoElement.buffered.start(0)>0&&(this._videoElement.currentTime=this._videoElement.buffered.start(0)))},()=>{this._logger.warn("Could not change current time of video")},"setVideoElementStartPosition")}_onSourceBufferOpened(){if(this._logger.debug("Source buffer is open now"),this._disarmSourceBufferStuckTimer(),this._mediaSource){this._logger.debug("Media source known"),"open"===this._mediaSource.readyState&&(this._logger.debug("State of mediaSource is open. Setting duration"),this._mediaSource.duration=this._currentVideoDuration),this._isSourceBufferReady=!0,this._sourceBuffer=this._mediaSource.addSourceBuffer(this._mimeType),this._logger.debug(`Source buffer is open with mimeType ${this._mimeType}`),this._bufferOpsQueue.setSourceBuffer(this._sourceBuffer);let e=this._bufferChunksCache.getAll();this._bufferChunksCache.destroy(),e.length&&this._onFragmentsParsed(e)}}_recreateSourceBuffer(){this._logger.info("Will recreate source buffer"),this._bufferOpsQueue.immediatelyRecreateSourceBuffer(this._mediaSource),this._videoElement&&(this._videoElement.currentTime=0)}_onResolutionCodecChangeRequest({codec:e}){if(e){let t=rN(e);t!==this._mimeType&&(this._mimeType=t)}}_onSourceBufferClosed(){this._logger.debug("Source buffer closed"),this._isSourceBufferReady=!1}_onSourceBufferError(){this._logger.debug("Source buffer error"),this._isSourceBufferReady=!1}_onSoftResetRequested(){this._logger.debug("Soft reset requested"),this._shouldRecreateSourceBufferOnStall=!1,this._awaitingForNextSourceBuffer=!0,this._playbackStateController.resetPlayingTimeCollector()}_endOfStreamReached(){this._mediaSource&&(this._closeOnNextSegment=!0)}_onSourceBufferOperationRequested(e){this._bufferOpsQueue.addBufferOperation(e)}_onLivePlaylistDetected(){this._isVODMode=!1,this._bufferCleaner.setVODMode(!1),this._gapController.setIsVod(!1),this._currentVideoDuration=Number.POSITIVE_INFINITY,this._playbackSpeedController.resume(),this._mediaSource&&"open"===this._mediaSource.readyState&&(this._mediaSource.duration=this._currentVideoDuration)}_onVODPlaylistDetected(){this._isVODMode=!0,this._bufferCleaner.setVODMode(!0),this._playbackSpeedController.pause(),this._gapController.setIsVod(!0)}_onPlaybackStallChanged(e){e&&this._shouldRecreateSourceBufferOnStall&&(this._logger.info("Will recreate source buffer, because playback stall was detected"),this._onSoftResetRequested())}_onPlaylistInfoAvailable(e){e&&e.playlists&&e.playlists[0].attributes.CODECS&&(this._mimeType=rN(e.playlists[0].attributes.CODECS),this._bufferOpsQueue.addBufferOperation(e=>{e.changeType(this._mimeType)},()=>{this._logger.warn("Could not change codecs")},"changeType")),("VOD"===e.playlistType||e.endList)&&(this._currentVideoDuration=e.segments.reduce((e,t)=>e+t.duration,0),this._mediaSource&&"open"===this._mediaSource.readyState&&(this._mediaSource.duration=this._currentVideoDuration,this._mediaSource.setLiveSeekableRange(0,this._currentVideoDuration)))}_onEndOfStreamReached(){this._bufferOpsQueue.addBufferOperation(()=>{this._logger.info("Setting endOfStream"),this._mediaSource?.endOfStream()})}_onResolutionChange(){this.config.recreateSourceBufferOnResolutionChange?(this._logger.info("Will recreate source buffer, because resolution was changed, and config.recreateSourceBufferOnResolutionChange is true"),this._onSoftResetRequested()):this._shouldRecreateSourceBufferOnStall=!0}_onSourceBufferStuck(){this._logger.info("Source buffer stuck. Schedule reset"),this._onSoftResetRequested()}_recreateMediaSource(){this._logger.info("Recreate media source"),this._mediaSource&&(this._logger.debug("Media source already known. Removing event listeners"),this._mediaSource.removeEventListener("sourceopen",this._onSourceBufferOpened),this._mediaSource.removeEventListener("sourceclose",this._onSourceBufferClosed),this._mediaSource.removeEventListener("error",this._onSourceBufferError)),this._mediaSource=new rk.MediaSource,this._logger.debug("Media source created. Attaching event listeners"),this._mediaSource.addEventListener("sourceopen",this._onSourceBufferOpened,{once:!0}),this._mediaSource.addEventListener("sourceclose",this._onSourceBufferClosed),this._mediaSource.addEventListener("error",this._onSourceBufferError),this._videoElement&&(this._videoElement.src=globalThis.URL.createObjectURL(this._mediaSource),this._logger.debug(`MSE URL: ${this._videoElement.src}`)),this._sourceBufferStuckTimer=setTimeout(()=>{this._logger.debug("Source buffer stuck timeout set"),this._recreateMediaSource()},this.config.sourceBufferStuckTimeout)}_disarmSourceBufferStuckTimer(){this._sourceBufferStuckTimer&&(this._logger.debug("Source buffer stuck timer disarm"),clearTimeout(this._sourceBufferStuckTimer))}get additionalModules(){return{gapController:this._gapController,bufferMetrics:this._bufferMetrics,playbackSpeed:this._playbackSpeedController}}static get MediaSource(){if(window?.ManagedMediaSource)return window.ManagedMediaSource;if(window?.MediaSource)return window.MediaSource;throw Error("No Media Source candidates found")}}(0,er.__decorate)([t1.default],rk.prototype,"_onFragmentsParsed",null),(0,er.__decorate)([t1.default],rk.prototype,"_onSourceBufferOpened",null),(0,er.__decorate)([t1.default],rk.prototype,"_onResolutionCodecChangeRequest",null),(0,er.__decorate)([t1.default],rk.prototype,"_onSourceBufferClosed",null),(0,er.__decorate)([t1.default],rk.prototype,"_onSourceBufferError",null),(0,er.__decorate)([t1.default],rk.prototype,"_onSoftResetRequested",null),(0,er.__decorate)([t1.default],rk.prototype,"_endOfStreamReached",null),(0,er.__decorate)([t1.default],rk.prototype,"_onSourceBufferOperationRequested",null),(0,er.__decorate)([t1.default],rk.prototype,"_onLivePlaylistDetected",null),(0,er.__decorate)([t1.default],rk.prototype,"_onVODPlaylistDetected",null),(0,er.__decorate)([t1.default],rk.prototype,"_onPlaybackStallChanged",null),(0,er.__decorate)([t1.default],rk.prototype,"_onPlaylistInfoAvailable",null),(0,er.__decorate)([t1.default],rk.prototype,"_onEndOfStreamReached",null),(0,er.__decorate)([t1.default],rk.prototype,"_onResolutionChange",null),(0,er.__decorate)([t1.default],rk.prototype,"_onSourceBufferStuck",null),(0,er.__decorate)([t1.default],rk.prototype,"_recreateMediaSource",null);class rx extends eD{}et("8NFq9"),er=et("a8VW4");let rU={fragmentsReleased:"fragmentsFilter.fragmentsReleased",problemDetected:"fragmentsFilter.problemDetected"};t1=et("eQOGK");class rV extends tJ{_localFragmentParser=null;_workerFragmentParser=null;_fragmentsCache=[];_isCacheRequired=!1;constructor(e){super("fragmentParser",e),this._logger=e$(e,"Doppio - FragmentParser"),this._logger=e$(this._eventBus,"Doppio - FragmentParser"),this._onFragmentReleasedListener=this._eventBus.subscribe(rU.fragmentsReleased,this._onFragmentsLoaded),this._onVODPlaylistDetectedListener=this._eventBus.subscribe(rT.playlistRotator.playlistType.vodDetected,this._onVODPlaylistDetected),this._onSimplePlaylistDetectedListener=this._eventBus.subscribe(rT.playlistRotator.playlistType.simpleDetected,this._onLivePlaylistDetected),this._onLLPlaylistDetectedListener=this._eventBus.subscribe(rT.playlistRotator.playlistType.llDetected,this._onLivePlaylistDetected),this._onReleaseFromCacheRequestedListener=this._eventBus.subscribe(t0.fragments.requestReleaseFromCache,this._onReleaseFromCacheRequested)}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onFragmentReleasedListener),this._eventBus.unsubscribe(this._onVODPlaylistDetectedListener),this._eventBus.unsubscribe(this._onSimplePlaylistDetectedListener),this._eventBus.unsubscribe(this._onLLPlaylistDetectedListener),this._eventBus.unsubscribe(this._onReleaseFromCacheRequestedListener)}_handleConfigUpdated(){}_onReleaseFromCacheRequested({msn:e}){let t=this._fragmentsCache.find(t=>t.msn===e);t&&this._eventBus.publish(rO.fragments.fragmentsParsed,[t])}_onLivePlaylistDetected(){this._isCacheRequired=!1,this._fragmentsCache=[]}_onVODPlaylistDetected(){this._isCacheRequired=!0}async _onFragmentsLoaded(e){this._logger.verbose(`Sending fragment ${e.map(e=>e.getMsnPn())} for parsing`),this._eventBus.publish(rO.fragments.fragmentsParsed,e)}}(0,er.__decorate)([t1.default],rV.prototype,"destroy",null),(0,er.__decorate)([t1.default],rV.prototype,"_handleConfigUpdated",null),(0,er.__decorate)([t1.default],rV.prototype,"_onReleaseFromCacheRequested",null),(0,er.__decorate)([t1.default],rV.prototype,"_onLivePlaylistDetected",null),(0,er.__decorate)([t1.default],rV.prototype,"_onVODPlaylistDetected",null),(0,er.__decorate)([t1.default],rV.prototype,"_onFragmentsLoaded",null),et("8NFq9"),er=et("a8VW4");let rq=e=>{let t=new DataView(e),r=0,i=[];for(;r<e.byteLength;){let n=t.getUint32(r,!1),s={size:n,name:(new TextDecoder).decode(e.slice(r+4,r+8)),payload:e.slice(r+8,r+n)};r+=n,i.push(s)}return i},rG=e=>{let t=new Uint8Array(e.reduce((e,t)=>e+t.byteLength,0));return e.reduce((e,r)=>(t.set(new Uint8Array(r),e),e+r.byteLength),0),t.buffer},rW="fragmentsQueue.fragmentReleased";t1=et("eQOGK");let rj={saveData:"fragmentsBufferEvents.saveData"};class rH extends tJ{_lastKnownInitSectionNumberOfTracks=null;constructor(e){super("fragmentsFilter",e),this._logger=e$(e,"Doppio - FragmentsFilter"),this._logger=e$(this._eventBus,"Doppio - FragmentsFilter"),this._onFragmentReleasedListenerToken=this._eventBus.subscribe(rW,this._onFragmentReleasedFromQueue)}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onFragmentReleasedListenerToken)}_onFragmentReleasedFromQueue(e){let t=[];for(let r of e)if(r.isInitSection)this._parseInitSection(r),t.push(r);else{let e=this._parseMediaFragment(r);this.config.filterOutInconsistentTracks&&!e||t.push(r)}this._eventBus.publish(rU.fragmentsReleased,t)}_parseInitSection(e){this._logger.debug("Parsing init section");let t=rq(e.data),r=t.find(({name:e})=>"moov"===e)||null;if(this._logger.verbose(`Found following root boxes: ${t.map(({name:e})=>e).join(", ")}`),r){let e=rq(r.payload);this._logger.verbose(`Found following child of moov boxes: ${e.map(({name:e})=>e).join(", ")}`);let t=e.filter(({name:e})=>"trak"===e);this._logger.info(`Found ${t.length} trak boxes`),this._lastKnownInitSectionNumberOfTracks=t.length}}_parseMediaFragment(e){if(null===this._lastKnownInitSectionNumberOfTracks)return!0;let t=rq(e.data),r=t.filter(({name:e})=>"sidx"===e);this._logger.verbose(`Found following root boxes: ${t.map(({name:e})=>e).join(", ")}`);let i=t.filter(({name:e})=>"moof"===e),n=[],s=!1;for(let e of(r.length>0&&r.length%this._lastKnownInitSectionNumberOfTracks!=0&&(this._logger.warn(`Inconsistent media chunk: number of SIDX boxes is invalid, ${r.length} found, ${this._lastKnownInitSectionNumberOfTracks} expected`),n.push(`Number of SIDX boxes (${r.length}) is not equal to the known amount of media tracks (${this._lastKnownInitSectionNumberOfTracks})`),s=!0),i)){let t=rq(e.payload),r=t.filter(({name:e})=>"traf"===e);this._logger.verbose(`Found following child of moof boxes: ${t.map(({name:e})=>e).join(", ")}`),r.length!==this._lastKnownInitSectionNumberOfTracks&&(this._logger.warn(`Inconsistent media chunk: number of TRAF boxes is invalid, ${r.length} found, ${this._lastKnownInitSectionNumberOfTracks} expected`),n.push(`Number of TRAF boxes (${r.length}) is not equal to the known amount of media tracks (${this._lastKnownInitSectionNumberOfTracks})`),s=!0)}return s&&(this._logger.warn(`Fragment ${e.getMsnPn()} should be reported`),this._eventBus.publish(rU.problemDetected,{fragment:e.url.split("/").slice(-1)[0],reason:n.join("; ")}),this._eventBus.publish(rj.saveData,{})),s}}(0,er.__decorate)([t1.default],rH.prototype,"_onFragmentReleasedFromQueue",null),et("8NFq9"),er=et("a8VW4"),t1=et("eQOGK"),(H=g||(g={})).UNKNOWN="unknown",H.INDEPENDENT="independent",H.PART="part";class r${state=n.OK;status="Idle";groups=["queue"];_queuedFragments=[];_additionalInfo={};constructor(e){this._eventBus=e,this._logger=e$(this._eventBus,"Doppio - FragmentsQueue"),this._fragmentRequestedListenerToken=this._eventBus.subscribe(rT.fragmentLoader.fragments.fragmentLoadingStarted,this._onFragmentRequested),this._onFragmentsDetectedListenerToken=this._eventBus.subscribe(t0.fragments.fragmentsDetected,this._onFragmentsDetected),this._softResetRequestedListenerToken=this._eventBus.subscribe(t3.requestResetWithOverplay,this._onSoftResetRequested),this._fragmentLoadedListenerToken=this._eventBus.subscribe(rT.fragmentLoader.fragments.fragmentLoaded,this._onFragmentLoaded),this._fragmentAbortedListenerToken=this._eventBus.subscribe(rT.fragmentLoader.fragments.fragmentLoadingAborted,this._onFragmentAborted),this._fragmentErrorListenerToken=this._eventBus.subscribe(rT.fragmentLoader.fragments.fragmentLoadingError,this._onFragmentAborted),this._onFragmentReleaseFromCacheRequestedToken=this._eventBus.subscribe(t0.fragments.requestReleaseFromCache,this._onFragmentReleasedFromCache),this._onResolutionChangedListenerToken=this._eventBus.subscribe(t8.resolutionChanged,this._onSoftResetRequested)}getCurrentQueue(){return this._queuedFragments}destroy(){this._eventBus.unsubscribe(this._onFragmentsDetectedListenerToken),this._eventBus.unsubscribe(this._fragmentLoadedListenerToken),this._eventBus.unsubscribe(this._fragmentRequestedListenerToken),this._eventBus.unsubscribe(this._softResetRequestedListenerToken),this._eventBus.unsubscribe(this._onResolutionChangedListenerToken),this._eventBus.unsubscribe(this._fragmentErrorListenerToken),this._eventBus.unsubscribe(this._fragmentAbortedListenerToken),this._eventBus.unsubscribe(this._onFragmentReleaseFromCacheRequestedToken),this.reset()}reset(){this._queuedFragments=[],this.status="Idle"}_onSoftResetRequested(){this.reset()}_onFragmentRequested(e){this._queuedFragments.find(({url:t})=>e.url===t)?this._logger.warn(`Same fragment (${e.getMsnPn()}) was already in queue! Ignoring it`):(this._logger.verbose(`Add fragment ${e.getMsnPn()} to queue`),e.goToLifecycleStage("addedToQueue"),this._queuedFragments.push(e),this.status="Awaiting fragments")}_onFragmentLoaded(e){let t=this._queuedFragments.find(({msn:t,pn:r})=>t===e.msn&&r===e.pn);t?(this._logger.debug(`Fragment ${e.getMsnPn()} was resolved finally`),t.data=e.data,this._checkQueue()):this._logger.warn(`Received fragment ${e.getMsnPn()} was not in queue. Pls check it`)}_onFragmentReleasedFromCache({msn:e}){this._queuedFragments=this._queuedFragments.filter(t=>t.msn===e),this._checkQueue()}_onFragmentsDetected(e){e.forEach(e=>{let t=this._queuedFragments.find(({msn:t,pn:r})=>t===e.msn&&r===e.pn);t&&(t.independent=e.independent)}),this._checkQueue()}_onFragmentAborted(e){let t=this._queuedFragments.filter(({msn:t})=>t<=e.msn);this._queuedFragments=this._queuedFragments.filter(e=>!t.includes(e)),this._checkQueue()}_checkQueue(){if(this._logger.verbose("Checking queue"),!this._queuedFragments.length)return void this._logger.verbose("Queue is empty. Skipping");if(!this._queuedFragments[0].data||this._queuedFragments[0].independent===g.UNKNOWN)return void this._logger.verbose("First queued fragment is empty. Skipping");let e=this._queuedFragments.findIndex(e=>!e.data||e.independent===g.UNKNOWN);if(-1===e)return this._logger.verbose("Looks like whole queue was resolved"),void this._releaseFragmentsFromQueue(this._queuedFragments);this._logger.verbose(`${e} fragments ready. Releasing them`);let t=this._queuedFragments.slice(0,e);this._releaseFragmentsFromQueue(t)}_releaseFragmentsFromQueue(e){this._logger.verbose(`Release fragment  ${e.map(e=>e.getMsnPn())}from queue`),e.forEach(e=>e.goToLifecycleStage("releasedFromQueue")),this._queuedFragments=this._queuedFragments.filter(t=>!e.includes(t)),this._eventBus.publish(rW,e),this.status=this._queuedFragments.length>0?this.status:"Idle"}get additionalInfo(){return{...this._additionalInfo,awaitingFragments:this.getCurrentQueue().map(e=>({...e,data:void 0}))}}}(0,er.__decorate)([t1.default],r$.prototype,"_onSoftResetRequested",null),(0,er.__decorate)([t1.default],r$.prototype,"_onFragmentRequested",null),(0,er.__decorate)([t1.default],r$.prototype,"_onFragmentLoaded",null),(0,er.__decorate)([t1.default],r$.prototype,"_onFragmentReleasedFromCache",null),(0,er.__decorate)([t1.default],r$.prototype,"_onFragmentsDetected",null),(0,er.__decorate)([t1.default],r$.prototype,"_onFragmentAborted",null),(0,er.__decorate)([t1.default],r$.prototype,"_releaseFragmentsFromQueue",null);let rK=new class{_ooEndpoint="/api/front/v2/logs/streaming";async reportError(e,t){try{await fetch(this._ooEndpoint,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({doppioLifecycleError:{errorType:e,context:t}})})}catch(e){}}};et("8NFq9"),er=et("a8VW4"),et("8NFq9"),er=et("a8VW4"),et("8NFq9"),er=et("a8VW4"),($=p||(p={})).UNKNOWN="unknown",$.LOADING="loading",$.LOADED="loaded",$.ABORTED="aborted",$.ERROR="error",$.DESTROYED="destroyed",et("8NFq9"),er=et("a8VW4"),t1=et("eQOGK"),(K=m||(m={})).FETCH="fetch",K.ABORT="abort",K.DESTROY="destroy",K.DATA_READY="dataReady",K.STATS_READY="statsReady",K.CHANGE_STATE="changeState",K.ERROR="error",K.REDIRECT_DETECTED="redirectDetected";let rY=e=>{let t=new Uint8Array(e.reduce((e,t)=>e+t.length,0)),r=0;return e.forEach(e=>{t.set(e,r),r+=e.length}),t},rQ=(e,t,r,i)=>((e,t,r)=>{if(!globalThis.performance||!globalThis.performance.getEntriesByName)return null;let i=globalThis.performance.getEntriesByName(e)[0];if(!i)return null;let{connectStart:n,connectEnd:s,domainLookupEnd:a,duration:o,domainLookupStart:l,encodedBodySize:u,responseStart:d,requestStart:c}=i,h=(u||t)/1024;return globalThis.performance.clearResourceTimings(),{connectDuration:s-n,domainLookupDuration:a-l,sizeInKb:h,ttfb:d-c,downloadDuration:o,calculatedSpeed:h/(o/1e3)*8,type:r,url:e}})(e,r,i)||{connectDuration:0,domainLookupDuration:0,sizeInKb:r/1024,ttfb:0,url:e,downloadDuration:t,calculatedSpeed:r/1024/(t/1e3)*8,type:i};class rz{requestUrl="";realUrl="";mode="";_dataChunks=[];_receivedLength=0;_abortController=new AbortController;_startLoadTimestamp=0;_isAborted=!1;constructor(e){this._config=e}abort(){this._isAborted=!0,this._abortController.abort()}async fetch(e,t){try{globalThis.performance&&globalThis.performance.clearResourceTimings&&globalThis.performance.clearResourceTimings(),this._config.onChangeState(p.LOADING),this._startLoadTimestamp=Date.now(),this.requestUrl=e,this.mode=t,this._receivedLength=0;let r=new Request(this.requestUrl),i={signal:this._abortController.signal};this._config.requestCustomReferer&&(i.headers={"X-Referer":this._config.requestCustomReferer});let n=await fetch(r,i);this.realUrl=n.url;let s=n.body?.getReader();if(!s)throw Error();for(;;){let{done:e,value:t}=await s.read();if(e)break;this._dataChunks.push(t),this._receivedLength+=t.length}if(!n.ok&&(!n.status||n.status>399))throw this.error={status:n.status,statusText:n.statusText||this._receivedLength?String.fromCharCode(...rY(this._dataChunks)):""},Error();let a=rY(this._dataChunks).buffer;this._config.onDataReady("text"!==this.mode?a:new TextDecoder("utf-8").decode(a)),this._config.onStatsReady(this._getNetworkStats()),this.realUrl!==this.requestUrl&&this._config.onRedirectDetected(this.requestUrl,this.realUrl),this._config.onChangeState(p.LOADED,{realUrl:n.url,status:n.status})}catch(e){if(this._isAborted)return this._config.onStatsReady(this._getNetworkStats()),void this._config.onChangeState(p.ABORTED);this.error||(this.error={status:-1,statusText:e.toString()}),this._config.onError(this.error),this._config.onChangeState(p.ERROR,{status:this.error.status})}}_getNetworkStats(){let e=Date.now()-this._startLoadTimestamp,t="text"===this.mode?"text":"binary";return rQ(this.requestUrl,e,this._receivedLength,t)}}let rX=[p.ERROR,p.LOADED,p.ABORTED],rZ=new Map,rJ=async(e="",t)=>{let r=rZ.get(e);return!r&&t&&(r=new Worker(URL.createObjectURL(new Blob([`${Z('let e;var t;(t=e||(e={})).FETCH="fetch",t.ABORT="abort",t.DESTROY="destroy",t.DATA_READY="dataReady",t.STATS_READY="statsReady",t.CHANGE_STATE="changeState",t.ERROR="error",t.REDIRECT_DETECTED="redirectDetected";const r=e=>{const t=e.reduce(((e,t)=>e+t.length),0),r=new Uint8Array(t);let a=0;return e.forEach((e=>{r.set(e,a),a+=e.length})),r};let a;var o;(o=a||(a={})).UNKNOWN="unknown",o.LOADING="loading",o.LOADED="loaded",o.ABORTED="aborted",o.ERROR="error",o.DESTROYED="destroyed";const s=(e,t,r,a)=>{const o=((e,t,r)=>{if(!globalThis.performance||!globalThis.performance.getEntriesByName)return null;const a=globalThis.performance.getEntriesByName(e)[0];if(!a)return null;const{connectStart:o,connectEnd:s,domainLookupEnd:n,duration:i,domainLookupStart:l,encodedBodySize:d,responseStart:c,requestStart:u}=a,h=(d||t)/1024,g=i;return globalThis.performance.clearResourceTimings(),{connectDuration:s-o,domainLookupDuration:n-l,sizeInKb:h,ttfb:c-u,downloadDuration:g,calculatedSpeed:h/(g/1e3)*8,type:r,url:e}})(e,r,a);return o||{connectDuration:0,domainLookupDuration:0,sizeInKb:r/1024,ttfb:0,url:e,downloadDuration:t,calculatedSpeed:r/1024/(t/1e3)*8,type:a}};class $23b27e332a61b135$export$df6d58d46cb3f0ea{requestUrl="";realUrl="";mode="";_dataChunks=[];_receivedLength=0;_abortController=new AbortController;_startLoadTimestamp=0;_isAborted=!1;constructor(e){this._config=e}abort(){this._isAborted=!0,this._abortController.abort()}async fetch(e,t){try{globalThis.performance&&globalThis.performance.clearResourceTimings&&globalThis.performance.clearResourceTimings(),this._config.onChangeState(a.LOADING),this._startLoadTimestamp=Date.now(),this.requestUrl=e,this.mode=t,this._receivedLength=0;const o=new Request(this.requestUrl),s={signal:this._abortController.signal};this._config.requestCustomReferer&&(s.headers={"X-Referer":this._config.requestCustomReferer});const n=await fetch(o,s);this.realUrl=n.url;const i=n.body?.getReader();if(!i)throw new Error;for(;;){const{done:e,value:t}=await i.read();if(e)break;this._dataChunks.push(t),this._receivedLength+=t.length}if(!n.ok&&(!n.status||n.status>399))throw this.error={status:n.status,statusText:n.statusText||this._receivedLength?String.fromCharCode(...r(this._dataChunks)):""},new Error;const l=r(this._dataChunks).buffer;this._config.onDataReady("text"!==this.mode?l:new TextDecoder("utf-8").decode(l)),this._config.onStatsReady(this._getNetworkStats()),this.realUrl!==this.requestUrl&&this._config.onRedirectDetected(this.requestUrl,this.realUrl),this._config.onChangeState(a.LOADED,{realUrl:n.url,status:n.status})}catch(e){if(this._isAborted)return this._config.onStatsReady(this._getNetworkStats()),void this._config.onChangeState(a.ABORTED);this.error||(this.error={status:-1,statusText:e.toString()}),this._config.onError(this.error),this._config.onChangeState(a.ERROR,{status:this.error.status})}}_getNetworkStats(){const e=Date.now()-this._startLoadTimestamp,t="text"===this.mode?"text":"binary";return s(this.requestUrl,e,this._receivedLength,t)}}const n=new Map;self.addEventListener("message",(({data:t})=>{if(t.type)switch(t.type){case e.ABORT:{const e=n.get(t.payload.url);e&&e.abort();break}case e.DESTROY:{const e=n.get(t.payload.url);e&&e.abort(),n.delete(t.payload.url);break}case e.FETCH:{const r=new $23b27e332a61b135$export$df6d58d46cb3f0ea({requestCustomReferer:t.payload.requestCustomReferer,onDataReady:r=>{self.postMessage({type:e.DATA_READY,payload:{binaryData:r,url:t.payload.url}})},onChangeState:(r,a)=>{self.postMessage({type:e.CHANGE_STATE,payload:{newState:r,url:t.payload.url,metadata:a}})},onStatsReady:r=>{self.postMessage({type:e.STATS_READY,payload:{stats:r,url:t.payload.url}})},onError:r=>{self.postMessage({type:e.ERROR,payload:{error:r,url:t.payload.url}})},onRedirectDetected:(t,r)=>{self.postMessage({type:e.REDIRECT_DETECTED,payload:{url:t,responseUrl:r}})}});r.fetch(t.payload.url,t.payload.mode),n.set(t.payload.url,r);break}}}));')}`],{type:"application/javascript"}))),rZ.set(e,r)),r||null},r0=async e=>{let t=await rJ(e);t&&t.terminate(),rZ.delete(e)};class r1{data=null;error=null;stats=null;realUrl="";_state=p.UNKNOWN;_retriesAmount=0;_timeoutAbortHandler=null;_retryTimeoutHandler=null;_fetcherWorker=null;_fetcherSimple=null;_workerMode=!1;constructor(e,t){if(this._eventBus=t,this._logger=e$(this._eventBus,"Doppio - NetworkLoader"),!e.url||!e.onStateChanged)throw Error("Invalid config");this._workerMode=!!e.workerMode,this._config=e,this._logger.debug("Created with config",e),this._recreateFetcherAndAutoload()}startLoad(){return this._state===p.UNKNOWN&&(this._armTimeoutAbort(),this._logger.debug(`Starting load ${this._config.url}`),this._startAsyncLoad(),!0)}cancel(e){this._disarmTimeoutAbort(),this._disarmRetryTimeout(),this.error={status:-1,statusText:`Cancelled because of ${e??"unknown reason"}`},rX.includes(this._state)||(this._logger.warn(`${this._config.url} loading was cancelled with reason ${e}, current status is ${this._state}`),this._workerMode?this._fetcherWorker?.postMessage({type:m.ABORT,payload:{url:this._config.url}}):this._fetcherSimple?.abort())}destroy(){rX.includes(this._state)||(this.cancel("Destroyed"),this._state=p.DESTROYED),this._disarmTimeoutAbort(),this._disarmRetryTimeout(),this.data=null,this.error=null,this._removeFetcherFromWorker()}_onAbortTimeoutFired(){this._logger.info(`${this._config.url} loading timeout`),this.cancel("Loading timeout")}_armRetryTimeout(){this._logger.info(`Retry loading ${this._retriesAmount} time`),this._disarmRetryTimeout(),this._setNewState(p.UNKNOWN),this._retriesAmount++,this._retryTimeoutHandler=globalThis.setTimeout(()=>{this.startLoad()},2**this._retriesAmount)}_disarmRetryTimeout(){this._retryTimeoutHandler&&globalThis.clearTimeout(this._retryTimeoutHandler)}_armTimeoutAbort(){!this._config.loadingTimeout||this._config.loadingTimeout<=0?this._logger.debug("LoadingTimeout is not defined or below zero! Skipping abort timeout arming"):(this._logger.debug("Arming loading abort timeout"),this._timeoutAbortHandler&&(this._logger.debug("Another timeout already armed. Cancel it"),this._disarmTimeoutAbort()),this._timeoutAbortHandler=setTimeout(()=>{this._onAbortTimeoutFired()},this._config.loadingTimeout))}_disarmTimeoutAbort(){this._timeoutAbortHandler&&(this._logger.debug("Disarming abort timeout"),clearTimeout(this._timeoutAbortHandler))}_setNewState(e,t){this._state!==e&&(e===p.LOADED&&this._logger.verbose(`${this._config.url} loading finished`),rX.includes(e)&&(this._eventBus.publish(rt.events.networkRequestSettled,{response:{url:this.url,body:this.data,timestamp:performance.now(),...t||{}}}),this._removeFetcherFromWorker(),this._disarmTimeoutAbort()),this._logger.verbose(`Loading ${this._config.url}, state transition: ${this._state} -> ${e}`),[p.ABORTED,p.ERROR].includes(e)&&this._state!==p.DESTROYED&&this._config.maxRetries&&this._config.baseRetryTimeout&&this._retriesAmount<this._config.maxRetries?this._armRetryTimeout():(this._config.onStateChanged(this._state,e,this),this._state=e))}_removeFetcherFromWorker(){this._fetcherWorker?.removeEventListener("message",this._handleWorkerMessage),this._fetcherWorker?.postMessage({type:m.DESTROY,payload:{url:this._config.url}})}async _startAsyncLoad(){if(this._workerMode){let e={type:m.FETCH,payload:{url:this._config.url,mode:this._config.mode,requestCustomReferer:this._config.requestCustomReferer}};this._fetcherWorker?.postMessage(e)}else this._fetcherSimple?.fetch(this._config.url,this._config.mode)}async _recreateFetcherAndAutoload(){if(this._fetcherSimple?.abort(),this._fetcherWorker?.postMessage({type:m.DESTROY,payload:{url:this._config.url}}),this._workerMode)try{this._fetcherWorker=await rJ(this._eventBus.getAppId(),!0),this._fetcherWorker?.addEventListener("message",this._handleWorkerMessage)}catch(e){return this._logger.warn("Could not use worker for network request. Fallback to simple mode",{error:e}),this._workerMode=!1,void this._recreateFetcherAndAutoload()}else this._fetcherSimple=new rz({requestCustomReferer:this._config.requestCustomReferer,onDataReady:this._handleDataReady,onChangeState:this._setNewState,onStatsReady:this._handleLoadStatsReady,onError:this._handleError,onRedirectDetected:this._handleRedirectDetected});this._config.autoLoad&&(this._logger.debug("AutoLoad config field set to true. Starting load"),globalThis.queueMicrotask(()=>{this.startLoad()}))}_handleDataReady(e){this.data=e}_handleLoadStatsReady(e){this.stats=e,this._eventBus.publish(rt.stats.statsReady,e)}_handleError(e){this.error=e,this._logger.warn(`Cannot load ${this._config.url}`,e)}_handleRedirectDetected(e,t){this._eventBus.publish(rt.events.browserRedirectDetected,{requestUrl:e,responseUrl:t})}_handleWorkerMessage({data:e}){if(e.payload.url===this._config.url&&e.type)switch(e.type){case m.DATA_READY:this._handleDataReady(e.payload.binaryData);break;case m.CHANGE_STATE:this._setNewState(e.payload.newState,e.payload.metadata);break;case m.STATS_READY:this._handleLoadStatsReady(e.payload.stats);break;case m.ERROR:this._handleError(e.payload.error);break;case m.REDIRECT_DETECTED:this._handleRedirectDetected(e.payload.url,e.payload.responseUrl)}}get url(){return this._config.url}}(0,er.__decorate)([t1.default],r1.prototype,"_setNewState",null),(0,er.__decorate)([t1.default],r1.prototype,"_handleDataReady",null),(0,er.__decorate)([t1.default],r1.prototype,"_handleLoadStatsReady",null),(0,er.__decorate)([t1.default],r1.prototype,"_handleError",null),(0,er.__decorate)([t1.default],r1.prototype,"_handleRedirectDetected",null),(0,er.__decorate)([t1.default],r1.prototype,"_handleWorkerMessage",null),t1=et("eQOGK");class r2 extends tJ{state=n.OK;status="Idle";groups=["loader"];additionalInfo={loadingFragments:{}};_lastRequestedFragments=[];_pendingFragments=[];_loaders=[];constructor(e){super("fragmentLoader",e),this._logger=e$(this._eventBus,"Doppio - FragmentLoader"),this._fragmentsDetectedSubscription=this._eventBus.subscribe(t0.fragments.fragmentsDetected,this._onFragmentsDetected),this._fragmentAddedToBufferSubscription=this._eventBus.subscribe(t3.fragmentAdded,this._onFragmentAddedToBuffer),this._fragmentHistoryReadyToPrintSubscription=this._eventBus.subscribe(rS.fragments.fragmentHistoryReadyForPrint,this._onFragmentHistoryReadyToPrint),this._logger.info("Instance created")}destroy(){super.destroy(),this._loaders.forEach(e=>{e.destroy()}),this._eventBus.unsubscribe(this._fragmentsDetectedSubscription),this._eventBus.unsubscribe(this._fragmentAddedToBufferSubscription),this._eventBus.unsubscribe(this._fragmentHistoryReadyToPrintSubscription),this._logger.info("Destroyed")}_handleConfigUpdated(){}_onFragmentsDetected(e){this.status="Handling new fragments",this._logger.debug("Fragments was requested to load",e.map(e=>e.getMsnPn()));let t=e.filter(e=>!this._lastRequestedFragments.find(t=>t.url===e.url));this._logger.verbose("Actual fragments is",t.map(e=>e.getMsnPn())),this._pendingFragments=this._pendingFragments.concat(t),t.forEach(e=>{this._eventBus.publish(rS.fragments.fragmentLoadingStarted,e),this.additionalInfo.loadingFragments.url=p.UNKNOWN,this._addFragmentToQueue(e.url,e.requestedLoadingTimeout,e)}),this._lastRequestedFragments=e}_onFragmentAddedToBuffer(e){e.goToLifecycleStage("addedToBuffer")}_onFragmentLoadAborted(e){e.goToLifecycleStage("loadDataAborted")}_onFragmentHistoryReadyToPrint(e){this._logger.info(e.historyString)}_addFragmentToQueue(e,t=this.config?.fragmentLoadingTimeout,r){this._logger.verbose(`Requesting ${e} to load; Fragment ${r.getMsnPn()}`),r.goToLifecycleStage("loadDataStart");let i=new r1({url:e,autoLoad:!0,mode:"arrayBuffer",onStateChanged:this._onLoaderStateChanged,loadingTimeout:t,workerMode:this.config.workerMode},this._eventBus);this._loaders.push(i)}_onLoaderStateChanged(e,t,r){if(this.additionalInfo.loadingFragments[r.url]=t,![p.LOADED,p.ERROR,p.ABORTED].includes(t))return;this._logger.verbose(`Loader state changed: ${e} -> ${t}`);let i=this._pendingFragments.find(e=>e.url===r.url);i&&(i.stats=r.stats,i.data=r.data),i?(r.error&&(i.error=r.error),t===p.LOADED&&(this._logger.debug(`${r.url} fragment downloaded (${i.getMsnPn()})`),i.goToLifecycleStage("loadDataEnd"),delete this.additionalInfo.loadingFragments[r.url],this._eventBus.publish(rS.fragments.fragmentLoaded,i)),t===p.ERROR&&(this._lastRequestedFragments=this._lastRequestedFragments.filter(e=>e.url!==r.url),this._logger.debug(`${r.url} fragment loading error (${i.getMsnPn()})`),this._onFragmentLoadAborted(i),this._eventBus.publish(rS.fragments.fragmentLoadingError,i)),t===p.ABORTED&&(this._lastRequestedFragments=this._lastRequestedFragments.filter(e=>e.url!==r.url),this._logger.debug(`${r.url} fragment loading aborted (${i.getMsnPn()})`),this._onFragmentLoadAborted(i),this._eventBus.publish(rS.fragments.fragmentLoadingError,i)),this._pendingFragments=this._pendingFragments.filter(e=>e!==i),this._loaders=this._loaders.filter(e=>e!==r),this.status=this._loaders.length?"Loading fragments":"Idle"):this._logger.warn("Downloaded fragment was not even planned. Ignoring it",{url:r.url})}}(0,er.__decorate)([t1.default],r2.prototype,"_handleConfigUpdated",null),(0,er.__decorate)([t1.default],r2.prototype,"_onFragmentsDetected",null),(0,er.__decorate)([t1.default],r2.prototype,"_onFragmentAddedToBuffer",null),(0,er.__decorate)([t1.default],r2.prototype,"_onFragmentLoadAborted",null),(0,er.__decorate)([t1.default],r2.prototype,"_onFragmentHistoryReadyToPrint",null),(0,er.__decorate)([t1.default],r2.prototype,"_onLoaderStateChanged",null),et("8NFq9"),er=et("a8VW4"),et("8NFq9"),er=et("a8VW4");let r3=e=>{try{return!!new URL(e).origin}catch(e){return!1}};t1=et("eQOGK");class r8{_logger=null;_shouldLogHistory=!1;_history=[];_hasLifecycleEnded=!1;_isStuckTimer=null;_lastTs=Date.now();constructor(e,t,r){Object.assign(this,e),this._eventBus=t,this._shouldLogHistory=r||!1,this._eventBus&&(this._logger=e$(this._eventBus,"Doppio - Fragment")),this.duration=e.duration,this.msn=e.msn,this.pn=e.pn,e.playlistUrl||e.fragmentUrl?this.url=r8._buildUrl(e.playlistUrl,e.fragmentUrl):this.url=e.url,this._logger?.verbose(`Fragment ${this.getMsnPn()} created`),this.goToLifecycleStage("created")}getMsnPn(){return`${this.msn}/${this.pn||0}`}goToLifecycleStage(e){if(this._clearStuckTimer(),!this._shouldLogHistory||this._hasLifecycleEnded)return;let t=Date.now();this._history.push({event:e,timeSincePreviousEvent:t-this._lastTs}),this._lastTs=t,this._logger?.debug(`Fragment ${this.getMsnPn()} lifecycle updated: ${e}`),"loadDataAborted"===e?(this._hasLifecycleEnded=!0,this._publishHistoryReadyForPrint("Fragments lifecycle: ABORTED")):"addedToBuffer"===e?(this._hasLifecycleEnded=!0,this._publishHistoryReadyForPrint("Fragments lifecycle: SUCCESS")):this._isStuckTimer=setTimeout(this._handleFragmentStuck,3e3)}static _buildUrl(e,t){if(r3(t))return t;let r=new URL(e);if(t.startsWith("/"))return`${r.origin}${t}`;let i=r.pathname.split("/");return i.pop()||i.pop(),`${r.origin}/${i.concat(t).join("/")}`}_handleFragmentStuck(){this._publishHistoryReadyForPrint("Fragments lifecycle: STUCK")}_publishHistoryReadyForPrint(e){this._eventBus?.publish(rS.fragments.fragmentHistoryReadyForPrint,{historyString:`${e} ${this.getMsnPn()}:${this._history.map(e=>`Event: ${e.event}, ${e.timeSincePreviousEvent}ms since previous event`).join("\n")}`})}_clearStuckTimer(){this._isStuckTimer&&clearTimeout(this._isStuckTimer)}}(0,er.__decorate)([t1.default],r8.prototype,"_handleFragmentStuck",null),et("8NFq9"),er=et("a8VW4");var r4={},r9={};function r6(e,t){return(r9=r6=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e}).__esModule=!0,r9.default=r9,r6(e,t)}(r9=r6).__esModule=!0,r9.default=r9,(r4=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r9(e,t)}).__esModule=!0,r4.default=r4;var r5=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var r=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(r,1),r>-1},t.trigger=function(e){var t=this.listeners[e];if(t){if(2==arguments.length)for(var r=t.length,i=0;i<r;++i)t[i].call(this,arguments[1]);else for(var n=Array.prototype.slice.call(arguments,1),s=t.length,a=0;a<s;++a)t[a].apply(this,n)}},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",function(t){e.push(t)})},e}(),r7={};function ie(){return(r7=ie=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)({}).hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).__esModule=!0,r7.default=r7,ie.apply(null,arguments)}(r7=ie).__esModule=!0,r7.default=r7;var it={};(it=function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}).__esModule=!0,it.default=it,Y="undefined"!=typeof window?window:void 0!==X?X:"undefined"!=typeof self?self:{};var ir=function(e){function t(){var t;return(t=e.call(this)||this).buffer="",t}return Z(r4)(t,e),t.prototype.push=function(e){var t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)},t}(r5),ii=function(e){var t=/([0-9.]*)?@?([0-9.]*)?/.exec(e||""),r={};return t[1]&&(r.length=parseInt(t[1],10)),t[2]&&(r.offset=parseInt(t[2],10)),r},is=function(e){for(var t,r=e.split(RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),i={},n=r.length;n--;)""!==r[n]&&((t=/([^=]*)=(.*)/.exec(r[n]).slice(1))[0]=t[0].replace(/^\s+|\s+$/g,""),t[1]=t[1].replace(/^\s+|\s+$/g,""),t[1]=t[1].replace(/^['"](.*)['"]$/g,"$1"),i[t[0]]=t[1]);return i},ia=function(e){function t(){var t;return(t=e.call(this)||this).customParsers=[],t.tagMappers=[],t}Z(r4)(t,e);var r=t.prototype;return r.push=function(e){var t,r,i=this;0!==(e=e.trim()).length&&("#"===e[0]?this.tagMappers.reduce(function(t,r){var i=r(e);return i===e?t:t.concat([i])},[e]).forEach(function(e){for(var n=0;n<i.customParsers.length;n++)if(i.customParsers[n].call(i,e))return;if(0===e.indexOf("#EXT")){if(e=e.replace("\r",""),t=/^#EXTM3U/.exec(e))i.trigger("data",{type:"tag",tagType:"m3u"});else{if(t=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(e))return r={type:"tag",tagType:"inf"},t[1]&&(r.duration=parseFloat(t[1])),t[2]&&(r.title=t[2]),void i.trigger("data",r);if(t=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(e))return r={type:"tag",tagType:"targetduration"},t[1]&&(r.duration=parseInt(t[1],10)),void i.trigger("data",r);if(t=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(e))return r={type:"tag",tagType:"version"},t[1]&&(r.version=parseInt(t[1],10)),void i.trigger("data",r);if(t=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(e))return r={type:"tag",tagType:"media-sequence"},t[1]&&(r.number=parseInt(t[1],10)),void i.trigger("data",r);if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(e))return r={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(r.number=parseInt(t[1],10)),void i.trigger("data",r);if(t=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(e))return r={type:"tag",tagType:"playlist-type"},t[1]&&(r.playlistType=t[1]),void i.trigger("data",r);if(t=/^#EXT-X-BYTERANGE:?(.*)?$/.exec(e))return r=Z(r7)(ii(t[1]),{type:"tag",tagType:"byterange"}),void i.trigger("data",r);if(t=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(e))return r={type:"tag",tagType:"allow-cache"},t[1]&&(r.allowed=!/NO/.test(t[1])),void i.trigger("data",r);if(t=/^#EXT-X-MAP:?(.*)$/.exec(e)){if(r={type:"tag",tagType:"map"},t[1]){var s=is(t[1]);s.URI&&(r.uri=s.URI),s.BYTERANGE&&(r.byterange=ii(s.BYTERANGE))}i.trigger("data",r)}else if(t=/^#EXT-X-STREAM-INF:?(.*)$/.exec(e)){if(r={type:"tag",tagType:"stream-inf"},t[1]){if(r.attributes=is(t[1]),r.attributes.RESOLUTION){var a=r.attributes.RESOLUTION.split("x"),o={};a[0]&&(o.width=parseInt(a[0],10)),a[1]&&(o.height=parseInt(a[1],10)),r.attributes.RESOLUTION=o}r.attributes.BANDWIDTH&&(r.attributes.BANDWIDTH=parseInt(r.attributes.BANDWIDTH,10)),r.attributes["PROGRAM-ID"]&&(r.attributes["PROGRAM-ID"]=parseInt(r.attributes["PROGRAM-ID"],10))}i.trigger("data",r)}else{if(t=/^#EXT-X-MEDIA:?(.*)$/.exec(e))return r={type:"tag",tagType:"media"},t[1]&&(r.attributes=is(t[1])),void i.trigger("data",r);if(t=/^#EXT-X-ENDLIST/.exec(e))i.trigger("data",{type:"tag",tagType:"endlist"});else if(t=/^#EXT-X-DISCONTINUITY/.exec(e))i.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(t=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(e))return r={type:"tag",tagType:"program-date-time"},t[1]&&(r.dateTimeString=t[1],r.dateTimeObject=new Date(t[1])),void i.trigger("data",r);if(t=/^#EXT-X-KEY:?(.*)$/.exec(e))return r={type:"tag",tagType:"key"},t[1]&&(r.attributes=is(t[1]),r.attributes.IV&&("0x"===r.attributes.IV.substring(0,2).toLowerCase()&&(r.attributes.IV=r.attributes.IV.substring(2)),r.attributes.IV=r.attributes.IV.match(/.{8}/g),r.attributes.IV[0]=parseInt(r.attributes.IV[0],16),r.attributes.IV[1]=parseInt(r.attributes.IV[1],16),r.attributes.IV[2]=parseInt(r.attributes.IV[2],16),r.attributes.IV[3]=parseInt(r.attributes.IV[3],16),r.attributes.IV=new Uint32Array(r.attributes.IV))),void i.trigger("data",r);if(t=/^#EXT-X-START:?(.*)$/.exec(e))return r={type:"tag",tagType:"start"},t[1]&&(r.attributes=is(t[1]),r.attributes["TIME-OFFSET"]=parseFloat(r.attributes["TIME-OFFSET"]),r.attributes.PRECISE=/YES/.test(r.attributes.PRECISE)),void i.trigger("data",r);if(t=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(e))return r={type:"tag",tagType:"cue-out-cont"},t[1]?r.data=t[1]:r.data="",void i.trigger("data",r);if(t=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(e))return r={type:"tag",tagType:"cue-out"},t[1]?r.data=t[1]:r.data="",void i.trigger("data",r);if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(e))return r={type:"tag",tagType:"cue-in"},t[1]?r.data=t[1]:r.data="",void i.trigger("data",r);if((t=/^#EXT-X-SKIP:(.*)$/.exec(e))&&t[1])return(r={type:"tag",tagType:"skip"}).attributes=is(t[1]),r.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(r.attributes["SKIPPED-SEGMENTS"]=parseInt(r.attributes["SKIPPED-SEGMENTS"],10)),r.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(r.attributes["RECENTLY-REMOVED-DATERANGES"]=r.attributes["RECENTLY-REMOVED-DATERANGES"].split("	")),void i.trigger("data",r);if((t=/^#EXT-X-PART:(.*)$/.exec(e))&&t[1])return(r={type:"tag",tagType:"part"}).attributes=is(t[1]),["DURATION"].forEach(function(e){r.attributes.hasOwnProperty(e)&&(r.attributes[e]=parseFloat(r.attributes[e]))}),["INDEPENDENT","GAP"].forEach(function(e){r.attributes.hasOwnProperty(e)&&(r.attributes[e]=/YES/.test(r.attributes[e]))}),r.attributes.hasOwnProperty("BYTERANGE")&&(r.attributes.byterange=ii(r.attributes.BYTERANGE)),void i.trigger("data",r);if((t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(e))&&t[1])return(r={type:"tag",tagType:"server-control"}).attributes=is(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(e){r.attributes.hasOwnProperty(e)&&(r.attributes[e]=parseFloat(r.attributes[e]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(e){r.attributes.hasOwnProperty(e)&&(r.attributes[e]=/YES/.test(r.attributes[e]))}),void i.trigger("data",r);if((t=/^#EXT-X-PART-INF:(.*)$/.exec(e))&&t[1])return(r={type:"tag",tagType:"part-inf"}).attributes=is(t[1]),["PART-TARGET"].forEach(function(e){r.attributes.hasOwnProperty(e)&&(r.attributes[e]=parseFloat(r.attributes[e]))}),void i.trigger("data",r);if((t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(e))&&t[1])return(r={type:"tag",tagType:"preload-hint"}).attributes=is(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(e){if(r.attributes.hasOwnProperty(e)){r.attributes[e]=parseInt(r.attributes[e],10);var t="BYTERANGE-LENGTH"===e?"length":"offset";r.attributes.byterange=r.attributes.byterange||{},r.attributes.byterange[t]=r.attributes[e],delete r.attributes[e]}}),void i.trigger("data",r);if((t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(e))&&t[1])return(r={type:"tag",tagType:"rendition-report"}).attributes=is(t[1]),["LAST-MSN","LAST-PART"].forEach(function(e){r.attributes.hasOwnProperty(e)&&(r.attributes[e]=parseInt(r.attributes[e],10))}),void i.trigger("data",r);i.trigger("data",{type:"tag",data:e.slice(4)})}}}}else i.trigger("data",{type:"comment",text:e.slice(1)})}):this.trigger("data",{type:"uri",uri:e}))},r.addParser=function(e){var t=this,r=e.expression,i=e.customType,n=e.dataParser,s=e.segment;"function"!=typeof n&&(n=function(e){return e}),this.customParsers.push(function(e){if(r.exec(e))return t.trigger("data",{type:"custom",data:n(e),customType:i,segment:s}),!0})},r.addTagMapper=function(e){var t=e.expression,r=e.map;this.tagMappers.push(function(e){return t.test(e)?r(e):e})},t}(r5),io=function(e){var t={};return Object.keys(e).forEach(function(r){t[r.toLowerCase().replace(/-(\w)/g,function(e){return e[1].toUpperCase()})]=e[r]}),t},il=function(e){var t=e.serverControl,r=e.targetDuration,i=e.partTargetDuration;if(t){var n="#EXT-X-SERVER-CONTROL",s="holdBack",a="partHoldBack",o=r&&3*r,l=i&&2*i;r&&!t.hasOwnProperty(s)&&(t[s]=o,this.trigger("info",{message:n+" defaulting HOLD-BACK to targetDuration * 3 ("+o+")."})),o&&t[s]<o&&(this.trigger("warn",{message:n+" clamping HOLD-BACK ("+t[s]+") to targetDuration * 3 ("+o+")"}),t[s]=o),i&&!t.hasOwnProperty(a)&&(t[a]=3*i,this.trigger("info",{message:n+" defaulting PART-HOLD-BACK to partTargetDuration * 3 ("+t[a]+")."})),i&&t[a]<l&&(this.trigger("warn",{message:n+" clamping PART-HOLD-BACK ("+t[a]+") to partTargetDuration * 2 ("+l+")."}),t[a]=l)}},iu=function(t){function r(){(r=t.call(this)||this).lineStream=new ir,r.parseStream=new ia,r.lineStream.pipe(r.parseStream);var r,i,n,s=Z(it)(r),a=[],o={},l=!1,u=function(){},d={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},c=0;r.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};var h=0,f=0;return r.on("end",function(){!o.uri&&(o.parts||o.preloadHints)&&(!o.map&&i&&(o.map=i),!o.key&&n&&(o.key=n),o.timeline||"number"!=typeof c||(o.timeline=c),r.manifest.preloadSegment=o)}),r.parseStream.on("data",function(t){var r,_;({tag:function(){(({version:function(){t.version&&(this.manifest.version=t.version)},"allow-cache":function(){this.manifest.allowCache=t.allowed,"allowed"in t||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var e={};"length"in t&&(o.byterange=e,e.length=t.length,"offset"in t||(t.offset=h)),"offset"in t&&(o.byterange=e,e.offset=t.offset),h=e.offset+e.length},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),t.duration>0&&(o.duration=t.duration),0===t.duration&&(o.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=a},key:function(){if(t.attributes){if("NONE"!==t.attributes.METHOD){if(t.attributes.URI){if("com.apple.streamingkeydelivery"===t.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:t.attributes});if("com.microsoft.playready"===t.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.microsoft.playready"]={uri:t.attributes.URI});if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===t.attributes.KEYFORMAT)return -1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(t.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===t.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==t.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):t.attributes.KEYID&&"0x"===t.attributes.KEYID.substring(0,2)?(this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:t.attributes.KEYFORMAT,keyId:t.attributes.KEYID.substring(2)},pssh:function(t){for(var r=Z(Y).atob?Z(Y).atob(t):(0,e.Buffer).from(t,"base64").toString("binary"),i=new Uint8Array(r.length),n=0;n<r.length;n++)i[n]=r.charCodeAt(n);return i}(t.attributes.URI.split(",")[1])})):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}));t.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),n={method:t.attributes.METHOD||"AES-128",uri:t.attributes.URI},void 0!==t.attributes.IV&&(n.iv=t.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"})}else n=null}else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(t.number)?this.manifest.mediaSequence=t.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+t.number})},"discontinuity-sequence":function(){isFinite(t.number)?(this.manifest.discontinuitySequence=t.number,c=t.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+t.number})},"playlist-type":function(){/VOD|EVENT/.test(t.playlistType)?this.manifest.playlistType=t.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+t.playlist})},map:function(){i={},t.uri&&(i.uri=t.uri),t.byterange&&(i.byterange=t.byterange),n&&(i.key=n)},"stream-inf":function(){this.manifest.playlists=a,this.manifest.mediaGroups=this.manifest.mediaGroups||d,t.attributes?(o.attributes||(o.attributes={}),Z(r7)(o.attributes,t.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||d,t.attributes&&t.attributes.TYPE&&t.attributes["GROUP-ID"]&&t.attributes.NAME){var e=this.manifest.mediaGroups[t.attributes.TYPE];e[t.attributes["GROUP-ID"]]=e[t.attributes["GROUP-ID"]]||{},r=e[t.attributes["GROUP-ID"]],(_={default:/yes/i.test(t.attributes.DEFAULT)}).default?_.autoselect=!0:_.autoselect=/yes/i.test(t.attributes.AUTOSELECT),t.attributes.LANGUAGE&&(_.language=t.attributes.LANGUAGE),t.attributes.URI&&(_.uri=t.attributes.URI),t.attributes["INSTREAM-ID"]&&(_.instreamId=t.attributes["INSTREAM-ID"]),t.attributes.CHARACTERISTICS&&(_.characteristics=t.attributes.CHARACTERISTICS),t.attributes.FORCED&&(_.forced=/yes/i.test(t.attributes.FORCED)),r[t.attributes.NAME]=_}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){c+=1,o.discontinuity=!0,this.manifest.discontinuityStarts.push(a.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=t.dateTimeString,this.manifest.dateTimeObject=t.dateTimeObject),o.dateTimeString=t.dateTimeString,o.dateTimeObject=t.dateTimeObject},targetduration:function(){!isFinite(t.duration)||t.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+t.duration}):(this.manifest.targetDuration=t.duration,il.call(this,this.manifest))},start:function(){t.attributes&&!isNaN(t.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:t.attributes["TIME-OFFSET"],precise:t.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){o.cueOut=t.data},"cue-out-cont":function(){o.cueOutCont=t.data},"cue-in":function(){o.cueIn=t.data},skip:function(){this.manifest.skip=io(t.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",t.attributes,["SKIPPED-SEGMENTS"])},part:function(){var e=this;l=!0;var r=this.manifest.segments.length,i=io(t.attributes);o.parts=o.parts||[],o.parts.push(i),i.byterange&&(i.byterange.hasOwnProperty("offset")||(i.byterange.offset=f),f=i.byterange.offset+i.byterange.length);var n=o.parts.length-1;this.warnOnMissingAttributes_("#EXT-X-PART #"+n+" for segment #"+r,t.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach(function(t,r){t.hasOwnProperty("lastPart")||e.trigger("warn",{message:"#EXT-X-RENDITION-REPORT #"+r+" lacks required attribute(s): LAST-PART"})})},"server-control":function(){var e=this.manifest.serverControl=io(t.attributes);e.hasOwnProperty("canBlockReload")||(e.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),il.call(this,this.manifest),e.canSkipDateranges&&!e.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint":function(){var e=this.manifest.segments.length,r=io(t.attributes),i=r.type&&"PART"===r.type;o.preloadHints=o.preloadHints||[],o.preloadHints.push(r),r.byterange&&(r.byterange.hasOwnProperty("offset")||(r.byterange.offset=i?f:0,i&&(f=r.byterange.offset+r.byterange.length)));var n=o.preloadHints.length-1;if(this.warnOnMissingAttributes_("#EXT-X-PRELOAD-HINT #"+n+" for segment #"+e,t.attributes,["TYPE","URI"]),r.type)for(var s=0;s<o.preloadHints.length-1;s++){var a=o.preloadHints[s];a.type&&a.type===r.type&&this.trigger("warn",{message:"#EXT-X-PRELOAD-HINT #"+n+" for segment #"+e+" has the same TYPE "+r.type+" as preload hint #"+s})}},"rendition-report":function(){var e=io(t.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(e);var r=this.manifest.renditionReports.length-1,i=["LAST-MSN","URI"];l&&i.push("LAST-PART"),this.warnOnMissingAttributes_("#EXT-X-RENDITION-REPORT #"+r,t.attributes,i)},"part-inf":function(){this.manifest.partInf=io(t.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",t.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),il.call(this,this.manifest)}})[t.tagType]||u).call(s)},uri:function(){o.uri=t.uri,a.push(o),!this.manifest.targetDuration||"duration"in o||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),o.duration=this.manifest.targetDuration),n&&(o.key=n),o.timeline=c,i&&(o.map=i),f=0,o={}},comment:function(){},custom:function(){t.segment?(o.custom=o.custom||{},o.custom[t.customType]=t.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[t.customType]=t.data)}})[t.type].call(s)}),r}Z(r4)(r,t);var i=r.prototype;return i.warnOnMissingAttributes_=function(e,t,r){var i=[];r.forEach(function(e){t.hasOwnProperty(e)||i.push(e)}),i.length&&this.trigger("warn",{message:e+" lacks required attribute(s): "+i.join(", ")})},i.push=function(e){this.lineStream.push(e)},i.end=function(){this.lineStream.push("\n"),this.trigger("end")},i.addParser=function(e){this.parseStream.addParser(e)},i.addTagMapper=function(e){this.parseStream.addTagMapper(e)},r}(r5);let id=String.fromCharCode(...new Uint8Array([8,44,150,143,119,94,73,180,141,85,164,41,236,217,137,213])),ic=e=>{let[t,r]=e.split(";"),i=Uint8Array.from(atob(r),e=>e.charCodeAt(0));if(String.fromCharCode(...i.slice(0,16))!==id)return[];let n=i.slice(16,24),s=0;for(let e=n.length-1;e>=0;e--)s+=n[e]*256**e;return t&&s?[Number(t),s]:[]};t1=et("eQOGK");let ih=(e,t)=>e.reduce((e,t)=>(t.startTs=e.prevStart,t.endTs=t.startTs+t.duration,e.prevStart=t.endTs,e.parts.push(t),e),{parts:[],prevStart:t}).parts,i_=(e,t={})=>{let r=e.mediaSequence,i=e.segments.map((e,t)=>({...e,uri:e.uri,msnNumber:r+t,partNumber:0,parts:(e?.parts||[]).map((e,i)=>({...e,msnNumber:r+t,partNumber:i}))})).map(e=>(e.parts=e.dateTimeObject?ih(e.parts,e.dateTimeObject.getTime()/1e3):e.parts,e)),n=r+i.length,s=(e.preloadSegment?.parts||[]).map((e,t)=>({...e,msnNumber:n,partNumber:t})),a=(e.preloadSegment?.preloadHints||[]).map((e,t)=>({...e,msnNumber:n,partNumber:t+s.length})),o=i.slice(-1)[0],l={...e.preloadSegment,parts:e.preloadSegment&&o.dateTimeObject?ih(s,o.dateTimeObject.getTime()/1e3+o.duration):s,preloadHints:a,msnNumber:n,partNumber:0},u={...e,segments:i,preloadSegment:l};return t.partHoldBack&&(u.partHoldBack=t.partHoldBack),u};class ig extends tJ{_lastPlaylistContent="";_samePlaylistsCount=0;_isActive=!0;_currentPlaylistLoader=null;_url=null;constructor(e,t,r){super(t,r),this._logger=e$(r,`Doppio - ${e}`),this._lifecycleEventReporter=rf("playlistRotator",this._eventBus),this._logger.info("Instance created")}destroy(){super.destroy(),this._isActive=!1,this._logger.info("Destroyed")}_onPlaylistLoadingStateChanged(e,t){if(!this._isActive)return void this._logger.warn("Loader was destroyed, but we are trying to load handle playlist load state change!");if(!this._currentPlaylistLoader||[p.ABORTED,p.ERROR].includes(t))return this._lifecycleEventReporter(`Loading error reported, ${this._currentPlaylistLoader?.error}`),this._logger.warn(`Playlist loader reported ${t===p.ERROR?"error":"as aborted"} (${this._currentPlaylistLoader?.error?.statusText||"no error"} with status ${this._currentPlaylistLoader?.error?.statusText||"no status"}). Planning next load`),this._eventBus.publish(t0.playlists.playlistLoadingError,{error:this._currentPlaylistLoader?.error}),t===p.ERROR&&"4"===this._currentPlaylistLoader?.error?.status.toString()[0]&&(this._logger.warn("Playlist loading reported 4xx status. Requesting start over"),this._eventBus.publish(t8.requestRestartFromMain,{})),this._currentPlaylistLoader=null,void this._planNextLoad();if(t!==p.LOADED)return;if(!this._isPlaylistValid(this._currentPlaylistLoader.data))return this._logger.warn("Playlist seems to be invalid. Plan next load"),this._currentPlaylistLoader=null,void this._planNextLoad();this._eventBus.publish(t0.playlists.playlistLoaded,{originalUrl:this._url,realUrl:this._currentPlaylistLoader.realUrl,stats:this._currentPlaylistLoader.stats});let r=this._currentPlaylistLoader.data,i=this._isPlaylistChanged(r);if(this._currentPlaylistLoader=null,!i)return this._logger.warn("Loaded playlist is identical to previous one. Skipping it"),void this._planNextLoad();let n=this._parsePlaylist(r);if(!n)return this._logger.warn("Empty playlist parse result! Should restart"),void this._eventBus.publish(t8.requestRestartFromMain,{});n.custom?.encodeTimestampMap&&this._eventBus.publish(t3.latencyExtraInformationAvailable,n.custom.encodeTimestampMap),this._eventBus.publish(t0.playlists.playlistInfo,n),this._lifecycleEventReporter("Playlist loaded"),this._handleParsedPlaylist(n)}_isPlaylistValid(e){return!!e?.trim().length&&e?.includes("#EXT-X-VERSION")}_isPlaylistChanged(e){return this._lastPlaylistContent!==e}_isPlaylistUpToDate(e){if(void 0!==this.config.equalPlaylistsAmountToDecline&&this.config.equalPlaylistsAmountToDecline<1)return!0;if(e===this._lastPlaylistContent){this._samePlaylistsCount++;let{equalPlaylistsAmountToDecline:e=2}=this.config;if(this._samePlaylistsCount>=e)return!1}else this._samePlaylistsCount=0;return this._lastPlaylistContent=e,!0}_parsePlaylist(e){this._logger.verbose("Parsing manifest");try{let t=new iu;t.addParser({expression:/^#EXT-X-MOUFLON:EXT-REF/,customType:"encodeTimestampMap",dataParser:function(e){return ic(e.replace("#EXT-X-MOUFLON:EXT-REF:",""))}}),t.push(e),t.end();let{manifest:r}=t;this._logger.verbose("Manifest parsed");let i=Array.isArray(r?.playlists)&&r.playlists.length>0,n=Array.isArray(r?.segments)&&r.segments.length>0;return i||n||rK.reportError("Playlist seems to be parsed invalid",{playlistContent:e,playlistUrl:this._url,parsedPlaylistResult:r}),i_(r,{partHoldBack:this.config.partHoldBack?this.config.partHoldBack/1e3:void 0})}catch(t){return rK.reportError("Could not parse playlist",{playlistContent:e,playlistUrl:this._url}),null}}_isMultiVariantPlaylist(e){return e.playlists&&(!e.segments||Array.isArray(e.segments)&&0===e.segments.length)}_isVODPlaylist(e){return"VOD"===e.playlistType||e.endList}_isSimplePlaylist(e){return!this._isLowLatencyPlaylist(e)&&!this._isVODPlaylist(e)}_isLowLatencyPlaylist(e){return!!e.partInf}_handleFragmentsDetected(e){this._logger.verbose("Detected fragments",e.map(e=>e.getMsnPn())),this._logger.debug("Fragments was detected and extracted. Emitting it"),this._lifecycleEventReporter(`Found fragments ${e.map(({url:e})=>e).join(",")}`),this._eventBus.publish(t0.fragments.fragmentsDetected,e)}_handleLLManifestDetected(e){this._logger.debug("Low-latency playlist detected. Emitting it"),this._eventBus.publish(t0.playlistType.llDetected,e)}_handleVODPlaylist(e){this._logger.debug("VOD playlist detected. Emitting it"),this._eventBus.publish(t0.playlistType.vodDetected,e)}_handleMultivariantManifestDetected(e){let t=e.playlists.reduce((e,t)=>(e[t.attributes.NAME]={name:t.attributes.NAME,bitrate:t.attributes.BANDWIDTH,url:t.uri,width:t.attributes.RESOLUTION.width,height:t.attributes.RESOLUTION.height,fps:t.attributes["FRAME-RATE"]},e),{});this._logger.verbose("Variants detected",t),this._logger.debug("Multivariant playlist detected. Emitting it"),this._eventBus.publish(t0.playlistType.multivariantDetected,t)}_handleSimplePlaylistDetected(e){this._logger.debug("Simple playlist detected. Emitting it"),this._eventBus.publish(t0.playlistType.simpleDetected,e)}}(0,er.__decorate)([t1.default],ig.prototype,"_onPlaylistLoadingStateChanged",null),t1=et("eQOGK");class ip extends ig{state=n.OK;status="Idle";additionalInfo={};groups=["loader"];_playlistLoaderTimeout=null;_nextMSN=-1;_nextPN=-1;_partHoldBack=-1;_lastLoadedFragment=null;_awaitingFragmentURL=null;_hasLoadedInitialAmount=!1;constructor(e,t){let{url:r,startManifest:i,initialMSN:n,initialPN:s,lastLoadedFragment:a}=t;super("LLPlaylistRotationController","playlistLoader",e),this._lifecycleEventReporter("Created"),this._url=r,this._lastLoadedFragment=a,i?this._handleParsedPlaylist(i):(this._nextMSN=Number.isFinite(n)?n:-1,this._nextPN=Number.isFinite(s)?s:-1,this._loadNextPlaylist()),this._onSegmentLoadedListener=this._eventBus.subscribe(rS.fragments.fragmentLoaded,this._onFragmentFinished),this._onSegmentFailedListener=this._eventBus.subscribe(rS.fragments.fragmentLoadingError,this._onFragmentFinished),this._onSegmentAbortedListener=this._eventBus.subscribe(rS.fragments.fragmentLoadingAborted,this._onFragmentFinished),this._onFragmentAddedListener=this._eventBus.subscribe(t3.fragmentAdded,this._onFragmentAdded),this.config.targetBufferMultiplier&&this.config.targetBufferMultiplier<1&&this._logger.warn("Target buffer multiplier set to value lower than 1. It is unsafe to load less than target-duration, forcing no multiplier instead")}destroy(){this._isActive=!1,super.destroy(),this._currentPlaylistLoader?.destroy(),this._currentPlaylistLoader=null,this._logger.info("Destroy controller"),this._eventBus.unsubscribe(this._onSegmentLoadedListener),this._eventBus.unsubscribe(this._onSegmentAbortedListener),this._eventBus.unsubscribe(this._onSegmentFailedListener),this._eventBus.unsubscribe(this._onFragmentAddedListener),this._lifecycleEventReporter("Destroyed")}abortCurrentPlaylistLoading(){this._logger.info("Aborting current loading playlist")}setURL(e,t){t?this._url=e:(this._logger.info(`Setting new url ${e}`),this._currentPlaylistLoader?.destroy(),this._url=e,this._nextPN=-1,this._nextMSN=-1,this._loadNextPlaylist())}_handleConfigUpdated(e){if(e.equalPlaylistsAmountToDecline&&(this._samePlaylistsCount=0),!1===e.lowLatencyMode){let e=this._parsePlaylist(this._lastPlaylistContent);e?this._handleSimplePlaylistDetected(e):this._eventBus.publish(t8.requestRestartFromMain,{})}}_loadNextPlaylist(){if(!this._isActive)return void this._logger.warn("Loader was destroying, but we trying to load next playlist!");let{playlistLoadingTimeout:e}=this.config;this._logger.debug("Loading next playlist"),this._lifecycleEventReporter(`Loading next playlist with url ${this._url}`),this.status="Loading playlist",this._currentPlaylistLoader&&this._currentPlaylistLoader.cancel(`Another playlist with url ${this._url} scheduled to load`);let t=this._buildUrl();this._currentPlaylistLoader=new r1({url:t,loadingTimeout:e,autoLoad:!0,mode:"text",onStateChanged:this._onPlaylistLoadingStateChanged,workerMode:this.config.workerMode,requestCustomReferer:this.config.sendCustomRefererHeader?ei().location?.href:void 0},this._eventBus),this._eventBus.publish(t0.playlists.playlistRequested,{})}_handleParsedPlaylist(e){this._lifecycleEventReporter("Playlist parsed");let t=Math.max(this.config.targetBufferMultiplier,1);if(this._partHoldBack=rL(e,e.targetDuration||2)*t,this._isMultiVariantPlaylist(e))return void this._handleMultivariantManifestDetected(e);if(this._isSimplePlaylist(e))return void this._handleSimplePlaylistDetected(e);if(this._isVODPlaylist(e))return void this._handleVODPlaylist(e);let r=0===(e.preloadSegment.parts||[]).length,n=e.segments.flatMap(t=>t.parts.map(({uri:t,independent:r,partNumber:i,startTs:n,endTs:s,msnNumber:a,duration:o})=>new r8({url:t,independent:r?g.INDEPENDENT:g.PART,msn:a,pn:i,duration:o,isTransmuxingBypassRequested:!!e.segments[0].map?.uri,startTs:n,endTs:s},this._eventBus,this.config.shouldLogFragmentsHistory))).concat((e.preloadSegment.parts||[]).map(({uri:t,independent:r=!1,msnNumber:i,partNumber:n,startTs:s,endTs:a,duration:o})=>new r8({url:t,independent:r?g.INDEPENDENT:g.PART,msn:i,pn:n,duration:o,isTransmuxingBypassRequested:!!e.segments[0].map?.uri,startTs:s,endTs:a},this._eventBus,this.config.shouldLogFragmentsHistory))).filter(({msn:e,pn:t})=>!this._hasLoadedInitialAmount||e>this._nextMSN||e===this._nextMSN&&t>=this._nextPN),s=n.reverse(),a=s.reduce((e,t)=>(e.currentDuration<this._partHoldBack&&(e.currentIndex+=1,e.currentDuration+=t.duration),e),{currentDuration:0,currentIndex:-1}).currentIndex,o=this._lastLoadedFragment?s.findIndex(e=>(e.startTs||0)<(this._lastLoadedFragment?.endTs||0)):-1,l=Math.min(s.length,Math.max(a,o)+this.config.additionalStartParts);this._logger.debug(`Minimal part ${s[l]?.msn}:${s[l]?.pn}(${new Date(s[l]?.startTs||0)})`);let u=s.findIndex(({independent:e},t)=>t>=l&&e===g.INDEPENDENT);-1===u&&(u=s.length-1),this._logger.debug(`Part to start load from: ${s[u]?.msn}:${s[u]?.pn}`);let d=u>-1?s.slice(0,u+1).reverse():n;this.config.blockingMode===i.WAIT_FOR_PREFETCH_SEGMENT&&Array.isArray(e.preloadSegment.preloadHints)&&e.preloadSegment.preloadHints.length&&(this._awaitingFragmentURL=e.preloadSegment.preloadHints[0]?.uri||null,d.push(...e.preloadSegment.preloadHints.map(({uri:t,msnNumber:r,partNumber:i})=>new r8({url:t,independent:g.UNKNOWN,msn:r,pn:i,duration:0,isTransmuxingBypassRequested:!!e.segments[0].map?.uri},this._eventBus,this.config.shouldLogFragmentsHistory)))),e.segments[0].map?.uri&&d.unshift(new r8({playlistUrl:this._url||"",fragmentUrl:e.segments[0].map?.uri,duration:0,independent:g.INDEPENDENT,msn:-1,pn:-1,isTransmuxingBypassRequested:!0,isInitSection:!0},this._eventBus,this.config.shouldLogFragmentsHistory)),this._handleFragmentsDetected(d),this._hasLoadedInitialAmount=!0,this._nextMSN=e.mediaSequence+e.segments.length,this._nextPN=(e.preloadSegment.parts||[]).length,this.additionalInfo.msn=this._nextMSN,this.additionalInfo.pn=this._nextPN,this.status="Awaiting fragment to load next playlist",r&&this._eventBus.publish(t0.playlists.lastPlaylistOfSegmentLoaded,{}),this.config.blockingMode!==i.WAIT_FOR_PLAYLIST||this._loadNextPlaylist()}_planNextLoad(){this._playlistLoaderTimeout=ei().setTimeout(()=>{this._loadNextPlaylist()},this.config.retryLowLatencyPlaylistTimeout)}_buildUrl(){if(-1===this._nextPN||-1===this._nextMSN)return this._url||"";if(!this._url)return"";let e=new URL(this._url);return e.searchParams.set("_HLS_msn",`${this._nextMSN}`),e.searchParams.set("_HLS_part",`${this._nextPN}`),e.toString()}_onFragmentFinished(e){this._logger.debug(`${e.startTs} -> ${e.endTs} loaded (${e.getMsnPn()})`),this.config.blockingMode===i.WAIT_FOR_PREFETCH_SEGMENT&&this._awaitingFragmentURL===e.url&&(this._logger.debug("Prefetch segment is ready now, loading next playlist"),this._loadNextPlaylist())}_onFragmentAdded(e){this._lastLoadedFragment=e}}(0,er.__decorate)([t1.default],ip.prototype,"_handleConfigUpdated",null),(0,er.__decorate)([t1.default],ip.prototype,"_onFragmentFinished",null),(0,er.__decorate)([t1.default],ip.prototype,"_onFragmentAdded",null),et("8NFq9"),er=et("a8VW4"),t1=et("eQOGK");class im extends ig{state=n.OK;status="Idle";groups=["loader"];additionalInfo={};_playlistLoaderTimeout=null;_lastTargetDuration=2;constructor(e,t,r){super("SimplePlaylistRotationController","playlistLoader",e),this._lifecycleEventReporter("Created"),this._url=t,r?this._handleParsedPlaylist(r):this._loadNextPlaylist()}destroy(){this._isActive=!1,super.destroy(),this._currentPlaylistLoader?.destroy(),this._currentPlaylistLoader=null,this._logger.info("Destroy controller"),this._playlistLoaderTimeout&&clearTimeout(this._playlistLoaderTimeout),this._lifecycleEventReporter("Destroyed")}abortCurrentPlaylistLoading(){this._logger.info("Aborting current loading playlist"),this._currentPlaylistLoader?.destroy()}setURL(e,t){t?this._url=e:(this._logger.info(`Setting new url ${e}`),this._currentPlaylistLoader?.destroy(),this._url=e,this._loadNextPlaylist())}_handleConfigUpdated(e){e.equalPlaylistsAmountToDecline&&(this._samePlaylistsCount=0)}_loadNextPlaylist(){if(!this._isActive)return void this._logger.warn("Loader was destroying, but we trying to load next playlist!");let{playlistLoadingTimeout:e}=this.config;this._logger.debug("Loading next playlist"),this._lifecycleEventReporter(`Loading next playlist with url ${this._url}`),this.status="Loading playlist",this._currentPlaylistLoader&&this._currentPlaylistLoader.cancel(`Another playlist with url ${this._url} scheduled to load`),this._url&&(this._currentPlaylistLoader=new r1({url:this._url,loadingTimeout:e,autoLoad:!0,mode:"text",onStateChanged:this._onPlaylistLoadingStateChanged,workerMode:this.config.workerMode,requestCustomReferer:this.config.sendCustomRefererHeader?ei().location?.href:void 0},this._eventBus),this._eventBus.publish(t0.playlists.playlistRequested,{}))}_handleParsedPlaylist(e){if(this._lifecycleEventReporter("Playlist parsed"),this._isMultiVariantPlaylist(e))return void this._handleMultivariantManifestDetected(e);if(this._isLowLatencyPlaylist(e)&&this.config.lowLatencyMode)return void this._handleLLManifestDetected(e);if(this._isVODPlaylist(e))return void this._handleVODPlaylist(e);if(this._eventBus.publish(t0.playlists.lastPlaylistOfSegmentLoaded,{}),!this._url)return;let t=this._url;this._lastTargetDuration=e.targetDuration||2;let r=e.segments.map(r=>new r8({fragmentUrl:r.uri,playlistUrl:t,duration:r.duration,independent:g.INDEPENDENT,msn:r.msnNumber,pn:r.partNumber,isTransmuxingBypassRequested:!!e.segments[0].map?.uri},this._eventBus,this.config.shouldLogFragmentsHistory));e.segments[0]?.map?.uri&&r.unshift(new r8({fragmentUrl:e.segments[0].map.uri,playlistUrl:t,independent:g.INDEPENDENT,msn:-1,pn:-1,isTransmuxingBypassRequested:!0,duration:0,isInitSection:!0},this._eventBus,this.config.shouldLogFragmentsHistory)),this._handleFragmentsDetected(r),this._planNextLoad()}_planNextLoad(){let e=this._getNextPlaylistLoadTimeout();this._currentPlaylistLoader&&(this._currentPlaylistLoader.destroy(),this._currentPlaylistLoader=null),this._logger.info(`Expecting next load in ${e} ms`),this._lifecycleEventReporter("Awaiting next loading"),this.status="Awaiting next loading",this._playlistLoaderTimeout=globalThis.setTimeout(()=>{this._loadNextPlaylist()},e)}_getNextPlaylistLoadTimeout(){let{forceStaticPlaylistLoadingTimeout:e,staticPlaylistLoadingTimeoutInDurations:t}=this.config;if(e&&t)return this._logger.verbose(`forceStaticPlaylistLoadingTimeout is set to true and staticPlaylistLoadingTimeoutInDurations is set to ${t}. Using static timeout`),t*this._lastTargetDuration*1e3;let r=!this.config.disableRotateTimeoutIncrease&&this._samePlaylistsCount>1?1.5:1;return this._logger.verbose(`There was ${this._samePlaylistsCount} same playlists. Multiplier is ${r}. Target duration is ${this._lastTargetDuration}`),r*this._lastTargetDuration*1e3}}(0,er.__decorate)([t1.default],im.prototype,"_handleConfigUpdated",null),et("8NFq9"),er=et("a8VW4"),t1=et("eQOGK"),(Q=v||(v={}))[Q.NONE=0]="NONE",Q[Q.LOADING=1]="LOADING",Q[Q.LOADED=2]="LOADED",Q[Q.ERROR=3]="ERROR";class iv extends ig{state=n.OK;status="Idle";additionalInfo={};_fragments=[];_lastHandledFragments=[];_chunksRetryTimeout=null;_isDurationPositive=!1;constructor(e,t,r){super("VODPlaylistRotationController","playlistLoader",e),this._url=t,this._onFragmentLoadedListener=this._eventBus.subscribe(rT.fragmentLoader.fragments.fragmentLoaded,this._onFragmentLoaded),this._onFragmentAbortedListener=this._eventBus.subscribe(rT.fragmentLoader.fragments.fragmentLoadingAborted,this._onFragmentLoadingError),this._onFragmentErrorListener=this._eventBus.subscribe(rT.fragmentLoader.fragments.fragmentLoadingError,this._onFragmentLoadingError),this._onBufferMetricsAvailableListener=this._eventBus.subscribe(t3.bufferMetricsAvailable,this._onBufferMetricsAvailable),r?this._handleParsedPlaylist(r):this._loadNextPlaylist()}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onFragmentLoadedListener),this._eventBus.unsubscribe(this._onBufferMetricsAvailableListener),this._eventBus.unsubscribe(this._onFragmentErrorListener),this._eventBus.unsubscribe(this._onFragmentAbortedListener)}setURL(e,t){t?this._url=e:(this._logger.info(`Setting new url ${e}`),this._currentPlaylistLoader?.destroy(),this._url=e,this._loadNextPlaylist())}abortCurrentPlaylistLoading(){this._logger.info("Aborting current loading playlist"),this._currentPlaylistLoader?.destroy()}_handleConfigUpdated(){}_loadNextPlaylist(){let{playlistLoadingTimeout:e,baseVODPlaylistRetryTimeout:t,maxVODPlaylistLoadingRetries:r}=this.config;this._logger.debug("Loading VOD playlist"),this._currentPlaylistLoader&&this._currentPlaylistLoader.cancel(`Another playlist with url ${this._url} scheduled to load`),this._currentPlaylistLoader=new r1({url:this._url||"",loadingTimeout:e,autoLoad:!0,mode:"text",onStateChanged:this._onPlaylistLoadingStateChanged,baseRetryTimeout:t,maxRetries:r,workerMode:this.config.workerMode},this._eventBus)}_onPlaylistLoadingStateChanged(e,t){if(!this._currentPlaylistLoader||[p.ABORTED,p.ERROR].includes(t))return this.state=n.ERROR,this.additionalInfo={playlistLoadError:this._currentPlaylistLoader?.error},this._logger.warn(`Playlist loader reported ${t===p.ERROR?"error":"as aborted"} (${this._currentPlaylistLoader?.error?.statusText||"no error"} with status ${this._currentPlaylistLoader?.error?.statusText||"no status"}). Planning next load`),void(this._currentPlaylistLoader=null);if(t!==p.LOADED)return;let r=this._currentPlaylistLoader.data;this._currentPlaylistLoader=null;let i=this._parsePlaylist(r);i?(this._eventBus.publish(t0.playlists.playlistInfo,i),this._handleParsedPlaylist(i)):this._eventBus.publish(t8.requestRestartFromMain,{})}_handleParsedPlaylist(e){this._isMultiVariantPlaylist(e)?this._handleMultivariantManifestDetected(e):this._isLowLatencyPlaylist(e)&&this.config.lowLatencyMode?this._handleLLManifestDetected(e):this._isSimplePlaylist(e)?this._handleSimplePlaylistDetected(e):(this.status="Playlist loaded",this._populateVODFragments(e.segments))}_planNextLoad(){}_populateVODFragments(e){let t=0;for(let r=0;r<e.length;r++){let i=e[r],n={url:i.uri,fragmentIndex:r,fragmentStartTS:t,fragmentEndTS:t+i.duration,readinessState:v.NONE,isLast:r===e.length-1};this._fragments.push(n),t=n.fragmentEndTS}this._isDurationPositive=t>0,this._eventBus.publish(t0.playlists.vodFragmentsInfo,this._fragments)}_loadFragment(e){let t=e.map(({url:e})=>e);e.filter(({readinessState:e,url:r})=>e===v.LOADED&&t.includes(r)).forEach(e=>{this._logger.info(`Some fragments already loaded, reemitting it: ${e.fragmentIndex}`),this._eventBus.publish(t0.fragments.requestReleaseFromCache,{msn:e.fragmentIndex})});let r=e.filter(({readinessState:e})=>[v.NONE].includes(e));r.forEach(e=>e.readinessState=v.LOADING),this._handleFragmentsDetected(r.map(e=>new r8({msn:e.fragmentIndex,playlistUrl:this._url||"",fragmentUrl:e.url,pn:0,independent:g.INDEPENDENT,duration:e.fragmentEndTS-e.fragmentStartTS,requestedLoadingTimeout:this.config.disableTimeoutsInVOD?-1:this.config.baseVODFragmentRetryTimeout,startTs:e.fragmentStartTS,endTs:e.fragmentEndTS,isTransmuxingBypassRequested:e.url.endsWith(".mp4")},this._eventBus,this.config.shouldLogFragmentsHistory))),this._lastHandledFragments=t}_onFragmentLoaded(e){this._logger.info(`Fragment ${e.msn} loaded`);let t=this._fragments.find(({fragmentIndex:t})=>t===e.msn);t&&(t.readinessState=v.LOADED,t.data=e.data,this.additionalInfo.fragments=this._fragments.map(e=>({...e,data:void 0})))}_onFragmentLoadingError(e){let t=this._fragments.find(({fragmentIndex:t})=>t===e.msn);t&&(t.readinessState=v.ERROR,this._chunksRetryTimeout||(this._chunksRetryTimeout=globalThis.setTimeout(this._retryFragments,this.config.baseVODFragmentRetryTimeout)))}_retryFragments(){this._chunksRetryTimeout=null,this._fragments.filter(({readinessState:e})=>e===v.ERROR).forEach(e=>e.readinessState=v.NONE)}_onBufferMetricsAvailable(e){if(this._fragments.some(({readinessState:e})=>e===v.LOADING)||!this._isDurationPositive)return;let t=[],{currentTimeRange:r,currentPlaybackPosition:i,isInLastBufferedRange:n,bufferedTimeRanges:s}=e,a=n||!!r&&!s.some(({start:e,end:t})=>e<=r.end+1&&r.end+1<=t),o=i+this.config.VODLoadNextSegmentThreshold/1e3;if(r&&r.end-i<this.config.VODLoadNextSegmentThreshold/1e3&&a&&o<e.knownDuration-.1&&(t=this._findNextFragmentsByTime(i,o).filter(({fragmentStartTS:e,fragmentEndTS:t})=>!(e<=i&&i<=t))),r||(t=this._findNextFragmentsByTime(i,i)),t.length){this._logger.info(`Loading following fragments ${t.map(({fragmentIndex:e})=>e).join(",")}`);let e=Math.min(...t.map(({fragmentStartTS:e})=>e)),r=Math.max(...t.map(({fragmentEndTS:e})=>e));this._eventBus.publish(t0.fragments.periodFragmentsFound,{startTsOfPeriod:e,endTsOfPeriod:r}),this._loadFragment(t)}}_findNextFragmentsByTime(e,t){return this._fragments.filter(({fragmentEndTS:r,fragmentStartTS:i})=>i<=e&&e<=r||i>=e&&t>=r||i<=t&&t<=r)}}(0,er.__decorate)([t1.default],iv.prototype,"destroy",null),(0,er.__decorate)([t1.default],iv.prototype,"_handleConfigUpdated",null),(0,er.__decorate)([t1.default],iv.prototype,"_onPlaylistLoadingStateChanged",null),(0,er.__decorate)([t1.default],iv.prototype,"_planNextLoad",null),(0,er.__decorate)([t1.default],iv.prototype,"_onFragmentLoaded",null),(0,er.__decorate)([t1.default],iv.prototype,"_onFragmentLoadingError",null),(0,er.__decorate)([t1.default],iv.prototype,"_retryFragments",null),(0,er.__decorate)([t1.default],iv.prototype,"_onBufferMetricsAvailable",null),t1=et("eQOGK"),(z=y||(y={})).VOD="VOD",z.LOW_LATENCY="lowLatency",z.SIMPLE="simple";class iy{state=n.OK;status="Idle";additionalInfo={};groups=["loader"];_streamUrl=null;_aclToken=null;_playlistsRotator=null;_actualRenditionReport=null;_lastAddedFragment=null;constructor(e=y.SIMPLE,t,r){this._eventBus=r,this._logger=e$(this._eventBus,"Doppio - StreamLoader"),this._logger.info("Created"),this._fragmentsLoader=new r2(this._eventBus),this._initialType=e,this._simplePlaylistDetectedListener=this._eventBus.subscribe(rT.playlistRotator.playlistType.simpleDetected,this._onSimplePlaylistDetected),this._llPlaylistDetectedListener=this._eventBus.subscribe(rT.playlistRotator.playlistType.llDetected,this._onLLPlaylistDetected),this._vodPlaylistDetectedListener=this._eventBus.subscribe(rT.playlistRotator.playlistType.vodDetected,this._onVODPlaylistDetected),this._onSoftResetRequestedListener=this._eventBus.subscribe(t3.requestResetWithOverplay,this._resetPlaylistLoaders),this._onBrowserRedirectDetectedListener=this._eventBus.subscribe(rt.events.browserRedirectDetected,this._onBrowserRedirectDetected),this._onFragmentAddedListener=this._eventBus.subscribe(t3.fragmentAdded,this._onFragmentAdded),this._lastAddedFragment=t}startLoad(e){this._streamUrl=e,this._recreateLoaders()}destroy(){this._logger.info(`Destroying instance, ${this._streamUrl}`),this._fragmentsLoader.destroy(),this._playlistsRotator?.destroy(),this._eventBus.unsubscribe(this._simplePlaylistDetectedListener),this._eventBus.unsubscribe(this._llPlaylistDetectedListener),this._eventBus.unsubscribe(this._vodPlaylistDetectedListener),this._eventBus.unsubscribe(this._onSoftResetRequestedListener),this._eventBus.unsubscribe(this._onFragmentAddedListener),this._eventBus.unsubscribe(this._onBrowserRedirectDetectedListener)}setActualRenditionReport(e){e&&(this._actualRenditionReport=e)}_recreateLoaders(){this.status="Restarting";let e=this._buildUrl();this._logger.debug("Recreate loaders"),e&&(this._fragmentsLoader.destroy(),this._fragmentsLoader=new r2(this._eventBus),this._playlistsRotator?this._playlistsRotator?.setURL(e):this._recreateInitialLoader(),this.status="Working")}_recreateInitialLoader(){switch(this._initialType){case y.SIMPLE:this._onSimplePlaylistDetected();break;case y.VOD:this._onVODPlaylistDetected();break;case y.LOW_LATENCY:this._onLLPlaylistDetected();break;default:this._onSimplePlaylistDetected()}}_buildUrl(){return this._streamUrl?`${this._streamUrl}${this._aclToken?"?aclToken="+this._aclToken:""}`:null}_onFragmentAdded(e){this._lastAddedFragment=e}_onSimplePlaylistDetected(e){if(this._playlistsRotator instanceof im)return;this._eventBus.publish(rT.streamLoader.playlistRotatorTypeChanged,y.SIMPLE),this._logger.info("Simple playlist detected, switching to simple loader");let t=this._buildUrl();t&&(this._playlistsRotator?.destroy(),this._playlistsRotator=new im(this._eventBus,t,e),this.additionalInfo.playlistRotatorType="SimplePlaylistRotator")}_onVODPlaylistDetected(e){if(this._playlistsRotator instanceof iv)return;this._eventBus.publish(rT.streamLoader.playlistRotatorTypeChanged,y.VOD),this._logger.info("VOD playlist detected, switching to VOD loader");let t=this._buildUrl();t&&(this._playlistsRotator?.destroy(),this._playlistsRotator=new iv(this._eventBus,t,e),this.additionalInfo.playlistRotatorType="VODPlaylistRotator")}_onLLPlaylistDetected(e){if(this._playlistsRotator instanceof ip)return;this._eventBus.publish(rT.streamLoader.playlistRotatorTypeChanged,y.LOW_LATENCY),this._logger.info("LL Playlist detected, switching to ll loader");let t=this._buildUrl();t&&(this._playlistsRotator?.destroy(),this._playlistsRotator=new ip(this._eventBus,{url:t,startManifest:e,initialMSN:this._actualRenditionReport?.lastMsn,initialPN:this._actualRenditionReport?.lastPart,lastLoadedFragment:this._lastAddedFragment}),this.additionalInfo.playlistRotatorType="LowLatencyPlaylistRotator")}_resetPlaylistLoaders(){this._playlistsRotator?.abortCurrentPlaylistLoading(),this.status="Idle"}_onBrowserRedirectDetected({responseUrl:e}){this._streamUrl=e;let t=this._buildUrl();t&&this._playlistsRotator?.setURL(t,!0)}get additionalModules(){let e={};return this._playlistsRotator&&(e.playlistRotator=this._playlistsRotator),this._fragmentsLoader&&(e.fragmentLoader=this._fragmentsLoader),e}}(0,er.__decorate)([t1.default],iy.prototype,"_onFragmentAdded",null),(0,er.__decorate)([t1.default],iy.prototype,"_onSimplePlaylistDetected",null),(0,er.__decorate)([t1.default],iy.prototype,"_onVODPlaylistDetected",null),(0,er.__decorate)([t1.default],iy.prototype,"_onLLPlaylistDetected",null),(0,er.__decorate)([t1.default],iy.prototype,"_resetPlaylistLoaders",null),(0,er.__decorate)([t1.default],iy.prototype,"_onBrowserRedirectDetected",null),t1=et("eQOGK");class ib extends tJ{state=n.OK;status="Idle";additionalInfo={currentResolution:""};groups=["resolutionsManager"];_currentResolutionsDecreasing=[];_currentResolution=null;_awaitingResolution=null;_lastMSN=-1;_lastDSN=-1;_lastPDT=-1;_url="";_isAutoEnabled=!0;_lastPlaylistRotatorType=y.SIMPLE;_streamLoader=null;_restartTimeout=null;_renditionReports=[];_lastLoadedFragment=null;_codecsByResolutions={};constructor(e){super("resolutionsManager",e),this._logger=e$(e,"Doppio - ResolutionManager"),this._logger=e$(this._eventBus,"Doppio - ResolutionManager"),this._multiVariantsPlaylistDetectionListener=this._eventBus.subscribe(rT.playlistRotator.playlistType.multivariantDetected,this._onMultiVariantsPlaylists),this._onResolutionChangeRequestedListener=this._eventBus.subscribe(t8.requestResolutionChange,this._onResolutionChangeRequested),this._onPlaylistInfoAvailableListener=this._eventBus.subscribe(rT.playlistRotator.playlists.playlistInfo,this._onPlaylistInfoAvailable),this._onRestartFromMainRequestedListener=this._eventBus.subscribe(t8.requestRestartFromMain,this._restartFormMain),this._onPlaylistRotatorTypeChangedListener=this._eventBus.subscribe(rT.streamLoader.playlistRotatorTypeChanged,this._onPlaylistRotatorTypeChanged),this._onEndOfSegmentPlaylistLoadedListener=this._eventBus.subscribe(t0.playlists.lastPlaylistOfSegmentLoaded,this._onEndOfSegmentPlaylistLoaded),this._onFragmentAddedListener=this._eventBus.subscribe(t3.fragmentAdded,this._onFragmentAdded)}destroy(){super.destroy(),this._restartTimeout&&(clearTimeout(this._restartTimeout),this._restartTimeout=null),this._eventBus.unsubscribe(this._multiVariantsPlaylistDetectionListener),this._eventBus.unsubscribe(this._onResolutionChangeRequestedListener),this._eventBus.unsubscribe(this._onPlaylistInfoAvailableListener),this._eventBus.unsubscribe(this._onRestartFromMainRequestedListener),this._eventBus.unsubscribe(this._onPlaylistRotatorTypeChangedListener),this._eventBus.unsubscribe(this._onEndOfSegmentPlaylistLoadedListener),this._eventBus.unsubscribe(this._onFragmentAddedListener),this._streamLoader?.destroy(),this._codecsByResolutions={}}setUrl(e){this._url!==e&&(this._lastPDT=-1,this._lastDSN=-1,this._lastMSN=-1,this._logger.info("Setting new url"),this._eventBus.publish(t8.entrypointURLUpdated,{entrypointURL:e}),this._url=e,this._currentResolution=null,this._currentResolutionsDecreasing=[],this._restart())}setResolution(e,t=!1){if(this._awaitingResolution=null,e.name===this._currentResolution?.name)return;if(this._url&&tK(this._url).streamId&&tK(e.url).streamId&&tK(this._url).streamId!==tK(e.url).streamId)return void this._logger.warn(`Tried to set resolution with ${e.url}, but the current url is ${this._url}. Skipping since they don't match`);let r=this._currentResolution;this._logger.info(`Resolution changed: ${this._currentResolution?.name} -> ${e.name}`),this._currentResolution=e,this.additionalInfo.currentResolution=e.name,this._eventBus.publish(t8.resolutionChanged,e),this._codecsByResolutions[e.url]&&this._eventBus.publish(t3.changeCodec,{codec:this._codecsByResolutions[e.url]}),!t&&r||this._eventBus.publish(t8.resolutionAutoChanged,{prevResolution:r?.name,nextResolution:e.name}),this._restart()}setNearestResolutionByWidth(e){return this._setResolutionByCriteria(({width:t})=>t<=e)}setNearestResolutionByHeight(e){return this._setResolutionByCriteria(({height:t})=>t<=e)}setNearestResolutionByBitrate(e){return this._setResolutionByCriteria(({bitrate:t})=>t<=e+this.config.initialResolutionBitrateThreshold)}setResolutionByName(e){return this._setResolutionByCriteria(({name:t})=>t===e)}toggleAutoResolution(e){this._isAutoEnabled=e}restart(){this._restart()}_handleConfigUpdated(){}_setResolutionByCriteria(e){let t=this._findResolutionByCriteria(e);return t?this.config.awaitForSegmentEndToSwitchManual&&this._currentResolution&&this._lastMSN>-1?(this._logger.info("Await for segment end for switch resolution"),void(this._awaitingResolution=t)):void this.setResolution(t):(this._logger.warn("There are no any resolution in current stream"),this.state=n.ERROR,void(this._awaitingResolution=null))}_findResolutionByCriteria(e){if(!this._currentResolutionsDecreasing.length)return null;if(1===this._currentResolutionsDecreasing.length)return this._currentResolutionsDecreasing[0];let t=this._currentResolutionsDecreasing.find(e);return t||(this._eventBus.publish(t8.resolutionNotFound,{}),!1!==this.config.useFallbackResolutionIfResolutionNotFound)?t||this._currentResolutionsDecreasing.slice(-1)[0]:null}_restartFormMain(){this._currentResolution=null,this._logger.info("Restart from main"),this._renditionReports=[],this._eventBus.publish(t3.requestResetWithOverplay,{}),this._restart(2e3)}_restart(e=0){this._restartTimeout&&(clearTimeout(this._restartTimeout),this._restartTimeout=null),this._logger.info("Restart resolution manager"),this._destroyStreamLoader(),this._restartTimeout=setTimeout(()=>{this._recreateStreamLoader()},e)}_destroyStreamLoader(){this._streamLoader?.destroy(),this._streamLoader=null,this.status="Awaiting resolutions"}_recreateStreamLoader(){this._destroyStreamLoader(),this._streamLoader=new iy(this._lastPlaylistRotatorType,this._lastLoadedFragment,this._eventBus),this._streamLoader.setActualRenditionReport(this._getActualRenditionReport()),this._streamLoader.startLoad(this._currentResolution?this._currentResolution.url:this._url)}_onMultiVariantsPlaylists(e){this._currentResolutionsDecreasing=Object.values(e).sort((e,t)=>t.bitrate-e.bitrate),this.additionalInfo.resolutionsAvailable=this._currentResolutionsDecreasing.map(({name:e})=>e),this._eventBus.publish(t8.resolutionsAvailable,this._currentResolutionsDecreasing),this.config.initialResolutionBitrate?this.setNearestResolutionByBitrate(this.config.initialResolutionBitrate):this.config.initialResolutionHeight?this.setNearestResolutionByHeight(this.config.initialResolutionHeight):this.config.initialResolutionWidth?this.setNearestResolutionByWidth(this.config.initialResolutionWidth):this.config.autoloadLowestResolution&&this.setResolution(this._currentResolutionsDecreasing.slice(-1)[0])}_onEndOfSegmentPlaylistLoaded(){this._awaitingResolution&&(this._logger.info("Last playlist of segment loaded. Ready to switch"),this.setResolution(this._awaitingResolution,!0))}_onFragmentAdded(e){this._lastLoadedFragment=e}_onPlaylistInfoAvailable(e){let{mediaSequence:t,discontinuitySequence:r,segments:i}=e;if(e.playlists&&(this._codecsByResolutions=e.playlists.reduce((e,t)=>t.attributes?.CODECS?{...e,[t.uri]:t.attributes.CODECS}:e,{})),void 0===t||void 0===r||void 0===i)return;let n=i[0]?.dateTimeObject?.getTime()||0;-1===this._lastPDT||-1===this._lastDSN||-1===this._lastMSN||(r!==this._lastDSN&&(this._logger.info("DSN changed. Requesting overplay"),this._eventBus.publish(t3.requestResetWithOverplay,{})),Math.abs(n-this._lastPDT)>this.config.maxPlaylistTimeDifference&&(this._logger.warn("PDT delta reached max delta. Restarting from main"),this._restartFormMain())),this._lastMSN=t,this._lastDSN=r,this._lastPDT=n,this._renditionReports=e.renditionReports||[],this._streamLoader?.setActualRenditionReport(this._getActualRenditionReport())}_onResolutionChangeRequested(e){if(this._isAutoEnabled)return this.config.awaitForSegmentEndToSwitch?(this._logger.info("Await for segment end for switch resolution"),void(this._awaitingResolution=e)):void this.setResolution(e,!0)}_getActualRenditionReport(){if(!this._renditionReports.length)return null;try{return this._renditionReports.find(({uri:e})=>new URL(e).pathname===new URL(this._currentResolution?.url||"").pathname)||null}catch(e){return null}}_onPlaylistRotatorTypeChanged(e){this._lastPlaylistRotatorType=e}get additionalModules(){return this.additionalInfo.isAutoEnabled=this._isAutoEnabled,this._streamLoader?{streamLoader:this._streamLoader}:{}}}(0,er.__decorate)([t1.default],ib.prototype,"_handleConfigUpdated",null),(0,er.__decorate)([t1.default],ib.prototype,"_restartFormMain",null),(0,er.__decorate)([t1.default],ib.prototype,"_onMultiVariantsPlaylists",null),(0,er.__decorate)([t1.default],ib.prototype,"_onEndOfSegmentPlaylistLoaded",null),(0,er.__decorate)([t1.default],ib.prototype,"_onFragmentAdded",null),(0,er.__decorate)([t1.default],ib.prototype,"_onPlaylistInfoAvailable",null),(0,er.__decorate)([t1.default],ib.prototype,"_onResolutionChangeRequested",null),(0,er.__decorate)([t1.default],ib.prototype,"_onPlaylistRotatorTypeChanged",null),et("8NFq9"),er=et("a8VW4"),t1=et("eQOGK");class iE{_isResolutionSelected=!1;constructor(e,t){this._eventBus=t,this._sendEvent=e,this._isDebugEnabled=document?.cookie?.includes("__mmpDebug__=1"),this._onPlaylistLoadingStartedListener=this._eventBus.subscribe(t0.playlists.playlistRequested,this._onPlaylistLoadingStarted),this._onResolutionChangedListener=this._eventBus.subscribe(t8.resolutionChanged,this._onResolutionChanged),this._onResolutionChangedAutoListener=this._eventBus.subscribe(t8.resolutionAutoChanged,this._onResolutionAutoChanged),this._onPlaylistLoadedListener=this._eventBus.subscribe(t0.playlists.playlistLoaded,this._onPlaylistLoaded),this._onPlaylistParsedListener=this._eventBus.subscribe(t0.playlists.playlistInfo,this._onPlaylistInfoAvailable),this._onFragmentLoadedListener=this._eventBus.subscribe(rS.fragments.fragmentLoaded,this._onFragmentLoaded),this._onDebuggerConnectedListener=this._eventBus.subscribe(rh,this._onDebuggerConnected),this._onNetworkRequestSettledListener=this._eventBus.subscribe(rt.events.networkRequestSettled,this._onNetworkRequestSettled)}destroy(){this._eventBus.unsubscribe(this._onPlaylistLoadingStartedListener),this._eventBus.unsubscribe(this._onPlaylistLoadedListener),this._eventBus.unsubscribe(this._onPlaylistParsedListener),this._eventBus.unsubscribe(this._onFragmentLoadedListener),this._eventBus.unsubscribe(this._onDebuggerConnectedListener),this._eventBus.unsubscribe(this._onResolutionChangedListener),this._eventBus.unsubscribe(this._onResolutionChangedAutoListener),this._eventBus.unsubscribe(this._onNetworkRequestSettledListener)}_onPlaylistLoadingStarted(){this._isResolutionSelected||this._sendEvent(new CustomEvent(d.MANIFEST_LOADING))}_onResolutionChanged(){this._isResolutionSelected=!0}_onPlaylistLoaded(e){let{originalUrl:t,realUrl:r,stats:i}=e;this._isResolutionSelected?this._sendEvent(new CustomEvent(d.LEVEL_LOADED,{detail:{netStats:i}})):this._sendEvent(new CustomEvent(d.MANIFEST_LOADED,{detail:{originalUrl:t,realUrl:r}}))}_onPlaylistInfoAvailable(e){this._sendEvent(new CustomEvent(d.MANIFEST_PARSED,{detail:e}))}_onFragmentLoaded(e){this._sendEvent(new CustomEvent(d.FRAG_LOADED,{detail:{netStats:e.stats,duration:e.duration}}))}_onDebuggerConnected(e){this._sendEvent(new CustomEvent(d.DEBUGGER_CONNECTED,{detail:{panelUrl:e}}))}_onResolutionAutoChanged({prevResolution:e,nextResolution:t}){this._sendEvent(new CustomEvent(d.LEVEL_SWITCHED_AUTO,{detail:{prevResolution:e,nextResolution:t}}))}_onNetworkRequestSettled({response:e}){this._isDebugEnabled&&globalThis.dispatchEvent(new CustomEvent("mmpFetchSettled",{detail:{response:e}}))}}(0,er.__decorate)([t1.default],iE.prototype,"_onPlaylistLoadingStarted",null),(0,er.__decorate)([t1.default],iE.prototype,"_onResolutionChanged",null),(0,er.__decorate)([t1.default],iE.prototype,"_onPlaylistLoaded",null),(0,er.__decorate)([t1.default],iE.prototype,"_onPlaylistInfoAvailable",null),(0,er.__decorate)([t1.default],iE.prototype,"_onFragmentLoaded",null),(0,er.__decorate)([t1.default],iE.prototype,"_onDebuggerConnected",null),(0,er.__decorate)([t1.default],iE.prototype,"_onResolutionAutoChanged",null),(0,er.__decorate)([t1.default],iE.prototype,"_onNetworkRequestSettled",null);let iR=e=>{if(r3(e))return e;let t=new URL(document.location.href);if(e.startsWith("/"))return`${t.origin}${e}`;let r=t.pathname.split("/").filter(e=>e.trim().length>0);return r.pop()||r.pop(),`${t.origin}/${r.concat(e).join("/")}`};t1=et("eQOGK");class iS{state=n.OK;status="Idle";groups=["general"];_lastMetrics=null;get additionalInfo(){return{totalHeapSize:performance.memory?.totalJSHeapSize,usedHeapSize:performance.memory?.usedJSHeapSize,sizeLimit:performance.memory?.jsHeapSizeLimit,...this._lastMetrics||{}}}}et("8NFq9"),er=et("a8VW4"),t1=et("eQOGK");var iT=et("3264a");class iL extends tJ{_debuggableModules={};_modulesInfoGatheringInterval=null;_debuggerWorker=null;constructor(e){super("debugger",e),this._onLifecycleEventReportedListener=this._eventBus.subscribe(rc,this._onLifecycleEventReported),this.config.enableRemoteDebugging&&this.config.debuggerUrl&&this.config.maxWSConnectionRetries&&this._startDebugger()}registerDebuggableModules(e){this._debuggableModules={...this._debuggableModules,...e}}unregisterDebuggableModules(e){e.forEach(e=>{delete this._debuggableModules[e]})}destroy(){super.destroy(),this._debuggerWorker?.disconnect(),this._eventBus.unsubscribe(this._onLifecycleEventReportedListener)}_handleConfigUpdated(e){this._debuggerWorker&&(e.debuggerUrl||e.maxWSConnectionRetries)&&(this._destroyWorker(),this._getDebuggerModule()),!1===e.enableRemoteDebugging&&this._stopDebugger(),e.enableRemoteDebugging&&(this._destroyWorker(),this._getDebuggerModule()),e.modulesStateGatheringPeriod&&(this._disarmSendModulesInfoTimeout(),this._armSendModulesInfoTimeout())}_destroyWorker(){this._debuggerWorker?.disconnect(),this._debuggerWorker=null}_startDebugger(){this._getDebuggerModule(),this._armSendModulesInfoTimeout()}_stopDebugger(){this._debuggerWorker&&(this._debuggerWorker.disconnect(),this._disarmSendModulesInfoTimeout())}async _sendMessage(e){(await this._getDebuggerModule()).sendMessage(e)}_onConnected(e){this._eventBus.publish(rh,e),this._armSendModulesInfoTimeout()}_onDisconnected(){this._disarmSendModulesInfoTimeout()}_onLifecycleEventReported(e){this._debuggerWorker&&this.config.enableLifecycleEvents&&this._sendMessage({command:iT.ECommand.MODULE_LIFECYCLE_EVENT_AVAILABLE,event:e})}_armSendModulesInfoTimeout(){this._modulesInfoGatheringInterval=globalThis.setInterval(this._sendModulesInfo,this.config.modulesStateGatheringPeriod)}_disarmSendModulesInfoTimeout(){this._modulesInfoGatheringInterval&&globalThis.clearInterval(this._modulesInfoGatheringInterval)}_unzipDebuggableModules(e){let t={...e};return Object.values(e).forEach(e=>{e.additionalModules&&(t={...t,...this._unzipDebuggableModules(e.additionalModules)})}),t}_sendModulesInfo(){let e=Object.entries(this._unzipDebuggableModules(this._debuggableModules)).reduce((e,[t,r])=>(e[t]={additionalInfo:r.additionalInfo,state:r.state,groups:r.groups,status:r.status},e),{});this._sendMessage({command:iT.ECommand.MODULES_INFO_AVAILABLE,payload:e})}async _getDebuggerModule(){if(!this._debuggerWorker){let{DebuggerWorker:e}=await et("iVqGx");this._debuggerWorker=new e,this._debuggerWorker.setConfig(this.config.debuggerUrl,this.config.maxWSConnectionRetries,this._onConnected,this._onDisconnected),this._debuggerWorker.connect()}return this._debuggerWorker}}(0,er.__decorate)([t1.default],iL.prototype,"_onConnected",null),(0,er.__decorate)([t1.default],iL.prototype,"_onDisconnected",null),(0,er.__decorate)([t1.default],iL.prototype,"_onLifecycleEventReported",null),(0,er.__decorate)([t1.default],iL.prototype,"_sendModulesInfo",null),et("8NFq9"),er=et("a8VW4"),t1=et("eQOGK");class iA extends tJ{_initSectionCache=null;_expectedUnitedChunkName="";_fragmentsCache=[];constructor(e){super("fragmentBuffer",e),this._logger=e$(this._eventBus,"Doppio - FragmentsBuffer"),this._onFragmentReleasedListenerToken=this._eventBus.subscribe(rW,this._onFragmentReleasedFromQueue),this._onSaveDataRequestedListenerToken=this._eventBus.subscribe(rj.saveData,this.sendUnitedChunk)}destroy(){super.destroy(),this._eventBus.unsubscribe(this._onFragmentReleasedListenerToken),this._eventBus.unsubscribe(this._onSaveDataRequestedListenerToken),this._initSectionCache=null,this._fragmentsCache=[]}sendUnitedChunk(){if(this._initSectionCache&&!(Math.random()>this.config.saveProbability))try{let e=rG([this._initSectionCache.data].concat(...this._fragmentsCache.map(({data:e})=>e))),t=new Headers;t.append("Content-Type","video/mp4"),fetch(`https://${this.config.baseChunksSaverUrl}/${this._expectedUnitedChunkName}`,{method:"PUT",headers:t,body:e,redirect:"follow"}).catch(e=>{this._logger.warn(`Could not save problem chunks: ${e}`)})}catch(e){this._logger.warn(`Could not save problem chunks: ${e}`)}}_onFragmentReleasedFromQueue(e){try{for(let t of e){if(t.isInitSection)return this._initSectionCache=t,this._expectedUnitedChunkName=t.url.split("/").slice(-1)[0],void(this._fragmentsCache=[]);this._fragmentsCache.push(t);let r=Math.max(...e.map(({msn:e})=>e)),i=Math.max(0,r-this.config.numberOfFragmentsToKeepInBuffer+1);this._fragmentsCache=this._fragmentsCache.filter(({msn:e})=>e>=i)}}catch(e){this._logger.warn("Could not handle fragment"),this._fragmentsCache=[],this._initSectionCache=null}}}(0,er.__decorate)([t1.default],iA.prototype,"sendUnitedChunk",null),(0,er.__decorate)([t1.default],iA.prototype,"_onFragmentReleasedFromQueue",null),et("8NFq9"),er=et("a8VW4"),t1=et("eQOGK"),(b||(b={})).SAME_PLAYLIST_LOADED_MORE_TIMES="Same playlist was loaded more than expected times. Looks lise server is malfunctioning";class iP extends Error{constructor(e,t,r){super(e),this.name="DoppioNetworkError",this.statusCode=t,this.statusText=r}}let iB={lifecycleEvent:"LifecycleEventsManager.LIFECYCLE_EVENT",lifecycleError:"LifecycleEventsManager.LIFECYCLE_ERROR"};class iC{_manifestLoaded=!1;_firstMediaPlaylistLoaded=!1;_firstFragmentLoaded=!1;_firstFragmentBuffered=!1;constructor(e){this._eventBus=e,this._onManifestLoadedListener=this._eventBus.subscribe(t0.playlistType.multivariantDetected,this._onManifestLoaded),this._onSimplePlaylistDetectedListener=this._eventBus.subscribe(t0.playlistType.simpleDetected,this._onPlaylistLoaded),this._onLLPlaylistDetectedListener=this._eventBus.subscribe(t0.playlistType.llDetected,this._onPlaylistLoaded),this._onVODPlaylistDetectedListener=this._eventBus.subscribe(t0.playlistType.vodDetected,this._onPlaylistLoaded),this._onFragmentLoadedListener=this._eventBus.subscribe(rS.fragments.fragmentLoaded,this._onFragmentLoaded),this._onFragmentBufferedListener=this._eventBus.subscribe(t3.fragmentAdded,this._onFragmentBuffered),this._onFragmentLoadErrorListener=this._eventBus.subscribe(rS.fragments.fragmentLoadingError,this._onFragmentLoadError),this._onFragmentLoadAbortListener=this._eventBus.subscribe(rS.fragments.fragmentLoadingAborted,this._onFragmentLoadError),this._onPlaylistLoadErrorListener=this._eventBus.subscribe(t0.playlists.playlistLoadingError,this._onPlaylistLoadError)}destroy(){this._eventBus.unsubscribe(this._onManifestLoadedListener),this._eventBus.unsubscribe(this._onSimplePlaylistDetectedListener),this._eventBus.unsubscribe(this._onLLPlaylistDetectedListener),this._eventBus.unsubscribe(this._onVODPlaylistDetectedListener),this._eventBus.unsubscribe(this._onFragmentLoadedListener),this._eventBus.unsubscribe(this._onFragmentBufferedListener),this._eventBus.unsubscribe(this._onFragmentLoadErrorListener),this._eventBus.unsubscribe(this._onFragmentLoadAbortListener),this._eventBus.unsubscribe(this._onPlaylistLoadErrorListener)}reset(){this._manifestLoaded=!1,this._firstMediaPlaylistLoaded=!1,this._firstFragmentLoaded=!1,this._firstFragmentBuffered=!1}_onManifestLoaded(){this._manifestLoaded||(this._manifestLoaded=!0,this._eventBus.publish(iB.lifecycleEvent,{eventType:l.MANIFEST_LOADED}))}_onPlaylistLoaded(){this._firstMediaPlaylistLoaded||(this._firstMediaPlaylistLoaded=!0,this._eventBus.publish(iB.lifecycleEvent,{eventType:l.FIRST_MEDIA_PLAYLIST_LOADED}))}_onFragmentLoaded(){this._firstFragmentLoaded||(this._firstFragmentLoaded=!0,this._eventBus.publish(iB.lifecycleEvent,{eventType:l.FIRST_FRAGMENT_LOADED}))}_onFragmentBuffered(){this._firstFragmentBuffered||(this._firstFragmentBuffered=!0,this._eventBus.publish(iB.lifecycleEvent,{eventType:l.FIRST_FRAGMENT_BUFFERED}))}_onFragmentLoadError(e){this._eventBus.publish(iB.lifecycleError,{errorType:u.FRAGMENT_LOAD_ERROR,nativeError:new iP(` ${e.error?.statusText} (${e.error?.status})`,e.error?.status||-1,e.error?.statusText||"No status text known")})}_onPlaylistLoadError({error:e}){this._eventBus.publish(iB.lifecycleError,{errorType:this._manifestLoaded?u.PLAYLIST_LOAD_ERROR:u.MANIFEST_LOAD_ERROR,nativeError:new iP(`Could not load ${this._manifestLoaded?"playlist":"manifest"}: ${e?.statusText}(${e?.status})`,e?.status||-1,e?.statusText||"No status text known")})}}(0,er.__decorate)([t1.default],iC.prototype,"_onManifestLoaded",null),(0,er.__decorate)([t1.default],iC.prototype,"_onPlaylistLoaded",null),(0,er.__decorate)([t1.default],iC.prototype,"_onFragmentLoaded",null),(0,er.__decorate)([t1.default],iC.prototype,"_onFragmentBuffered",null),(0,er.__decorate)([t1.default],iC.prototype,"_onFragmentLoadError",null),(0,er.__decorate)([t1.default],iC.prototype,"_onPlaylistLoadError",null);class iw extends EventTarget{_eventBus=new rx;_loggerTransport=null;_fragmentParser=new rV(this._eventBus);_fragmentQueue=new r$(this._eventBus);_buffer=new rk(this._eventBus);_resolutionManager=new ib(this._eventBus);_abrController=new ro(this._eventBus);_debugger=new iL(this._eventBus);_fragmentsFilter=new rH(this._eventBus);_fragmentsBuffer=new iA(this._eventBus);_url=null;_key=null;_videoElement=null;_isStarted=!1;_commonMetricsCollector=new iS;_lifecycleEventsManager=new iC(this._eventBus);constructor(){super();let e=(Math.random()+1).toString(36).substring(7);this._eventBus.setAppId(e),this._loggerTransport=new ez(this._eventBus,tz,[],[]),this._logger=e$(this._eventBus,"Doppio - core"),this._logger.info("Created"),this._onResolutionsAvailableListener=this._eventBus.subscribe(t8.resolutionsAvailable,this._onResolutionsAvailable),this._onMetricsAvailableListener=this._eventBus.subscribe(t3.bufferMetricsAvailable,this._onBufferMetricsAvailable),this._onResolutionChangedListener=this._eventBus.subscribe(t8.resolutionChanged,this._onResolutionChanged),this._onStreamEndedListener=this._eventBus.subscribe(t3.endOfStreamReached,this._onStreamEnded),this._onPlaybackStateChangedListener=this._eventBus.subscribe(t3.playbackStateChanged,this._onPlaybackStateChanged),this._legacyEventsController=new iE(this.dispatchEvent.bind(this),this._eventBus),this._debugger.registerDebuggableModules({fragmentQueue:this._fragmentQueue,commonInfo:this._commonMetricsCollector,resolutionManager:this._resolutionManager,abr:this._abrController}),this._onLifecycleEventReportedListener=this._eventBus.subscribe(iB.lifecycleEvent,this._onLifecycleEventReported),this._onLifecycleErrorReportedListener=this._eventBus.subscribe(iB.lifecycleError,this._onLifecycleErrorReported),this._onResolutionNotFoundListener=this._eventBus.subscribe(t8.resolutionNotFound,this._onResolutionNotFound),this._onFragmentsFilterProblemDetectedListener=this._eventBus.subscribe(rU.problemDetected,this._onFragmentFilterProblemDetected)}destroy(){this._eventBus.unsubscribe(this._onResolutionsAvailableListener),this._eventBus.unsubscribe(this._onResolutionChangedListener),this._eventBus.unsubscribe(this._onMetricsAvailableListener),this._eventBus.unsubscribe(this._onStreamEndedListener),this._eventBus.unsubscribe(this._onPlaybackStateChangedListener),this._eventBus.unsubscribe(this._onLifecycleEventReportedListener),this._eventBus.unsubscribe(this._onLifecycleErrorReportedListener),this._eventBus.unsubscribe(this._onResolutionNotFoundListener),this._eventBus.unsubscribe(this._onFragmentsFilterProblemDetectedListener),this._fragmentParser.destroy(),this._buffer.destroy(),this._resolutionManager.destroy(),this._abrController.destroy(),this._fragmentQueue.destroy(),this._debugger.destroy(),this._legacyEventsController.destroy(),this._videoElement?.removeEventListener("error",this._onMediaElementError),this._logger.info("Destroyed"),this._lifecycleEventsManager.destroy(),this._fragmentsFilter.destroy(),this._fragmentsBuffer.destroy(),setTimeout(()=>{this._loggerTransport?.destroy()},1e3),r0(this._eventBus.getAppId())}get version(){return"v1.14.0"}get isStarted(){return this._isStarted}recoverMediaError(){this._buffer.detachVideoElement(),this._videoElement&&this._buffer.attachVideoElement(this._videoElement),this._resolutionManager.restart(),this._videoElement?.play()}start(){this._url?(this._videoElement||this._logger.warn("Video element is not defined."),this._isStarted?this._restart():(this._debugger.registerDebuggableModules({bufferController:this._buffer}),this._resolutionManager.setUrl(this._url),this._isStarted=!0)):this._logger.fatal("Stream URL is not defined. Cannot start player")}setUrl(e){if(!e.trim())return this._stop(),this;let t=iR(e),r=this._url!==t&&this._isStarted;return this._url=t,this._key=null,r&&(this._lifecycleEventsManager.reset(),this._restart()),this}setKey(e){return this._key=e,this}setVideoElement(e){return e===this._videoElement||(this._videoElement&&(this._buffer.detachVideoElement(),this._videoElement.removeEventListener("error",this._onMediaElementError)),this._videoElement=e,this._videoElement&&(this._buffer.attachVideoElement(this._videoElement),this._buffer.scheduleSourceBufferRecreation(),this._videoElement.addEventListener("error",this._onMediaElementError))),this}getFragmentQueue(){return this._fragmentQueue.getCurrentQueue()}setLoggerLevel(e,t=[],r=[]){return this._loggerTransport&&(this._loggerTransport.destroy(),this._loggerTransport=null),this._loggerTransport=new ez(this._eventBus,e,t,r),this}setResolutionByName(e){return this._resolutionManager.setResolutionByName(e),this}setResolutionByBitrate(e){return this._resolutionManager.setNearestResolutionByBitrate(e)}disableABR(){return this._resolutionManager.toggleAutoResolution(!1),this}enableABR(){return this._resolutionManager.toggleAutoResolution(!0),this}setConfig(e){tZ(e,this._eventBus)}setMaxABRResolution(e){this._eventBus.publish(t5,e)}async _restart(){this._logger.info("restarting"),this._buffer?.reset(),await this.recoverMediaError(),this._fragmentParser.destroy(),this._fragmentParser=new rV(this._eventBus),this._fragmentQueue.reset(),this._url&&this._resolutionManager.setUrl(this._url)}_stop(){this._url=null,this._restart(),this._resolutionManager.setUrl("")}_onResolutionsAvailable(e){this.dispatchEvent(new CustomEvent(d.VARIANTS_DETECTED,{detail:e}))}_onStreamEnded(){this.dispatchEvent(new Event(d.STREAM_ENDED))}_onResolutionChanged(e){this.dispatchEvent(new CustomEvent(d.RESOLUTION_CHANGED,{detail:e}))}_onBufferMetricsAvailable(e){this.dispatchEvent(new CustomEvent(d.METRICS_AVAILABLE,{detail:e}))}_onPlaybackStateChanged({prevState:e,nextState:t}){this.dispatchEvent(new CustomEvent(d.PLAYBACK_STATE_CHANGED,{detail:{prevState:e,nextState:t}}))}_onFragmentFilterProblemDetected({reason:e,fragment:t}){this.dispatchEvent(new CustomEvent(d.FRAGMENT_FILTERED_OUT,{detail:{reason:e,fragment:t}}))}_onMediaElementError(){rK.reportError("VideoElementError",{msg:this._videoElement?.error?.message,code:this._videoElement?.error?.code}),this._eventBus.publish(rj.saveData,{}),this._logger.error(`Media error occurred ${this._videoElement?.error?.message} ${this._videoElement?.error?.code}`),this._videoElement?.error&&this.recoverMediaError()}_onLifecycleEventReported({eventType:e}){this.dispatchEvent(new CustomEvent(d.LIFECYCLE_EVENT,{detail:{eventType:e}}))}_onLifecycleErrorReported({errorType:e,nativeError:t}){this.dispatchEvent(new CustomEvent(d.LIFECYCLE_ERROR,{detail:{errorType:e,nativeError:t}}))}_onResolutionNotFound(){this.dispatchEvent(new CustomEvent(d.RESOLUTION_NOT_FOUND))}_addAirPlaySourceIfNeeded(){if(this._url&&this._videoElement&&window.ManagedMediaSource){let e=document.createElement("source");e.type="application/x-mpegURL",e.src=this._url.replace(/playlistType=lowLatency/gi,""),this._videoElement.appendChild(e)}}}(0,er.__decorate)([t1.default],iw.prototype,"_onResolutionsAvailable",null),(0,er.__decorate)([t1.default],iw.prototype,"_onStreamEnded",null),(0,er.__decorate)([t1.default],iw.prototype,"_onResolutionChanged",null),(0,er.__decorate)([t1.default],iw.prototype,"_onBufferMetricsAvailable",null),(0,er.__decorate)([t1.default],iw.prototype,"_onPlaybackStateChanged",null),(0,er.__decorate)([t1.default],iw.prototype,"_onFragmentFilterProblemDetected",null),(0,er.__decorate)([t1.default],iw.prototype,"_onMediaElementError",null),(0,er.__decorate)([t1.default],iw.prototype,"_onLifecycleEventReported",null),(0,er.__decorate)([t1.default],iw.prototype,"_onLifecycleErrorReported",null),(0,er.__decorate)([t1.default],iw.prototype,"_onResolutionNotFound",null)}),l("jecYn",function(e,t){e.exports=r("kCErS").then(()=>o("hbCbi"))}),l("4gxuw",function(e,t){s(e.exports,"AbstractWrapper",function(){return i});var r=o("giOKx");class i{constructor(e,t={}){this._videoElement=null,this._lastKnownConfig={},this._lastKnownStreamConfig=null,this._playerInstance=null,this._metricsCollector=null,this._eventBusInstance=e,this._eventBusInstance.publish(r.EPlayersEvents.MODULE_LOADED,{}),this._persistent=!!t.persistent}setMetricsCollector(e){this._metricsCollector=e}destroy(){return this._destroyPlayerInstance(),this._isStarted=!1,this}setAppKey(e){return this._appKey=e,this}setVideoElement(e){return this._videoElement=e,e&&this._playerInstance?.setVideoElement(e),this}recreatePlayerInstance(){this._playerInstance&&(this.destroy(),this._playerInstance=null),this._createPlayerInstance()}start(){return this._playerInstance||this.recreatePlayerInstance(),this._playerInstance?.start(),this._isStarted=!0,this}stop(){return this._isStarted=!1,this._persistent&&this._playerInstance&&"stop"in this._playerInstance?this._playerInstance.stop():this._destroyPlayerInstance(),this}setPlayerConfig(e){return this._lastKnownConfig=e,this._playerInstance?.setConfig(e,!0),this}_destroyPlayerInstance(){this._playerInstance&&(this._detachEventListeners(),this._playerInstance.destroy(),this._playerInstance=null)}}})}),r.register("kCErS",function(e,t){e.exports=Promise.resolve(require("./Debugger.worker.77753fbf.0a5236a4.0f3189f6.js")).then(()=>r("5rm7U"))});//# sourceMappingURL=Doppio.5a65c8c8.87c0f38e.js.map